<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ›´æ¢ç”µè„‘,hexoä¸èƒ½æ­£å¸¸ä½¿ç”¨</title>
    <link href="/2021-10-31-%E6%9B%B4%E6%8D%A2%E7%94%B5%E8%84%91,hexo%E4%B8%8D%E8%83%BD%E6%AD%A3%E5%B8%B8%E4%BD%BF%E7%94%A8/"/>
    <url>/2021-10-31-%E6%9B%B4%E6%8D%A2%E7%94%B5%E8%84%91,hexo%E4%B8%8D%E8%83%BD%E6%AD%A3%E5%B8%B8%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="æ›´æ¢ç”µè„‘-hexoä¸èƒ½æ­£å¸¸ä½¿ç”¨"><a href="#æ›´æ¢ç”µè„‘-hexoä¸èƒ½æ­£å¸¸ä½¿ç”¨" class="headerlink" title="æ›´æ¢ç”µè„‘,hexoä¸èƒ½æ­£å¸¸ä½¿ç”¨"></a>æ›´æ¢ç”µè„‘,hexoä¸èƒ½æ­£å¸¸ä½¿ç”¨</h1><p>æ–°å‡ºçš„M1proèŠ¯ç‰‡è‚¯å®šæ˜¯å¸å¼•æˆ‘çš„(çœŸçš„é¦™),æœæ–­æ¢äº†,å½“å¼„åˆ°hexoå‘å¸ƒåšå®¢çš„æ—¶é—´å‡ºç°äº†æƒé™ä¸è¶³çš„é—®é¢˜,æˆ‘æœæ–­sudoæ‰§è¡Œå‘½ä»¤,å¯æ˜¯è¿˜æ˜¯ä¸è¡Œ,è€çš„Macæ˜¯å¯ä»¥çš„â€¦.ä¸‰ä¸ªå°æ—¶åæ‰¾åˆ°äº†è§£å†³åŠæ³•!!!</p><p>é¦–å…ˆå…ˆsudoæ‰§è¡Œhexo gçš„å‘½ä»¤,å¦‚æœæŠ¥é”™è®²æ ¹ç›®å½•ä¸‹çš„.deploy_gitåˆ é™¤æ‰,ç»§ç»­hexo gå°±okäº†</p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hooksåˆ†äº«</title>
    <link href="/2021-05-08-hooks%E5%88%86%E4%BA%AB/"/>
    <url>/2021-05-08-hooks%E5%88%86%E4%BA%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks-å¦‚ä½•ä½¿ç”¨hooks"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks-å¦‚ä½•ä½¿ç”¨hooks" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks,å¦‚ä½•ä½¿ç”¨hooks?"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°hooks,å¦‚ä½•ä½¿ç”¨hooks?</h1><blockquote><p>æˆ‘ä»¬ç°åœ¨çš„å±€é¢æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>Reactå¾ˆå—æ¬¢è¿ã€‚</li><li>Reactç»„ä»¶ä½¿ç”¨ç±»åˆ›å»ºï¼Œå› ä¸ºè¿™æ˜¯å½“æ—¶æœ€æœ‰æ„ä¹‰çš„æ–¹å¼ã€‚</li><li>ä½¿ç”¨super(props)æ˜¯å¾ˆçƒ¦äººçš„ã€‚</li><li>æ²¡äººçŸ¥é“â€œthisâ€æ˜¯æ€ä¹ˆå›äº‹ã€‚</li><li>å¥½äº†å†·é™ç‚¹ã€‚æˆ‘å‡è®¾ä½ çŸ¥é“â€œthisâ€æ˜¯æ€ä¹ˆå›äº‹ï¼Œä½†è¿™å¯¹æŸäº›äººæ¥è¯´æ˜¯ä¸å¿…è¦çš„éšœç¢ã€‚</li><li>é€šè¿‡ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç»„ç»‡ç»„ä»¶ï¼Œè¿«ä½¿æˆ‘ä»¬å°†ç›¸å…³çš„é€»è¾‘åˆ†æ•£åˆ°ç»„ä»¶ä¸­ã€‚</li><li>Reactå¯¹äºå…±äº«éå¯è§†é€»è¾‘æ²¡æœ‰å¾ˆå¥½çš„åŸå§‹æ”¯æŒã€‚</li></ul></blockquote><h2 id="ä¸€-hooksçš„ç”±æ¥ä»¥åŠä½¿ç”¨hooksçš„å¥½å¤„"><a href="#ä¸€-hooksçš„ç”±æ¥ä»¥åŠä½¿ç”¨hooksçš„å¥½å¤„" class="headerlink" title="ä¸€.hooksçš„ç”±æ¥ä»¥åŠä½¿ç”¨hooksçš„å¥½å¤„"></a>ä¸€.hooksçš„ç”±æ¥ä»¥åŠä½¿ç”¨hooksçš„å¥½å¤„</h2><h3 id="1-this"><a href="#1-this" class="headerlink" title="1.this"></a>1.this</h3><p>é¦–å…ˆä»–è§£å†³çš„å°±æ˜¯thisé—®é¢˜,ä¾‹å¦‚æˆ‘ä»¬å¸¸å¸¸åœ¨constructorä¸­çš„bindä¸€ä¸ªäº‹ä»¶æ¥æ”¹å˜thisçš„æŒ‡å‘.åœ¨å‡½æ•°ç»„ä»¶å°±å¯ä»¥.æ‘†è„±äº†this!!!!   : )</p><h3 id="2-è§£å†³propsä¸æ˜ç¡®"><a href="#2-è§£å†³propsä¸æ˜ç¡®" class="headerlink" title="2.è§£å†³propsä¸æ˜ç¡®"></a>2.è§£å†³propsä¸æ˜ç¡®</h3><p>å› ä¸ºæœ‰çš„classç»„ä»¶éœ€è¦è¢«å¾ˆå¤šé«˜é˜¶ç»„ä»¶åµŒå¥—,å¯¼è‡´ä¼ ä¸‹æ¥çš„propsä¸çŸ¥é“æ˜¯è°ä¼ çš„,æˆ–è€…propsé‡åå°±ä¼šè¢«è¦†ç›–æ‰,å›è°ƒåœ°ç‹±è§è¿‡å§,è¿™â€¦..</p><pre><code class="hljs jsx">&lt;WithHover&gt;  &lt;WithTheme hovering=&#123;<span class="hljs-literal">false</span>&#125;&gt;    &lt;WithAuth hovering=&#123;<span class="hljs-literal">false</span>&#125; theme=<span class="hljs-string">'dark'</span>&gt;      &lt;WithRepos hovering=&#123;<span class="hljs-literal">false</span>&#125; theme=<span class="hljs-string">'dark'</span> authed=&#123;<span class="hljs-literal">true</span>&#125;&gt;        &lt;Profile           id=<span class="hljs-string">'JavaScript'</span>          loading=&#123;<span class="hljs-literal">true</span>&#125;           repos=&#123;[]&#125;          authed=&#123;<span class="hljs-literal">true</span>&#125;          theme=<span class="hljs-string">'dark'</span>          hovering=&#123;<span class="hljs-literal">false</span>&#125;        /&gt;      &lt;<span class="hljs-regexp">/WithRepos&gt;</span><span class="hljs-regexp">    &lt;/</span>WithAuth&gt;  &lt;WithTheme&gt;&lt;<span class="hljs-regexp">/WithHover&gt;</span></code></pre><h3 id="3-é‡å¤ä»£ç "><a href="#3-é‡å¤ä»£ç " class="headerlink" title="3.é‡å¤ä»£ç "></a>3.é‡å¤ä»£ç </h3><p>Class component</p><pre><code class="hljs jsx">componentDidMount () &#123;   <span class="hljs-keyword">this</span>.updateRepos(<span class="hljs-keyword">this</span>.props.id) &#125; componentDidUpdate (prevProps) &#123;   <span class="hljs-keyword">if</span> (prevProps.id !== <span class="hljs-keyword">this</span>.props.id) &#123;     <span class="hljs-keyword">this</span>.updateRepos(<span class="hljs-keyword">this</span>.props.id)   &#125; &#125; updateRepos = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;.... &#125;</code></pre><p>hooks</p><pre><code class="hljs jsx">React.useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  updateRepos(props.id)&#125;, [props.id])<span class="hljs-keyword">const</span> updateRepos = React.useCallback(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;  .....&#125;, [])</code></pre><h3 id="4-è§£å†³é€»è¾‘ä¸æ¸…æ™°é—®é¢˜"><a href="#4-è§£å†³é€»è¾‘ä¸æ¸…æ™°é—®é¢˜" class="headerlink" title="4.è§£å†³é€»è¾‘ä¸æ¸…æ™°é—®é¢˜"></a>4.è§£å†³é€»è¾‘ä¸æ¸…æ™°é—®é¢˜</h3><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> Index = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> &#123;  <span class="hljs-keyword">const</span> [dataList, setDataList] = React.useState([]);  <span class="hljs-keyword">const</span> [pageNum, setPageNum] = React.useState(<span class="hljs-number">1</span>);  <span class="hljs-keyword">const</span> [currentTotal, setCurrentTotal] = React.useState(<span class="hljs-number">0</span>);<span class="hljs-comment">// æ”¹å˜tab</span>  <span class="hljs-keyword">const</span> &#123; tabIndex, onClick &#125; = useTabChange(setDataList, setPageNum);<span class="hljs-comment">// åŠ è½½æ›´å¤š</span>  <span class="hljs-keyword">const</span> &#123; hasMore, onLoadMore &#125; = useLoadMore(    currentTotal,    pageNum,    tabIndex,    dataList,    setDataList,    setCurrentTotal,    setPageNum  );<span class="hljs-comment">// è·å–å±å¹•å‰©ä½™å®½åº¦</span>  <span class="hljs-keyword">const</span> &#123; remainingHeight &#125; = useWindowHeight(props.takeUpHeight);<span class="hljs-comment">// æ¸²æŸ“åº•éƒ¨</span>  <span class="hljs-keyword">const</span> renderFooter = React.useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ListFooter</span> /&gt;</span></span>;  &#125;, []);<span class="hljs-comment">// æ¸²æŸ“æ¯è¡Œ</span>  <span class="hljs-keyword">const</span> renderItem = React.useCallback(    (item) =&gt; &#123;      <span class="hljs-keyword">return</span> (        &lt;ListItem          &#123;...item&#125;          imgSrc=&#123;item.imageUrl&#125;          company=&#123;item.basic.companyName&#125;          title=&#123;item.basic.insureName&#125;          tag=&#123;tabList[tabIndex].title&#125;          detail=&#123;item.desc&#125;          price=&#123;item.minPremiumE2&#125;        /&gt;      );    &#125;,    [tabIndex]  );<span class="hljs-comment">// å½“tabå‘ç”Ÿæ”¹å˜è¿›è¡Œè¯·æ±‚</span>  React.useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    callApiBase(lhjApi.query_domestic_list, &#123;      params: &#123;        type: tabList[tabIndex].type,        pageNo: <span class="hljs-number">1</span>,      &#125;,    &#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;      setDataList(res.data?.list ?? []);      setCurrentTotal(res.data?.total ?? <span class="hljs-number">0</span>);      setPageNum(<span class="hljs-number">2</span>);    &#125;);  &#125;, [tabIndex]);  <span class="hljs-keyword">return</span> (    &lt;View className=<span class="hljs-string">'domestic-insurance-namespace'</span>&gt;      &lt;AtTabs        current=&#123;tabIndex&#125;        scroll        height=&#123;remainingHeight&#125;        tabDirection=<span class="hljs-string">'vertical'</span>        tabList=&#123;tabList&#125;        onClick=&#123;onClick&#125;      &gt;        &#123;tabList.map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;          <span class="hljs-keyword">return</span> (            &lt;AtTabsPane              tabDirection=<span class="hljs-string">'vertical'</span>              key=&#123;item.type&#125;              current=&#123;tabIndex&#125;              index=&#123;index&#125;            &gt;              &lt;ListView                style=&#123;&#123;                  height: remainingHeight,                &#125;&#125;                list=&#123;dataList&#125;                renderItem=&#123;renderItem&#125;                renderFooter=&#123;renderFooter&#125;                onLoadMore=&#123;onLoadMore&#125;                hasMore=&#123;hasMore&#125;              /&gt;            &lt;<span class="hljs-regexp">/AtTabsPane&gt;</span><span class="hljs-regexp">          );</span><span class="hljs-regexp">        &#125;)&#125;</span><span class="hljs-regexp">      &lt;/</span>AtTabs&gt;    &lt;<span class="hljs-regexp">/View&gt;</span><span class="hljs-regexp">  );</span><span class="hljs-regexp">&#125;;</span></code></pre><h2 id="äºŒ-ä½¿ç”¨äº‹é¡¹"><a href="#äºŒ-ä½¿ç”¨äº‹é¡¹" class="headerlink" title="äºŒ.ä½¿ç”¨äº‹é¡¹"></a>äºŒ.ä½¿ç”¨äº‹é¡¹</h2><blockquote><ul><li><p>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨Hookï¼Œå¿…é¡»å§‹ç»ˆåœ¨Reactå‡½æ•°çš„é¡¶å±‚ä½¿ç”¨Hookã€‚è¿™æ˜¯å› ä¸ºReactéœ€è¦åˆ©ç”¨è°ƒç”¨é¡ºåºæ¥æ­£ç¡®æ›´æ–°ç›¸åº”çš„çŠ¶æ€ï¼Œä»¥åŠè°ƒç”¨ç›¸åº”çš„é’©å­å‡½æ•°ã€‚ä¸€æ—¦åœ¨å¾ªç¯æˆ–æ¡ä»¶åˆ†æ”¯è¯­å¥ä¸­è°ƒç”¨Hookï¼Œå°±å®¹æ˜“å¯¼è‡´è°ƒç”¨é¡ºåºçš„ä¸ä¸€è‡´æ€§ï¼Œä»è€Œäº§ç”Ÿéš¾ä»¥é¢„æ–™åˆ°çš„åæœã€‚<a href="https://evanchen0629.github.io/2019-09-18-%E4%BB%8Ereact-hooks%E2%80%9C%E9%97%AD%E5%8C%85%E9%99%B7%E9%98%B1%E2%80%9D%E5%88%87%E5%85%A5%EF%BC%8C%E6%B5%85%E8%B0%88react-hooks/" target="_blank" rel="noopener">å…·ä½“å¯çœ‹è¿™é‡Œ</a>,å¤§è‡´è§£é‡Šä¸€ä¸‹,å› ä¸ºreactåœ¨é‡è§hooksçš„æ—¶å€™ä¼šå°†ä»–ä»¬ç»Ÿä¸€å­˜åˆ°é“¾è¡¨ä¸­,æ¯ä¸€æ¬¡è§†å›¾æ›´æ–°,è¿™ä¸ªé“¾è¡¨ä¹Ÿä¼šæ›´æ–°,å› ä¸ºæ˜¯ä¾èµ–ä¸Šä¸€æ¬¡çš„é“¾è¡¨ä¸­å¯¹åº”çš„å€¼</p></li><li><p>åªèƒ½åœ¨Reactå‡½æ•°å¼ç»„ä»¶æˆ–è‡ªå®šä¹‰Hookä¸­ä½¿ç”¨Hookã€‚(æƒ³åœ¨classä¸­ä½¿ç”¨hooksä¹Ÿæœ‰éªšæ“ä½œ,ä¾‹å¦‚ç”¨å‡½æ•°ç»„ä»¶å°†ç±»ç»„ä»¶åŒ…è£¹èµ·æ¥,åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨hooks,é€šè¿‡propsä¼ é€’ç»™ç±»ç»„ä»¶å°±å¥½äº†â€¦â€¦ä½†æ˜¯æå…¶ä¸å»ºè®®)</p></li><li><p>ä¸è¦åœ¨useEffect()ç¬¬ä¸€ä¸ªå‚æ•°ä½¿ç”¨async,å› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°è¿”å›çš„é—­åŒ…å‡½æ•°æ˜¯å¸è½½ç»„ä»¶è°ƒç”¨çš„,ç”¨asyncè¿”å›çš„é—­åŒ…å‡½æ•°å°±æ˜¯promiseäº†</p></li></ul></blockquote><h3 id="ä¸‰-useCallbackå’ŒuseMemoçš„åŒºåˆ«"><a href="#ä¸‰-useCallbackå’ŒuseMemoçš„åŒºåˆ«" class="headerlink" title="ä¸‰.useCallbackå’ŒuseMemoçš„åŒºåˆ«"></a>ä¸‰.useCallbackå’ŒuseMemoçš„åŒºåˆ«</h3><p>è¿™ä¸¤ä¸ªä¸œè¥¿æ˜¯åšæ€§èƒ½ä¼˜åŒ–çš„</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">const</span> [num, setNum] = React.useState(<span class="hljs-number">0</span>);  <span class="hljs-comment">// const a = () =&gt; &#123;</span>      <span class="hljs-comment">// &#125;</span>  <span class="hljs-keyword">const</span> a = React.useCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  &#125;, [])  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">a</span>=<span class="hljs-string">&#123;a&#125;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setNum(num+1)&#125; &gt;æŒ‰æˆ‘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Child</span>(<span class="hljs-params">props</span>) </span>&#123;  React.useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>);  &#125;, [props.a])  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>&#125;</code></pre><p>ä½¿ç”¨callbackæ—¶å°±ä¼šæ‰“å°ä¸€æ¬¡1,å½“ä½¿ç”¨ç®­å¤´å‡½æ•°æˆ–è€…æ™®é€šå‡½æ•°æ—¶å½“numæ›´æ”¹æ—¶,å°±ä¼šæ‰“å°ä¸€æ¬¡1,soä½¿ç”¨callbackæ˜¯å¯¹æ€§èƒ½ä¼˜åŒ–â€¦</p><p>è€Œmemoå’Œcallbackå¿…é¡»æœ‰è¿”å›å€¼,ç±»ä¼¼vueä¸­çš„computed,åšå¤§é‡æ•°æ®è¿ç®—æ—¶ä½¿ç”¨</p><ul><li>useCallback ä¼˜åŒ–é’ˆå¯¹äºå­ç»„ä»¶æ¸²æŸ“</li><li>useMemo ä¼˜åŒ–é’ˆå¯¹äºå½“å‰ç»„ä»¶é«˜å¼€é”€çš„è®¡ç®—</li></ul><h3 id="å››-hookä¸­çš„setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„"><a href="#å››-hookä¸­çš„setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„" class="headerlink" title="å››.hookä¸­çš„setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„?"></a>å››.hookä¸­çš„setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„?</h3><p>å‡†ç¡®æ¥è¯´å½“stateå˜åŒ–æ—¶å‡½æ•°ä¼šé‡æ–°èµ°ä¸€é,æ‰€ä»¥è¯´åŒæ­¥å¼‚æ­¥æ²¡å…³ç³»,æƒ³è¦æ‹¿åˆ°æœ€æ–°æ•°æ®åªéœ€è¦åœ¨ä¾èµ–å†™ä¸Šstate,å½“stateå˜åŒ–æ—¶,å‡½æ•°ä¹Ÿè‡ªç„¶å˜åŒ–,useeffectä¹Ÿä¼šé‡æ–°èµ°</p><blockquote><p>å‰©ä¸‹çš„å‡ ä¸ªhooksæ²¡æœ‰ä»€ä¹ˆæ³¨æ„ç‚¹å§â€¦.å¾…æ›´ing(é‡è§é—®é¢˜ä¼šæ›´æ–°)</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reactæ ¹æ®ç¯å¢ƒæ›´æ”¹title</title>
    <link href="/2021-02-21-react%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%94%B9title/"/>
    <url>/2021-02-21-react%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%94%B9title/</url>
    
    <content type="html"><![CDATA[<h1 id="reactæ ¹æ®ç¯å¢ƒæ›´æ”¹title"><a href="#reactæ ¹æ®ç¯å¢ƒæ›´æ”¹title" class="headerlink" title="reactæ ¹æ®ç¯å¢ƒæ›´æ”¹title"></a>reactæ ¹æ®ç¯å¢ƒæ›´æ”¹title</h1><p>é€šè¿‡create react app åˆ›å»ºçš„é¡¹ç›®å¯ä»¥ç›´æ¥æ›´æ”¹publicä¸­çš„index.htmlä¸­çš„titleæ›¿æ¢æˆ<code>&lt;%= htmlWebpackPlugin.options.title %&gt;</code></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnv6tnigb8j30hd010q2w.jpg" srcset="/img/loading.gif" alt="image-20210221152847857"></p><p>æ¥ä¸‹æ¥åœ¨configä¸‹çš„webpack.config.jsä¸­è¯¥æ›´å¦‚ä¸‹ä»£ç </p><pre><code class="hljs js"><span class="hljs-keyword">new</span> HtmlWebpackPlugin(  <span class="hljs-built_in">Object</span>.assign(    &#123;&#125;,    &#123;      inject: <span class="hljs-literal">true</span>,      template: paths.appHtml,    &#125;,    isEnvProduction      ? &#123;          minify: &#123;            removeComments: <span class="hljs-literal">true</span>,            collapseWhitespace: <span class="hljs-literal">true</span>,            removeRedundantAttributes: <span class="hljs-literal">true</span>,            useShortDoctype: <span class="hljs-literal">true</span>,            removeEmptyAttributes: <span class="hljs-literal">true</span>,            removeStyleLinkTypeAttributes: <span class="hljs-literal">true</span>,            keepClosingSlash: <span class="hljs-literal">true</span>,            minifyJS: <span class="hljs-literal">true</span>,            minifyCSS: <span class="hljs-literal">true</span>,            minifyURLs: <span class="hljs-literal">true</span>,          &#125;,          title: <span class="hljs-string">'DMP'</span>        &#125;      : &#123;          title: <span class="hljs-string">'å¼€å‘ç¯å¢ƒ'</span>        &#125;  )),</code></pre><p>okäº†</p>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>asyncå’Œawaitçš„æ¼”å˜è¿‡ç¨‹</title>
    <link href="/2021-2-1-async%E5%92%8Cawait%E7%9A%84%E6%BC%94%E5%8F%98%E8%BF%87%E7%A8%8B/"/>
    <url>/2021-2-1-async%E5%92%8Cawait%E7%9A%84%E6%BC%94%E5%8F%98%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åœ¨å·¥ä½œå¤§å®¶ç»å¸¸ä½¿ç”¨asyncå’Œawait,ä¾‹å¦‚æ¨¡æ‹Ÿä¸ªå¼‚æ­¥,aé‡Œé¢å­˜ç€bçš„è·¯å¾„,bå­˜ç€cçš„è·¯å¾„,æˆ‘æƒ³è¦å¾—åˆ°cé‡Œé¢çš„å†…å®¹,å°±å¿…é¡»ä¸€å±‚å±‚è¯»,å¦‚ä½•è®©å¤§å®¶å†™è‚¯å®šä¼šæƒ³åˆ°asyncå’Œawaitçš„,é‚£ä»–åˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢?</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn832pihekj306001zwea.jpg" srcset="/img/loading.gif" alt="image-20210201155107986"></p><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readSync</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">let</span> value1 = <span class="hljs-keyword">await</span> readFile(<span class="hljs-string">'./a.txt'</span>, <span class="hljs-string">'utf-8'</span>)  <span class="hljs-keyword">let</span> value2 = <span class="hljs-keyword">await</span> readFile(value1, <span class="hljs-string">'utf-8'</span>);  <span class="hljs-keyword">let</span> value3 = <span class="hljs-keyword">await</span> readFile(value2, <span class="hljs-string">'utf-8'</span>);&#125;</code></pre><h2 id="1-è¿­ä»£å™¨"><a href="#1-è¿­ä»£å™¨" class="headerlink" title="1.è¿­ä»£å™¨"></a>1.è¿­ä»£å™¨</h2><p>é¦–å…ˆè®²ä¸€ä¸‹es6éå¸¸å…³é”®çš„ä¸œè¥¿è¿­ä»£å™¨,ç®€å•çš„è¯´å¯ä»¥ç”¨for ofè¯­å¥æ‰§è¡Œçš„å°±æ˜¯å¯è¿­ä»£å¯¹è±¡,å¯è¿­ä»£å¯¹è±¡ä¸­éƒ½å®ç°äº†è¿­ä»£å™¨,ä¾‹å¦‚æ•°ç»„,Map,å­—ç¬¦ä¸²NodeListâ€¦â€¦</p><p>åœ¨ç®€å•ç‚¹è¯´å¯ä»¥çœ‹åŸå‹é“¾ä¸Šæœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn837tm9aij30u00vq7aw.jpg" srcset="/img/loading.gif" alt="image-20210201155604914"></p><p>é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç”¨for ofå°±å¯ä»¥æ‰“å°è¿­ä»£ä»–</p><p><strong>è¿™é‡Œè¦æ³¨æ„è¿­ä»£,éå†å’Œå¾ªç¯çš„åŒºåˆ«</strong></p><ul><li><p>å¾ªç¯ï¼ˆloopï¼‰ï¼ŒæŒ‡çš„æ˜¯åœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œé‡å¤æ‰§è¡ŒåŒä¸€æ®µä»£ç ã€‚æ¯”å¦‚ï¼Œwhileè¯­å¥ã€‚</p></li><li><p>è¿­ä»£ï¼ˆiterateï¼‰ï¼ŒæŒ‡çš„æ˜¯æŒ‰ç…§æŸç§é¡ºåºé€ä¸ªè®¿é—®åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹ã€‚æ¯”å¦‚ï¼Œforè¯­å¥ã€‚</p></li><li><p>éå†ï¼ˆtraversalï¼‰ï¼ŒæŒ‡çš„æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è®¿é—®æ ‘å½¢ç»“æ„ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½åªè®¿é—®ä¸€æ¬¡ã€‚</p></li></ul><h2 id="2-ç”Ÿæˆå™¨"><a href="#2-ç”Ÿæˆå™¨" class="headerlink" title="2.ç”Ÿæˆå™¨"></a>2.ç”Ÿæˆå™¨</h2><p>ç”Ÿæˆå™¨å…¶å®å°±æ˜¯ç”Ÿæˆè¿­ä»£å™¨çš„</p><p>è¯­æ³•</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">name</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>&#125;</code></pre><p>å’Œreturnçš„åŒºåˆ«æ˜¯,returnåœ¨å‡½æ•°ä¸­åªæœ‰ä¸€ä¸ª,è€Œyieldå¯ä»¥æœ‰å¤šä¸ª,returnç›´æ¥ç»ˆæ­¢å‡½æ•°äº†,è€Œyieldå¯ä»¥ç†è§£ä¸ºæš‚åœå‡½æ•°</p><p>ä½¿ç”¨</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">generate</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">const</span> value = <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'value: '</span>, value);  <span class="hljs-keyword">yield</span> value  <span class="hljs-keyword">yield</span> <span class="hljs-number">3</span>&#125;<span class="hljs-keyword">const</span> iter = generate()<span class="hljs-built_in">console</span>.log(iter.next());<span class="hljs-built_in">console</span>.log(iter.next(<span class="hljs-number">2</span>));<span class="hljs-built_in">console</span>.log(iter.next());</code></pre><p>1.é¦–å…ˆåˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</p><p>2.é€šè¿‡ç”Ÿæˆå™¨å¯¹è±¡è°ƒç”¨nextæ–¹æ³•æ¥æ‰§è¡Œå‡½æ•°,åˆ°ç¬¬ä¸€ä¸ªyieldç»“æŸ,å¤šæ¬¡è°ƒç”¨nextå¯ä»¥å¤šæ¬¡æ‰§è¡Œ</p><p>3.nextå¯ä»¥ä¼ é€’å‚æ•°,ä¼ é€’çš„å‚æ•°å¯ä»¥é€šè¿‡yieldçš„è¿”å›å€¼æ¥æ”¶,ç¬¬ä¸€æ¬¡ä¼ å€¼æ˜¯æ¥æ”¶ä¸åˆ°çš„,è€Œæ˜¯ç¬¬äºŒä¸ªä¼ é€’æ‰èƒ½æ¥æ”¶åˆ°ä¾‹å¦‚:</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn83ndt6xaj30oo0d4mz0.jpg" srcset="/img/loading.gif" alt="image-20210201161101960"></p><p>æ™®åŠäº†è¿™äº›å°±å¯ä»¥å®ç°asyncå’Œawaitäº†</p><h2 id="3-é€šè¿‡ä¾‹å­æ¥å®ç°asyncå’Œawait"><a href="#3-é€šè¿‡ä¾‹å­æ¥å®ç°asyncå’Œawait" class="headerlink" title="3.é€šè¿‡ä¾‹å­æ¥å®ç°asyncå’Œawait"></a>3.é€šè¿‡ä¾‹å­æ¥å®ç°asyncå’Œawait</h2><p>æˆ‘ä»¬å…ˆé€šè¿‡promiseè§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)<span class="hljs-keyword">const</span> readSync = <span class="hljs-function">(<span class="hljs-params">pathName</span>) =&gt;</span> &#123;  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span> &#123;    fs.readFile(pathName, <span class="hljs-string">'utf-8'</span>, (err, data) =&gt; &#123;      <span class="hljs-keyword">if</span> (err) &#123;        reject(err)      &#125;      resolve(data)    &#125;)  &#125;)&#125;<span class="hljs-keyword">const</span> p1 = readSync(<span class="hljs-string">'./a.txt'</span>)p1.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> readSync(res)&#125;).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> readSync(res)&#125;).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;  <span class="hljs-built_in">console</span>.log(res); <span class="hljs-comment">// ä¼šæ‰“å°c.txtä¸­çš„å†…å®¹</span>&#125;)</code></pre><p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å»è¯»å–æ–‡ä»¶,åœ¨åˆ›å»ºä¸€ä¸ªæ‰§è¡Œå™¨å»æ‰§è¡Œç”Ÿæˆå™¨</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">readFile</span>(<span class="hljs-params"></span>)</span>&#123;  <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">yield</span> readSync(<span class="hljs-string">'./a.txt'</span>)  <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">yield</span> readSync(res1)  <span class="hljs-keyword">const</span> res3 = <span class="hljs-keyword">yield</span> readSync(res2)  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'res3: '</span>, res3);&#125;<span class="hljs-keyword">const</span> iter = readFile()<span class="hljs-keyword">const</span> &#123;value, done&#125; = iter.next();<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done: '</span>, done);value.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;  <span class="hljs-keyword">const</span> &#123;value, done&#125; = iter.next(res);  value.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;    <span class="hljs-keyword">const</span> &#123;value, done&#125; =iter.next(res);    value.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;      <span class="hljs-keyword">const</span> &#123;value, done&#125; = iter.next(res)    &#125;)  &#125;)&#125;)</code></pre><p>è¿™æ ·è¿™ä¸ªreadFileå‡½æ•°å°±ä¼šæ‰“å°c.txtä¸­çš„å†…å®¹äº†,æ˜¯ä¸æ˜¯æ„Ÿè§‰æ¯æ¬¡å†™ç”Ÿæˆå™¨å¾ˆä¸çˆ½,æˆ‘ä»¬å€Ÿé‰´TJå¤§ç¥å†™çš„ç”Ÿæˆå™¨,ç®€å•å°è£…ä¸€ä¸ªé€šç”¨çš„ç”Ÿæˆå™¨ä»£ç </p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Co</span>(<span class="hljs-params">iter</span>) </span>&#123;  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;    <span class="hljs-keyword">let</span> next = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;      <span class="hljs-keyword">let</span> &#123; value, done &#125; = iter.next(data);      <span class="hljs-keyword">if</span> (done) &#123;        resolve(data);      &#125; <span class="hljs-keyword">else</span> &#123;        value.then(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> &#123;          next(val)        &#125;, reject)      &#125;    &#125;    next();  &#125;)&#125;Co(iter)</code></pre><p>è¿™æ ·å°±okäº†,ç„¶åå’±ä»¬çœ‹è¿™æ®µä»£ç ,å¯¹æ¯”ä¸€ä¸‹,å¤§å®¶æ˜¯ä¸æ˜¯å°±çŸ¥é“asyncå’Œawaitçš„ç”±æ¥äº† ğŸ˜</p><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readSync</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">let</span> value1 = <span class="hljs-keyword">await</span> readFile(<span class="hljs-string">'./a.txt'</span>, <span class="hljs-string">'utf-8'</span>)  <span class="hljs-keyword">let</span> value2 = <span class="hljs-keyword">await</span> readFile(value1, <span class="hljs-string">'utf-8'</span>);  <span class="hljs-keyword">let</span> value3 = <span class="hljs-keyword">await</span> readFile(value2, <span class="hljs-string">'utf-8'</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">readFile</span>(<span class="hljs-params"></span>)</span>&#123;  <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">yield</span> readSync(<span class="hljs-string">'./a.txt'</span>)  <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">yield</span> readSync(res1)  <span class="hljs-keyword">const</span> res3 = <span class="hljs-keyword">yield</span> readSync(res2)&#125;</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¬ç –ä¸­æ‰€é‡åˆ°çš„é—®é¢˜</title>
    <link href="/2021-1-29-%E6%90%AC%E7%A0%96%E4%B8%AD%E6%89%80%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2021-1-29-%E6%90%AC%E7%A0%96%E4%B8%AD%E6%89%80%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="1-typescript-eslint-no-unused-vars"><a href="#1-typescript-eslint-no-unused-vars" class="headerlink" title="1.@typescript-eslint/no-unused-vars"></a>1.@typescript-eslint/no-unused-vars</h2><p>å½“æ²¡æœ‰ä½¿ç”¨å˜é‡çš„æ—¶å€™,eslintä¼šæŠ¥ä¸€ä¸ªè¿™ä¸ªé”™,èªæ˜çš„ä½ è‚¯å®šæƒ³åˆ°,æˆ‘æ²¡ç”¨åˆ°æˆ‘åˆ äº†ä¸å°±è¡Œäº†å˜›ğŸ˜‘</p><pre><code class="hljs ts"><span class="hljs-keyword">const</span> handleChange = React.useCallback(    (      currentPagination: <span class="hljs-built_in">any</span>,      filteredInfo: &#123; [key: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span>[] &#125;,      currentSortInfo: ITableSortInfo,      params?: <span class="hljs-built_in">any</span>    ) =&gt; &#123;    [_setPagination, pagination, sortInfo]  );</code></pre><p>å½“æˆ‘å®šä¹‰ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™,æˆ‘ä¸ç¡®å®šå¤–é¢ç»™ä¸ç»™æˆ‘ä¼ è¿™ä¸ªå‚æ•°,å½“ç„¶å·²ç»æ˜¯ä¸ªå¾ˆè€çš„é¡¹ç›®äº†,å¦‚æœåˆ æ‰çš„è¯,ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜,è¿˜æœ‰æ”¹å½“å‰å·²æœ‰çš„é¡¹ç›®æ‰€ä½¿ç”¨çš„åœ°æ–¹.</p><ul><li><p>è§£å†³åŠæ³•</p><p>åœ¨å‚æ•°åå‰é¢åŠ ä¸Šä¸€ä¸ª_,å°±å¯ä»¥è§£å†³eslintæŠ¥çš„é”™äº†</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Problem</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TypeScriptå¦‚ä½•åœ¨ React ä¸­å®Œç¾è¿ç”¨ï¼Ÿ</title>
    <link href="/2020-5-29-TypeScript%E5%A6%82%E4%BD%95%E5%9C%A8-React-%E4%B8%AD%E5%AE%8C%E7%BE%8E%E8%BF%90%E7%94%A8%EF%BC%9F/"/>
    <url>/2020-5-29-TypeScript%E5%A6%82%E4%BD%95%E5%9C%A8-React-%E4%B8%AD%E5%AE%8C%E7%BE%8E%E8%BF%90%E7%94%A8%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="ç»„ä»¶-Props"><a href="#ç»„ä»¶-Props" class="headerlink" title="ç»„ä»¶ Props"></a>ç»„ä»¶ Props</h2><p>å…ˆçœ‹å‡ ç§å®šä¹‰ Props ç»å¸¸ç”¨åˆ°çš„ç±»å‹ï¼š</p><h3 id="åŸºç¡€ç±»å‹"><a href="#åŸºç¡€ç±»å‹" class="headerlink" title="åŸºç¡€ç±»å‹"></a>åŸºç¡€ç±»å‹</h3><pre><code class="hljs ts"><span class="hljs-keyword">type</span> BasicProps = &#123;  message: <span class="hljs-built_in">string</span>;  count: <span class="hljs-built_in">number</span>;  disabled: <span class="hljs-built_in">boolean</span>;  <span class="hljs-comment">/** æ•°ç»„ç±»å‹ */</span>  names: <span class="hljs-built_in">string</span>[];  <span class="hljs-comment">/** ç”¨ã€Œè”åˆç±»å‹ã€é™åˆ¶ä¸ºä¸‹é¢ä¸¤ç§ã€Œå­—ç¬¦ä¸²å­—é¢é‡ã€ç±»å‹ */</span>  status: <span class="hljs-string">"waiting"</span> | <span class="hljs-string">"success"</span>;&#125;;</code></pre><h3 id="å¯¹è±¡ç±»å‹"><a href="#å¯¹è±¡ç±»å‹" class="headerlink" title="å¯¹è±¡ç±»å‹"></a>å¯¹è±¡ç±»å‹</h3><pre><code class="hljs ts"><span class="hljs-keyword">type</span> ObjectOrArrayProps = &#123;  <span class="hljs-comment">/** å¦‚æœä½ ä¸éœ€è¦ç”¨åˆ°å…·ä½“çš„å±æ€§ å¯ä»¥è¿™æ ·æ¨¡ç³Šè§„å®šæ˜¯ä¸ªå¯¹è±¡ âŒ ä¸æ¨è */</span>  obj: object;  obj2: &#123;&#125;; <span class="hljs-comment">// åŒä¸Š</span>  <span class="hljs-comment">/** æ‹¥æœ‰å…·ä½“å±æ€§çš„å¯¹è±¡ç±»å‹ âœ… æ¨è */</span>  obj3: &#123;    id: <span class="hljs-built_in">string</span>;    title: <span class="hljs-built_in">string</span>;  &#125;;  <span class="hljs-comment">/** å¯¹è±¡æ•°ç»„ ğŸ˜ å¸¸ç”¨ */</span>  objArr: &#123;    id: <span class="hljs-built_in">string</span>;    title: <span class="hljs-built_in">string</span>;  &#125;[];  <span class="hljs-comment">/** key å¯ä»¥ä¸ºä»»æ„ stringï¼Œå€¼é™åˆ¶ä¸º MyTypeHere ç±»å‹ */</span>  dict1: &#123;    [key: <span class="hljs-built_in">string</span>]: MyTypeHere;  &#125;;  dict2: Record&lt;<span class="hljs-built_in">string</span>, MyTypeHere&gt;; <span class="hljs-comment">// åŸºæœ¬ä¸Šå’Œ dict1 ç›¸åŒï¼Œç”¨äº† TS å†…ç½®çš„ Record ç±»å‹ã€‚</span>&#125;</code></pre><h3 id="å‡½æ•°ç±»å‹"><a href="#å‡½æ•°ç±»å‹" class="headerlink" title="å‡½æ•°ç±»å‹"></a>å‡½æ•°ç±»å‹</h3><pre><code class="hljs ts"><span class="hljs-keyword">type</span> FunctionProps = &#123;  <span class="hljs-comment">/** ä»»æ„çš„å‡½æ•°ç±»å‹ âŒ ä¸æ¨è ä¸èƒ½è§„å®šå‚æ•°ä»¥åŠè¿”å›å€¼ç±»å‹ */</span>  onSomething: <span class="hljs-built_in">Function</span>;  <span class="hljs-comment">/** æ²¡æœ‰å‚æ•°çš„å‡½æ•° ä¸éœ€è¦è¿”å›å€¼ ğŸ˜ å¸¸ç”¨ */</span>  onClick: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">/** å¸¦å‡½æ•°çš„å‚æ•° ğŸ˜ éå¸¸å¸¸ç”¨ */</span>  onChange: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">/** å¦ä¸€ç§å‡½æ•°è¯­æ³• å‚æ•°æ˜¯ React çš„æŒ‰é’®äº‹ä»¶ ğŸ˜ éå¸¸å¸¸ç”¨ */</span>  onClick(event: React.MouseEvent&lt;HTMLButtonElement&gt;): <span class="hljs-built_in">void</span>;  <span class="hljs-comment">/** å¯é€‰å‚æ•°ç±»å‹ ğŸ˜ éå¸¸å¸¸ç”¨ */</span>  optional?: OptionalType;&#125;</code></pre><h3 id="React-ç›¸å…³ç±»å‹"><a href="#React-ç›¸å…³ç±»å‹" class="headerlink" title="React ç›¸å…³ç±»å‹"></a>React ç›¸å…³ç±»å‹</h3><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">interface</span> AppProps &#123;  children1: JSX.Element; <span class="hljs-comment">// âŒ ä¸æ¨è æ²¡æœ‰è€ƒè™‘æ•°ç»„</span>  children2: JSX.Element | JSX.Element[]; <span class="hljs-comment">// âŒ ä¸æ¨è æ²¡æœ‰è€ƒè™‘å­—ç¬¦ä¸² children</span>  children4: React.ReactChild[]; <span class="hljs-comment">// ç¨å¾®å¥½ç‚¹ ä½†æ˜¯æ²¡è€ƒè™‘ null</span>  children: React.ReactNode; <span class="hljs-comment">// âœ… åŒ…å«æ‰€æœ‰ children æƒ…å†µ</span>  functionChildren: <span class="hljs-function">(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) =&gt;</span> React.ReactNode; <span class="hljs-comment">// âœ… è¿”å› React èŠ‚ç‚¹çš„å‡½æ•°</span>  style?: React.CSSProperties; <span class="hljs-comment">// âœ… æ¨è åœ¨å†…è” style æ—¶ä½¿ç”¨</span>  <span class="hljs-comment">// âœ… æ¨èåŸç”Ÿ button æ ‡ç­¾è‡ªå¸¦çš„æ‰€æœ‰ props ç±»å‹</span>  <span class="hljs-comment">// ä¹Ÿå¯ä»¥åœ¨æ³›å‹çš„ä½ç½®ä¼ å…¥ç»„ä»¶ æå–ç»„ä»¶çš„ Props ç±»å‹</span>  props: React.ComponentProps&lt;<span class="hljs-string">"button"</span>&gt;;  <span class="hljs-comment">// âœ… æ¨è åˆ©ç”¨ä¸Šä¸€æ­¥çš„åšæ³• å†è¿›ä¸€æ­¥çš„æå–å‡ºåŸç”Ÿçš„ onClick å‡½æ•°ç±»å‹ </span>  <span class="hljs-comment">// æ­¤æ—¶å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šè‡ªåŠ¨æ¨æ–­ä¸º React çš„ç‚¹å‡»äº‹ä»¶ç±»å‹</span>  onClickButtonï¼šReact.ComponentProps&lt;<span class="hljs-string">"button"</span>&gt;[<span class="hljs-string">"onClick"</span>]&#125;</code></pre><h2 id="å‡½æ•°å¼ç»„ä»¶"><a href="#å‡½æ•°å¼ç»„ä»¶" class="headerlink" title="å‡½æ•°å¼ç»„ä»¶"></a>å‡½æ•°å¼ç»„ä»¶</h2><p>æœ€ç®€å•çš„ï¼š</p><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> AppProps = &#123; message: <span class="hljs-built_in">string</span> &#125;;<span class="hljs-keyword">const</span> App = <span class="hljs-function">(<span class="hljs-params">&#123; message &#125;: AppProps</span>) =&gt;</span> &lt;div&gt;&#123;message&#125;&lt;<span class="hljs-regexp">/div&gt;;</span></code></pre><p>åŒ…å« children çš„ï¼š</p><p>åˆ©ç”¨ <code>React.FC</code> å†…ç½®ç±»å‹çš„è¯ï¼Œä¸å…‰ä¼šåŒ…å«ä½ å®šä¹‰çš„ <code>AppProps</code> è¿˜ä¼šè‡ªåŠ¨åŠ ä¸Šä¸€ä¸ª children ç±»å‹ï¼Œä»¥åŠå…¶ä»–ç»„ä»¶ä¸Šä¼šå‡ºç°çš„ç±»å‹ï¼š</p><pre><code class="hljs ts"><span class="hljs-comment">// ç­‰åŒäº</span>AppProps &amp; &#123;   children: React.ReactNode   propTypes?: WeakValidationMap&lt;P&gt;;  contextTypes?: ValidationMap&lt;<span class="hljs-built_in">any</span>&gt;;  defaultProps?: Partial&lt;P&gt;;  displayName?: <span class="hljs-built_in">string</span>;&#125;<span class="hljs-comment">// ä½¿ç”¨</span><span class="hljs-keyword">interface</span> AppProps = &#123; message: <span class="hljs-built_in">string</span> &#125;;<span class="hljs-keyword">const</span> App: React.FC&lt;AppProps&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; message, children &#125;</span>) =&gt;</span> &#123;  <span class="hljs-keyword">return</span> (    &lt;&gt;     &#123;children&#125;     &lt;div&gt;&#123;message&#125;&lt;<span class="hljs-regexp">/div&gt;</span><span class="hljs-regexp">    &lt;/</span>&gt;  )&#125;;</code></pre><h2 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h2><p><code>@types/react</code> åŒ…åœ¨ 16.8 ä»¥ä¸Šçš„ç‰ˆæœ¬å¼€å§‹å¯¹ Hooks çš„æ”¯æŒã€‚</p><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><p>å¦‚æœä½ çš„é»˜è®¤å€¼å·²ç»å¯ä»¥è¯´æ˜ç±»å‹ï¼Œé‚£ä¹ˆä¸ç”¨æ‰‹åŠ¨å£°æ˜ç±»å‹ï¼Œäº¤ç»™ TS è‡ªåŠ¨æ¨æ–­å³å¯ï¼š</p><pre><code class="hljs ts"><span class="hljs-comment">// val: boolean</span><span class="hljs-keyword">const</span> [val, toggle] = React.useState(<span class="hljs-literal">false</span>);toggle(<span class="hljs-literal">false</span>)toggle(<span class="hljs-literal">true</span>)</code></pre><p>å¦‚æœåˆå§‹å€¼æ˜¯ null æˆ– undefinedï¼Œé‚£å°±è¦é€šè¿‡æ³›å‹æ‰‹åŠ¨ä¼ å…¥ä½ æœŸæœ›çš„ç±»å‹ã€‚</p><pre><code class="hljs ts"><span class="hljs-keyword">const</span> [user, setUser] = React.useState&lt;IUser | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);<span class="hljs-comment">// later...</span>setUser(newUser);</code></pre><p>è¿™æ ·ä¹Ÿå¯ä»¥ä¿è¯åœ¨ä½ ç›´æ¥è®¿é—® <code>user</code> ä¸Šçš„å±æ€§æ—¶ï¼Œæç¤ºä½ å®ƒæœ‰å¯èƒ½æ˜¯ nullã€‚</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89f3eb300d824bafb544494b8e92d9ac~tplv-k3u1fbpfcp-watermark.image" srcset="/img/loading.gif" alt="img"></p><p>é€šè¿‡ <code>optional-chaining</code> è¯­æ³•ï¼ˆTS 3.7 ä»¥ä¸Šæ”¯æŒï¼‰ï¼Œå¯ä»¥é¿å…è¿™ä¸ªé”™è¯¯ã€‚</p><pre><code class="hljs ts"><span class="hljs-comment">// âœ… ok</span><span class="hljs-keyword">const</span> name = user?.name</code></pre><h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><p>éœ€è¦ç”¨ <a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes-func.html#discriminated-unions" target="_blank" rel="noopener">Discriminated Unions</a> æ¥æ ‡æ³¨ Action çš„ç±»å‹ã€‚</p><pre><code class="hljs ts"><span class="hljs-keyword">const</span> initialState = &#123; count: <span class="hljs-number">0</span> &#125;;<span class="hljs-keyword">type</span> ACTIONTYPE =  | &#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">"increment"</span>; payload: <span class="hljs-built_in">number</span> &#125;  | &#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">"decrement"</span>; payload: <span class="hljs-built_in">string</span> &#125;;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reducer</span>(<span class="hljs-params">state: <span class="hljs-keyword">typeof</span> initialState, action: ACTIONTYPE</span>) </span>&#123;  <span class="hljs-keyword">switch</span> (action.type) &#123;    <span class="hljs-keyword">case</span> <span class="hljs-string">"increment"</span>:      <span class="hljs-keyword">return</span> &#123; count: state.count + action.payload &#125;;    <span class="hljs-keyword">case</span> <span class="hljs-string">"decrement"</span>:      <span class="hljs-keyword">return</span> &#123; count: state.count - <span class="hljs-built_in">Number</span>(action.payload) &#125;;    <span class="hljs-keyword">default</span>:      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>();  &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Counter</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">const</span> [state, dispatch] = React.useReducer(reducer, initialState);  <span class="hljs-keyword">return</span> (    &lt;&gt;      Count: &#123;state.count&#125;      &lt;button onClick=&#123;<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> dispatch(&#123; <span class="hljs-keyword">type</span>: <span class="hljs-string">"decrement"</span>, payload: <span class="hljs-string">"5"</span> &#125;)&#125;&gt;        -      &lt;<span class="hljs-regexp">/button&gt;</span><span class="hljs-regexp">      &lt;button onClick=&#123;() =&gt; dispatch(&#123; type: "increment", payload: 5 &#125;)&#125;&gt;</span><span class="hljs-regexp">        +</span><span class="hljs-regexp">      &lt;/</span>button&gt;    &lt;<span class="hljs-regexp">/&gt;</span><span class="hljs-regexp">  );</span><span class="hljs-regexp">&#125;</span></code></pre><p>ã€ŒDiscriminated Unionsã€ä¸€èˆ¬æ˜¯ä¸€ä¸ªè”åˆç±»å‹ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªç±»å‹éƒ½éœ€è¦é€šè¿‡ç±»ä¼¼ <code>type</code> è¿™ç§ç‰¹å®šçš„å­—æ®µæ¥åŒºåˆ†ï¼Œå½“ä½ ä¼ å…¥ç‰¹å®šçš„ <code>type</code> æ—¶ï¼Œå‰©ä¸‹çš„ç±»å‹ <code>payload</code> å°±ä¼šè‡ªåŠ¨åŒ¹é…æ¨æ–­ã€‚</p><p>è¿™æ ·ï¼š</p><ul><li>å½“ä½ å†™å…¥çš„ <code>type</code> åŒ¹é…åˆ° <code>decrement</code> çš„æ—¶å€™ï¼ŒTS ä¼šè‡ªåŠ¨æ¨æ–­å‡ºç›¸åº”çš„ <code>payload</code> åº”è¯¥æ˜¯ <code>string</code> ç±»å‹ã€‚</li><li>å½“ä½ å†™å…¥çš„ <code>type</code> åŒ¹é…åˆ° <code>increment</code> çš„æ—¶å€™ï¼Œåˆ™ <code>payload</code> åº”è¯¥æ˜¯ <code>number</code> ç±»å‹ã€‚</li></ul><p>è¿™æ ·åœ¨ä½  <code>dispatch</code> çš„æ—¶å€™ï¼Œè¾“å…¥å¯¹åº”çš„ <code>type</code>ï¼Œå°±è‡ªåŠ¨æç¤ºä½ å‰©ä½™çš„å‚æ•°ç±»å‹å•¦ã€‚</p><h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p>è¿™é‡Œä¸»è¦éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒuseEffect ä¼ å…¥çš„å‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼è¦ä¹ˆæ˜¯ä¸€ä¸ª<strong>æ–¹æ³•</strong>ï¼ˆæ¸…ç†å‡½æ•°ï¼‰ï¼Œè¦ä¹ˆå°±æ˜¯<strong>undefined</strong>ï¼Œå…¶ä»–æƒ…å†µéƒ½ä¼šæŠ¥é”™ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªæƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬çš„ useEffect éœ€è¦æ‰§è¡Œä¸€ä¸ª async å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><pre><code class="hljs ts"><span class="hljs-comment">// âŒ </span><span class="hljs-comment">// Type 'Promise&lt;void&gt;' provides no match </span><span class="hljs-comment">// for the signature '(): void | undefined'</span>useEffect(<span class="hljs-keyword">async</span> () =&gt; &#123;  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> getUser()  setUser(user)&#125;, [])</code></pre><p>è™½ç„¶æ²¡æœ‰åœ¨ async å‡½æ•°é‡Œæ˜¾å¼çš„è¿”å›å€¼ï¼Œä½†æ˜¯ async å‡½æ•°é»˜è®¤ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œè¿™ä¼šå¯¼è‡´ TS çš„æŠ¥é”™ã€‚</p><p>æ¨èè¿™æ ·æ”¹å†™ï¼š</p><pre><code class="hljs ts">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  <span class="hljs-keyword">const</span> getUser = <span class="hljs-keyword">async</span> () =&gt; &#123;    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> getUser()    setUser(user)  &#125;  getUser()&#125;, [])</code></pre><p>æˆ–è€…ç”¨è‡ªæ‰§è¡Œå‡½æ•°ï¼Ÿä¸æ¨èï¼Œå¯è¯»æ€§ä¸å¥½ã€‚</p><pre><code class="hljs ts">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  (<span class="hljs-keyword">async</span> () =&gt; &#123;    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> getUser()    setUser(user)  &#125;)()&#125;, [])</code></pre><h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p>è¿™ä¸ª Hook åœ¨å¾ˆå¤šæ—¶å€™æ˜¯æ²¡æœ‰åˆå§‹å€¼çš„ï¼Œè¿™æ ·å¯ä»¥å£°æ˜è¿”å›å¯¹è±¡ä¸­ <code>current</code> å±æ€§çš„ç±»å‹ï¼š</p><pre><code class="hljs ts"><span class="hljs-keyword">const</span> ref2 = useRef&lt;HTMLElement&gt;(<span class="hljs-literal">null</span>);</code></pre><p>ä»¥ä¸€ä¸ªæŒ‰é’®åœºæ™¯ä¸ºä¾‹ï¼š</p><pre><code class="hljs ts"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TextInputWithFocusButton</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">const</span> inputEl = React.useRef&lt;HTMLInputElement&gt;(<span class="hljs-literal">null</span>);  <span class="hljs-keyword">const</span> onButtonClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    <span class="hljs-keyword">if</span> (inputEl &amp;&amp; inputEl.current) &#123;      inputEl.current.focus();    &#125;  &#125;;  <span class="hljs-keyword">return</span> (    &lt;&gt;      &lt;input ref=&#123;inputEl&#125; <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> /&gt;      &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;<span class="hljs-regexp">/button&gt;</span><span class="hljs-regexp">    &lt;/</span>&gt;  );&#125;</code></pre><p>å½“ <code>onButtonClick</code> äº‹ä»¶è§¦å‘æ—¶ï¼Œå¯ä»¥è‚¯å®š <code>inputEl</code> ä¹Ÿæ˜¯æœ‰å€¼çš„ï¼Œå› ä¸ºç»„ä»¶æ˜¯åŒçº§åˆ«æ¸²æŸ“çš„ï¼Œä½†æ˜¯è¿˜æ˜¯ä¾ç„¶è¦åšå†—ä½™çš„éç©ºåˆ¤æ–­ã€‚</p><p>æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç»•è¿‡å»ã€‚</p><pre><code class="hljs ts"><span class="hljs-keyword">const</span> ref1 = useRef&lt;HTMLElement&gt;(<span class="hljs-literal">null</span>!);</code></pre><p><code>null!</code> è¿™ç§è¯­æ³•æ˜¯éç©ºæ–­è¨€ï¼Œè·Ÿåœ¨ä¸€ä¸ªå€¼åé¢è¡¨ç¤ºä½ æ–­å®šå®ƒæ˜¯æœ‰å€¼çš„ï¼Œæ‰€ä»¥åœ¨ä½ ä½¿ç”¨ <code>inputEl.current.focus()</code> çš„æ—¶å€™ï¼ŒTS ä¸ä¼šç»™å‡ºæŠ¥é”™ã€‚</p><p>ä½†æ˜¯è¿™ç§è¯­æ³•æ¯”è¾ƒå±é™©ï¼Œéœ€è¦å°½é‡å‡å°‘ä½¿ç”¨ã€‚</p><p>åœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ<code>inputEl.current?.focus()</code> æ˜¯ä¸ªæ›´å®‰å…¨çš„é€‰æ‹©ï¼Œé™¤éè¿™ä¸ªå€¼<strong>çœŸçš„ä¸å¯èƒ½</strong>ä¸ºç©ºã€‚ï¼ˆæ¯”å¦‚åœ¨ä½¿ç”¨ä¹‹å‰å°±èµ‹å€¼äº†ï¼‰</p><h3 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h3><p>æ¨èä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>innerRef</code> æ¥ä»£æ›¿åŸç”Ÿçš„ <code>ref</code>ï¼Œå¦åˆ™è¦ç”¨åˆ° <code>forwardRef</code> ä¼šæçš„ç±»å‹å¾ˆå¤æ‚ã€‚</p><pre><code class="hljs ts"><span class="hljs-keyword">type</span> ListProps = &#123;  innerRef?: React.Ref&lt;&#123; scrollToTop(): <span class="hljs-built_in">void</span> &#125;&gt;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">List</span>(<span class="hljs-params">props: ListProps</span>) </span>&#123;  useImperativeHandle(props.innerRef, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> (&#123;    scrollToTop() &#123; &#125;  &#125;))  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>&#125;</code></pre><p>ç»“åˆåˆšåˆš <code>useRef</code> çš„çŸ¥è¯†ï¼Œä½¿ç”¨æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="hljs ts"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Use</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">const</span> listRef = useRef&lt;&#123; scrollToTop(): <span class="hljs-built_in">void</span> &#125;&gt;(<span class="hljs-literal">null</span>!)  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    listRef.current.scrollToTop()  &#125;, [])  <span class="hljs-keyword">return</span> (    &lt;List innerRef=&#123;listRef&#125; /&gt;  )&#125;</code></pre><p>å¾ˆå®Œç¾ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿ</p><p>å¯ä»¥åœ¨çº¿è°ƒè¯• <a href="https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBAKjgQwM5wEoFNkGN4BmUEIcA5FDvmQNwCwAUKJLHAN5wCuqWAyjMhhYANFx4BRAgSz5R3LNgJyeASXBYog4ADcsACWQA7ACYAbLHAC+cIiXKU8MWo0YwAnmAsAZYKhgAFYjB0AF52Rjg4YENDDUUAfgAuTCoYADpFAB4OVFxiU1MAFQhisAAKAEpk7QhgYysAPkZLFwYCTkN8YAhDOB8-MrAg1GT+gOGK8IZI+TVPTRgdfSMzLEHhtOjYqEVRSrgQhrgytgjIuFz8opKIcsmOFumrCoqzyhhOKF7DTgLm1vanUWPTgAFUePtTk9cD0-HBTL4YIoDmIFFgCNkLnkIAViqVKtVavVLA0yj8CgBCV4MM7ySTSfBlfaHKbneGIxRpXCfSiGdKXHHXfHUyKWUQAbQAutS3lgPl9jmdIpkxlEYnF0SE2Ai-IprAB6JpPamWIA" target="_blank" rel="noopener">useImperativeHandle çš„ä¾‹å­</a>ã€‚</p><p>ä¹Ÿå¯ä»¥æŸ¥çœ‹è¿™ä¸ª<a href="https://github.com/typescript-cheatsheets/react/issues/106" target="_blank" rel="noopener">useImperativeHandle è®¨è®º Issue</a>ï¼Œé‡Œé¢æœ‰å¾ˆå¤šæœ‰æ„æ€çš„æƒ³æ³•ï¼Œä¹Ÿæœ‰ä½¿ç”¨ React.forwardRef çš„å¤æ‚ä¾‹å­ã€‚</p><h3 id="è‡ªå®šä¹‰-Hook"><a href="#è‡ªå®šä¹‰-Hook" class="headerlink" title="è‡ªå®šä¹‰ Hook"></a>è‡ªå®šä¹‰ Hook</h3><p>å¦‚æœä½ æƒ³ä»¿ç…§ useState çš„å½¢å¼ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œä¸€å®šè¦è®°å¾—åœ¨é€‚å½“çš„æ—¶å€™ä½¿ç”¨ <code>as const</code>ï¼Œæ ‡è®°è¿™ä¸ªè¿”å›å€¼æ˜¯ä¸ªå¸¸é‡ï¼Œå‘Šè¯‰ TS æ•°ç»„é‡Œçš„å€¼ä¸ä¼šåˆ é™¤ï¼Œæ”¹å˜é¡ºåºç­‰ç­‰â€¦â€¦</p><p>å¦åˆ™ï¼Œä½ çš„æ¯ä¸€é¡¹éƒ½ä¼šè¢«æ¨æ–­æˆæ˜¯ã€Œæ‰€æœ‰ç±»å‹å¯èƒ½æ€§çš„è”åˆç±»å‹ã€ï¼Œè¿™ä¼šå½±å“ç”¨æˆ·ä½¿ç”¨ã€‚</p><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useLoading</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">const</span> [isLoading, setState] = React.useState(<span class="hljs-literal">false</span>);  <span class="hljs-keyword">const</span> load = <span class="hljs-function">(<span class="hljs-params">aPromise: <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> &#123;    setState(<span class="hljs-literal">true</span>);    <span class="hljs-keyword">return</span> aPromise.finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> setState(<span class="hljs-literal">false</span>));  &#125;;  <span class="hljs-comment">// âœ… åŠ äº† as const ä¼šæ¨æ–­å‡º [boolean, typeof load]</span>  <span class="hljs-comment">// âŒ å¦åˆ™ä¼šæ˜¯ (boolean | typeof load)[]</span>  <span class="hljs-keyword">return</span> [isLoading, load] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;[]&#125;</code></pre><p>å¯¹äº†ï¼Œå¦‚æœä½ åœ¨ç”¨ React Hook å†™ä¸€ä¸ªåº“ï¼Œåˆ«å¿˜äº†æŠŠç±»å‹ä¹Ÿå¯¼å‡ºç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p><h2 id="React-API"><a href="#React-API" class="headerlink" title="React API"></a>React API</h2><h3 id="forwardRef"><a href="#forwardRef" class="headerlink" title="forwardRef"></a>forwardRef</h3><p>å‡½æ•°å¼ç»„ä»¶é»˜è®¤ä¸å¯ä»¥åŠ  refï¼Œå®ƒä¸åƒç±»ç»„ä»¶é‚£æ ·æœ‰è‡ªå·±çš„å®ä¾‹ã€‚è¿™ä¸ª API ä¸€èˆ¬æ˜¯å‡½æ•°å¼ç»„ä»¶ç”¨æ¥æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„ refã€‚</p><p>æ‰€ä»¥éœ€è¦æ ‡æ³¨å¥½å®ä¾‹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯çˆ¶ç»„ä»¶é€šè¿‡ ref å¯ä»¥æ‹¿åˆ°ä»€ä¹ˆæ ·ç±»å‹çš„å€¼ã€‚</p><pre><code class="hljs ts"><span class="hljs-keyword">type</span> Props = &#123; &#125;;<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Ref = HTMLButtonElement;<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> FancyButton = React.forwardRef&lt;Ref, Props&gt;<span class="hljs-function">(<span class="hljs-params">(<span class="hljs-params">props, ref</span>) =&gt; (<span class="hljs-params"></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">  &lt;button ref=&#123;ref&#125; className="MyClassName"&gt;</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">    &#123;props.children&#125;</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">  &lt;/button&gt;</span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"></span>)</span>);</span></code></pre><p>ç”±äºè¿™ä¸ªä¾‹å­é‡Œç›´æ¥æŠŠ ref è½¬å‘ç»™ button äº†ï¼Œæ‰€ä»¥ç›´æ¥æŠŠç±»å‹æ ‡æ³¨ä¸º <code>HTMLButtonElement</code> å³å¯ã€‚</p><p>çˆ¶ç»„ä»¶è¿™æ ·è°ƒç”¨ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ­£ç¡®ç±»å‹ï¼š</p><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> App = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  <span class="hljs-keyword">const</span> ref = useRef&lt;HTMLButtonElement&gt;()  <span class="hljs-keyword">return</span> (    &lt;FancyButton ref=&#123;ref&#125; /&gt;  )&#125;</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»react hooksâ€œé—­åŒ…é™·é˜±â€åˆ‡å…¥ï¼Œæµ…è°ˆreact hooks</title>
    <link href="/2019-09-18-%E4%BB%8Ereact-hooks%E2%80%9C%E9%97%AD%E5%8C%85%E9%99%B7%E9%98%B1%E2%80%9D%E5%88%87%E5%85%A5%EF%BC%8C%E6%B5%85%E8%B0%88react-hooks/"/>
    <url>/2019-09-18-%E4%BB%8Ereact-hooks%E2%80%9C%E9%97%AD%E5%8C%85%E9%99%B7%E9%98%B1%E2%80%9D%E5%88%87%E5%85%A5%EF%BC%8C%E6%B5%85%E8%B0%88react-hooks/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»react-hooksâ€œé—­åŒ…é™·é˜±â€åˆ‡å…¥ï¼Œæµ…è°ˆreact-hooks"><a href="#ä»react-hooksâ€œé—­åŒ…é™·é˜±â€åˆ‡å…¥ï¼Œæµ…è°ˆreact-hooks" class="headerlink" title="ä»react hooksâ€œé—­åŒ…é™·é˜±â€åˆ‡å…¥ï¼Œæµ…è°ˆreact hooks"></a>ä»react hooksâ€œé—­åŒ…é™·é˜±â€åˆ‡å…¥ï¼Œæµ…è°ˆreact hooks</h1><p>é¦–å…ˆï¼Œæœ¬æ–‡å¹¶ä¸ä¼šè®²è§£ hooks çš„åŸºæœ¬ç”¨æ³•ï¼Œ æœ¬æ–‡ä» ä¸€ä¸ªhooksä¸­ â€œå¥‡æ€ªâ€ï¼ˆå…¶å®ç¬¦åˆé€»è¾‘ï¼‰ çš„ â€œé—­åŒ…é™·é˜±â€ çš„åœºæ™¯åˆ‡å…¥ï¼Œè¯•å›¾è®²æ¸…æ¥šå…¶èƒŒåçš„å› æœã€‚åŒæ—¶ï¼Œåœ¨è®¸å¤š react hooks å¥‡æŠ€æ·«å·§çš„æ–‡ç« é‡Œï¼Œä¹Ÿèƒ½çœ‹åˆ° <code>useRef</code> çš„èº«å½±ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä½¿ç”¨ <code>useRef</code> åˆèƒ½æ‘†è„± è¿™ä¸ª â€œé—­åŒ…é™·é˜±â€ ï¼Ÿ æˆ‘æƒ³ææ¸…æ¥šè¿™äº›é—®é¢˜ï¼Œå°†èƒ½è¾ƒå¤§çš„æå‡å¯¹ react hooks çš„ç†è§£ã€‚</p><p>react hooks ä¸€å‡ºç°ä¾¿å—åˆ°äº†è®¸å¤šå¼€å‘äººå‘˜çš„è¿½æ§,æˆ–è®¸åœ¨ä½¿ç”¨react hooks çš„æ—¶å€™é‡åˆ° â€œé—­åŒ…é™·é˜±â€ æ˜¯æ¯ä¸ªå¼€å‘äººå‘˜åœ¨å¼€å‘çš„æ—¶å€™éƒ½é‡åˆ°è¿‡çš„äº‹æƒ…ï¼Œæœ‰çš„ä¸¤çœ¼æ‡µé€¼ã€æœ‰çš„åˆ™ç¨³å¦‚è€ç‹—ç¬é—´å°±å®šä¹‰åˆ°äº†é—®é¢˜å‡ºç°åœ¨ä½•å¤„ã€‚</p><p>(ä»¥ä¸‹reactç¤ºèŒƒdemoï¼Œå‡ä¸ºreact 16.8.3 ç‰ˆæœ¬)</p><p>ä½ ä¸€å®šé­é‡è¿‡ä»¥ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-keyword">const</span> [count, setCount] = useState(<span class="hljs-number">1</span>);    useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;        setInterval(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;            <span class="hljs-built_in">console</span>.log(count)        &#125;, <span class="hljs-number">1000</span>)    &#125;, [])&#125;</code></pre><p>åœ¨è¿™ä¸ªå®šæ—¶å™¨é‡Œé¢å»æ‰“å° <code>count</code> çš„å€¼ï¼Œä¼šå‘ç°ï¼Œä¸ç®¡åœ¨è¿™ä¸ªç»„ä»¶ä¸­çš„å…¶ä»–åœ°æ–¹ä½¿ç”¨ <code>setCount</code> å°† <code>count</code> è®¾ç½®ä¸ºä»»ä½•å€¼ï¼Œè¿˜æ˜¯è®¾ç½®å¤šå°‘æ¬¡ï¼Œæ‰“å°çš„éƒ½æ˜¯1ã€‚æ˜¯ä¸æ˜¯æœ‰ä¸€ç§ï¼Œå°½ç®¡å†ç»åƒå¸†ï¼Œæˆ‘è®°å¾—çš„è¿˜æ˜¯ä½ å½“åˆçš„æ¨¡æ ·çš„æ„Ÿè§‰ï¼Ÿ hhhâ€¦ æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å°½åŠ›çš„å°è¯•å°†æˆ‘ç†è§£çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ä¹ˆä¸ªæƒ…å†µè¯´æ¸…æ¥šï¼Œå¹¶ä¸”æµ…è°ˆä¸€äº›hookså…¶ä»–çš„ç‰¹æ€§ã€‚å¦‚æœæœ‰é”™è¯¯ï¼Œå¸Œæœ›å„ä½åŒå­¦èƒ½æ•‘æ•‘å­©å­ï¼Œä¸è¦è®©æˆ‘å¸¦ç€é”™è¯¯çš„è®¤çŸ¥æ´»ä¸‹å»äº†ã€‚ã€‚ã€‚</p><h2 id="1ã€ä¸€ä¸ªç†Ÿæ‚‰çš„é—­åŒ…åœºæ™¯"><a href="#1ã€ä¸€ä¸ªç†Ÿæ‚‰çš„é—­åŒ…åœºæ™¯" class="headerlink" title="1ã€ä¸€ä¸ªç†Ÿæ‚‰çš„é—­åŒ…åœºæ™¯"></a>1ã€ä¸€ä¸ªç†Ÿæ‚‰çš„é—­åŒ…åœºæ™¯</h2><p>é¦–å…ˆä»ä¸€ä¸ªå„ä½jseréƒ½å¾ˆç†Ÿæ‚‰çš„åœºæ™¯å…¥æ‰‹ã€‚</p><pre><code class="hljs js"><span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++ ) &#123;    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;        <span class="hljs-built_in">console</span>.log(i)    &#125;, <span class="hljs-number">0</span>)&#125;</code></pre><p>æƒ³å®å®æˆ‘åˆšåˆšæ¯•ä¸šçš„é‚£ä¸€å¹´ï¼Œè¿™é“é¢˜è¿˜æ˜¯ä¸€é“æœ‰äº›çƒ­é—¨çš„é¢è¯•é¢˜ç›®ã€‚è€Œå¦‚ä»Šâ€¦</p><p>æˆ‘å°±ä¸è¯´ä¸ºä»€ä¹ˆæœ€ç»ˆï¼Œæ‰“å°çš„éƒ½æ˜¯5çš„åŸå› äº†ã€‚ç›´æ¥è´´å‡ºä½¿ç”¨é—­åŒ…æ‰“å° 0â€¦4çš„ä»£ç ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++ ) &#123;   (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i</span>)</span>&#123;         setTimeout(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;            <span class="hljs-built_in">console</span>.log(i)        &#125;, <span class="hljs-number">0</span>)   &#125;)(i)&#125;</code></pre><p>è¿™ä¸ªåŸç†å…¶å®å°±æ˜¯ä½¿ç”¨é—­åŒ…ï¼Œå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°å»å¼•ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°é‡Œå®šä¹‰çš„å˜é‡ï¼Œå½¢æˆé—­åŒ…ä¿å­˜äº†ç«‹å³æ‰§è¡Œå‡½æ•°æ‰§è¡Œæ—¶ i çš„å€¼ï¼Œå¼‚æ­¥å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æ‰å¦‚æˆ‘ä»¬æƒ³è¦çš„æ‰“å°äº†é¡ºåºçš„å€¼ã€‚</p><p>å…¶å®ï¼Œ<code>useEffect</code> çš„å“ªä¸ªåœºæ™¯çš„åŸå› ï¼Œè·Ÿè¿™ä¸ªï¼Œç®€ç›´æ˜¯ä¸€æ ·çš„ï¼Œ<strong><code>useEffect</code> é—­åŒ…é™·é˜±åœºæ™¯çš„å‡ºç°ï¼Œæ˜¯ react ç»„ä»¶æ›´æ–°æµç¨‹ä»¥åŠ <code>useEffect</code> çš„å®ç°çš„è‡ªç„¶è€Œç„¶ç»“æœ</strong>ã€‚</p><h2 id="2-æµ…è°ˆhooksåŸç†ï¼Œç†è§£useEffect-çš„-â€œé—­åŒ…é™·é˜±â€-å‡ºç°åŸå› ã€‚"><a href="#2-æµ…è°ˆhooksåŸç†ï¼Œç†è§£useEffect-çš„-â€œé—­åŒ…é™·é˜±â€-å‡ºç°åŸå› ã€‚" class="headerlink" title="2 æµ…è°ˆhooksåŸç†ï¼Œç†è§£useEffect çš„ â€œé—­åŒ…é™·é˜±â€ å‡ºç°åŸå› ã€‚"></a>2 æµ…è°ˆhooksåŸç†ï¼Œç†è§£useEffect çš„ â€œé—­åŒ…é™·é˜±â€ å‡ºç°åŸå› ã€‚</h2><p>å…¶å®ï¼Œå¾ˆä¸æƒ³åœ¨å†™è¿™ç¯‡æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼Œç‰µæ‰¯åˆ°reactåŸç†è¿™æ–¹é¢çš„ä¸œè¥¿ï¼Œå› ä¸ºçœŸçš„æ˜¯å¤ªæ•´ä½“äº†ï¼ˆå…¶å®ä¸»è¦åŸå› æ˜¯èœï¼Œè‡ªå·±ä¹Ÿåªæ˜¯æŒæ¡çš„å›«å›µåæ£ï¼‰ï¼Œä½ è¦æ˜ç™½è¿™ä¸ªå¤§æ¦‚çš„è¿‡ç¨‹ï¼Œä½ å¾—æ˜ç™½æ”¯æ’‘èµ·è¿™ä¸ªå¤§æ¦‚çš„ä¸€äº›é‡è¦çš„ç‚¹ã€‚</p><p>é¦–å…ˆï¼Œå¯èƒ½éƒ½å¬è¿‡reactçš„ Fiber æ¶æ„ï¼Œå…¶å®ä¸€ä¸ª FiberèŠ‚ç‚¹å°±å¯¹åº”çš„æ˜¯ä¸€ä¸ªç»„ä»¶ã€‚å¯¹äº <code>classComponent</code> è€Œè¨€ï¼Œæœ‰ <code>state</code> æ˜¯ä¸€ä»¶å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼ŒFiberå¯¹è±¡ä¸Šæœ‰ä¸€ä¸ª <code>memoizedState</code> ç”¨äºå­˜æ”¾ç»„ä»¶çš„ <code>state</code>ã€‚okï¼Œç°åœ¨çœ‹ hooks æ‰€é’ˆå¯¹çš„ <code>FunctionComponnet</code>ã€‚ æ— è®ºå¼€å‘è€…æ€ä¹ˆæŠ˜è…¾ï¼Œä¸€ä¸ªå¯¹è±¡éƒ½åªèƒ½æœ‰ä¸€ä¸ª <code>state</code> å±æ€§æˆ–è€… <code>memoizedState</code> å±æ€§ï¼Œå¯æ˜¯ï¼Œè°çŸ¥é“å¯çˆ±çš„å¼€å‘è€…ä»¬ä¼šåœ¨ <code>FunctionComponent</code> é‡Œå†™ä¸Šå¤šå°‘ä¸ª <code>useState</code>ï¼Œ<code>useEffect</code> ç­‰ç­‰ ? æ‰€ä»¥ï¼Œreactç”¨äº†é“¾è¡¨è¿™ç§æ•°æ®ç»“æ„æ¥å­˜å‚¨ <code>FunctionComponent</code> é‡Œé¢çš„ hooksã€‚æ¯”å¦‚ï¼š</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-keyword">const</span> [count, setCount] = useState(<span class="hljs-number">1</span>)    <span class="hljs-keyword">const</span> [name, setName] = useState(<span class="hljs-string">'evanchen'</span>)    useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;            &#125;, [])    <span class="hljs-keyword">const</span> text = useMemo(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-string">'ddd'</span>    &#125;, [])&#125;</code></pre><p>åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸ªhookséƒ½åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡</p><pre><code class="hljs js">type Hook = &#123;  memoizedState: any,  baseState: any,  baseUpdate: Update&lt;any, any&gt; | <span class="hljs-literal">null</span>,  queue: UpdateQueue&lt;any, any&gt; | <span class="hljs-literal">null</span>,  next: Hook | <span class="hljs-literal">null</span>,&#125;;</code></pre><p>æœ€ç»ˆå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giuruksyyaj30h5024dg4.jpg" srcset="/img/loading.gif" alt="image-20200918140906399"></p><p>è¿™ä¸ªå¯¹è±¡çš„<code>memoizedState</code>å±æ€§å°±æ˜¯ç”¨æ¥å­˜å‚¨ç»„ä»¶ä¸Šä¸€æ¬¡æ›´æ–°åçš„ <code>state</code>,<code>next</code>æ¯«æ— ç–‘é—®æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªhookå¯¹è±¡ã€‚åœ¨ç»„ä»¶æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œhookså‡½æ•°æ‰§è¡Œçš„é¡ºåºæ˜¯ä¸å˜çš„ï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªé“¾è¡¨æ‹¿åˆ°å½“å‰hookså¯¹åº”çš„<code>Hook</code>å¯¹è±¡ï¼Œå‡½æ•°å¼ç»„ä»¶å°±æ˜¯è¿™æ ·æ‹¥æœ‰äº†stateçš„èƒ½åŠ›ã€‚å½“å‰ï¼Œå…·ä½“çš„å®ç°è‚¯å®šæ¯”è¿™ä¸‰è¨€ä¸¤è¯­å¤æ‚å¾ˆå¤šã€‚</p><p>æ‰€ä»¥ï¼ŒçŸ¥é“ä¸ºä»€ä¹ˆä¸èƒ½å°†hookså†™åˆ°if elseè¯­å¥ä¸­äº†æŠŠï¼Ÿå› ä¸ºè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´é¡ºåºé”™ä¹±ï¼Œå¯¼è‡´å½“å‰hooksæ‹¿åˆ°çš„ä¸æ˜¯è‡ªå·±å¯¹åº”çš„Hookå¯¹è±¡ã€‚</p><p><code>useEffect</code> æ¥æ”¶äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå›è°ƒå‡½æ•°å’Œä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„é‡Œé¢å°±æ˜¯ <code>useEffect</code> çš„ä¾èµ–ï¼Œå½“ä¸º [] çš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœæœ‰ä¾èµ–å…¶ä»–é¡¹ï¼Œreact ä¼šåˆ¤æ–­å…¶ä¾èµ–æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†å°±ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚è¯´å›æœ€åˆçš„åœºæ™¯ï¼š</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-keyword">const</span> [count, setCount] = useState(<span class="hljs-number">1</span>);    useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;        setInterval(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;            <span class="hljs-built_in">console</span>.log(count)        &#125;, <span class="hljs-number">1000</span>)    &#125;, [])    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">click</span>(<span class="hljs-params"></span>)</span>&#123; setCount(<span class="hljs-number">2</span>) &#125;&#125;</code></pre><p>å¥½ï¼Œå¼€åŠ¨è„‘è¢‹å¼€å§‹æƒ³è±¡èµ·æ¥ï¼Œç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œ <code>App()</code>ï¼Œæ‰§è¡Œ <code>useState</code> è®¾ç½®äº†åˆå§‹çŠ¶æ€ä¸º1ï¼Œæ‰€ä»¥æ­¤æ—¶çš„ <code>count</code> ä¸º1ã€‚ç„¶åæ‰§è¡Œäº† <code>useEffect</code>ï¼Œå›è°ƒå‡½æ•°æ‰§è¡Œï¼Œè®¾ç½®äº†ä¸€ä¸ªå®šæ—¶å™¨æ¯éš” 1s æ‰“å°ä¸€æ¬¡ <code>count</code>ã€‚</p><p>æ¥ç€æƒ³è±¡å¦‚æœ <code>click</code> å‡½æ•°è¢«è§¦å‘äº†ï¼Œè°ƒç”¨ <code>setCount(2)</code> è‚¯å®šä¼šè§¦å‘reactçš„æ›´æ–°ï¼Œæ›´æ–°åˆ°å½“å‰ç»„ä»¶çš„æ—¶å€™ä¹Ÿæ˜¯æ‰§è¡Œ <code>App()</code>ï¼Œä¹‹å‰è¯´çš„é“¾è¡¨å·²ç»å½¢æˆäº†å“ˆï¼Œæ­¤æ—¶ <code>useState</code> å°† <code>Hook</code> å¯¹è±¡ ä¸Šä¿å­˜çš„çŠ¶æ€ç½®ä¸º2ï¼Œ é‚£ä¹ˆæ­¤æ—¶ <code>count</code> ä¹Ÿä¸º2äº†ã€‚ç„¶ååœ¨æ‰§è¡Œ <code>useEffect</code> ç”±äºä¾èµ–æ•°ç»„æ˜¯ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œæ‰€ä»¥æ­¤æ—¶å›è°ƒå¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>okï¼Œè¿™æ¬¡æ›´æ–°çš„è¿‡ç¨‹ä¸­æ ¹æœ¬å°±æ²¡æœ‰æ¶‰åŠåˆ°è¿™ä¸ªå®šæ—¶å™¨ï¼Œè¿™ä¸ªå®šæ—¶å™¨è¿˜åœ¨åšæŒçš„ï¼Œé»˜é»˜çš„ï¼Œæ¯éš”1sæ‰“å°ä¸€æ¬¡ <code>count</code>ã€‚ æ³¨æ„è¿™é‡Œæ‰“å°çš„ <code>count</code> ï¼Œæ˜¯ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ <code>App()</code> æ—¶çš„ <code>count</code>ï¼Œ <code>count</code>çš„å€¼ä¸º1ï¼Œ<strong>å› ä¸ºåœ¨å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°é‡Œé¢è¢«å¼•ç”¨äº†ï¼Œå½¢æˆäº†é—­åŒ…ä¸€ç›´è¢«ä¿å­˜</strong>ã€‚</p><h2 id="2-éš¾é“çœŸçš„è¦åœ¨ä¾èµ–æ•°ç»„é‡Œå†™ä¸Šçš„å€¼ï¼Œæ‰èƒ½æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ"><a href="#2-éš¾é“çœŸçš„è¦åœ¨ä¾èµ–æ•°ç»„é‡Œå†™ä¸Šçš„å€¼ï¼Œæ‰èƒ½æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ" class="headerlink" title="2 éš¾é“çœŸçš„è¦åœ¨ä¾èµ–æ•°ç»„é‡Œå†™ä¸Šçš„å€¼ï¼Œæ‰èƒ½æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ"></a>2 éš¾é“çœŸçš„è¦åœ¨ä¾èµ–æ•°ç»„é‡Œå†™ä¸Šçš„å€¼ï¼Œæ‰èƒ½æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ</h2><p>ä»¿ä½›éƒ½ä¹ æƒ¯æ€§éƒ½å»è®¤ä¸ºï¼Œåªæœ‰åœ¨ä¾èµ–æ•°ç»„é‡Œå†™ä¸Šæˆ‘ä»¬æ‰€éœ€è¦çš„å€¼ï¼Œæ‰èƒ½åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­æ‹¿åˆ°æœ€æ–°é²œçš„å€¼ã€‚é‚£ä¹ˆçœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Demo1</span> /&gt;</span></span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Demo1</span>(<span class="hljs-params"></span>)</span>&#123;  <span class="hljs-keyword">const</span> [num1, setNum1] = useState(<span class="hljs-number">1</span>)  <span class="hljs-keyword">const</span> [num2, setNum2] = useState(<span class="hljs-number">10</span>)  <span class="hljs-keyword">const</span> text = useMemo(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-string">`num1: <span class="hljs-subst">$&#123;num1&#125;</span> | num2:<span class="hljs-subst">$&#123;num2&#125;</span>`</span>  &#125;, [num2])  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handClick</span>(<span class="hljs-params"></span>)</span>&#123;    setNum1(<span class="hljs-number">2</span>)    setNum2(<span class="hljs-number">20</span>)  &#125;  <span class="hljs-keyword">return</span> (    &lt;div&gt;      &#123;text&#125;      &lt;div&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handClick&#125;</span>&gt;</span>click!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>&lt;<span class="hljs-regexp">/div&gt;</span><span class="hljs-regexp">    &lt;/</span>div&gt;  )&#125;</code></pre><p><code>text</code> æ˜¯ä¸€ä¸ª <code>useMemo</code> ï¼Œå®ƒçš„ä¾èµ–æ•°ç»„é‡Œé¢åªæœ‰num2ï¼Œæ²¡æœ‰num1ï¼Œå´åŒæ—¶ä½¿ç”¨äº†è¿™ä¸¤ä¸ªstateã€‚å½“ç‚¹å‡»button çš„æ—¶å€™ï¼Œnum1å’Œnum2çš„å€¼éƒ½æ”¹å˜äº†ã€‚é‚£ä¹ˆï¼Œåªå†™æ˜äº†ä¾èµ–num2çš„ text ä¸­èƒ½å¦æ‹¿åˆ° num1 æœ€æ–°é²œçš„å€¼å‘¢ï¼Ÿ</p><p>å¦‚æœä½ è£…äº† <code>react</code> çš„ eslint æ’ä»¶ï¼Œè¿™é‡Œä¹Ÿè®¸ä¼šæç¤ºä½ é”™è¯¯ï¼Œå› ä¸ºåœ¨textä¸­ä½ ä½¿ç”¨äº† num1 å´æ²¡æœ‰åœ¨ä¾èµ–æ•°ç»„ä¸­æ·»åŠ å®ƒã€‚ ä½†æ˜¯æ‰§è¡Œè¿™æ®µä»£ç ä¼šå‘ç°ï¼Œæ˜¯å¯ä»¥æ­£å¸¸æ‹¿åˆ°num1æœ€æ–°é²œçš„å€¼çš„ã€‚</p><p>å¦‚æœç†è§£äº†ä¹‹å‰ç¬¬ä¸€ç‚¹è¯´çš„â€œé—­åŒ…é™·é˜±â€é—®é¢˜ï¼Œè‚¯å®šä¹Ÿèƒ½ç†è§£è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Œå†è¯´ä¸€éï¼Œè¿™ä¸ªä¾èµ–æ•°ç»„å­˜åœ¨çš„æ„ä¹‰ï¼Œæ˜¯reactä¸ºäº†åˆ¤å®šï¼Œåœ¨<strong>æœ¬æ¬¡æ›´æ–°</strong>ä¸­ï¼Œæ˜¯å¦éœ€è¦æ‰§è¡Œå…¶ä¸­çš„å›è°ƒå‡½æ•°ï¼Œè¿™é‡Œä¾èµ–äº†çš„num2ï¼Œè€Œnum2æ”¹å˜äº†ã€‚å›è°ƒå‡½æ•°è‡ªç„¶ä¼šæ‰§è¡Œï¼Œ è¿™æ—¶å½¢æˆçš„é—­åŒ…å¼•ç”¨çš„å°±æ˜¯æœ€æ–°çš„num1å’Œnum2ï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶èƒ½å¤Ÿæ‹¿åˆ°æ–°é²œçš„å€¼ã€‚é—®é¢˜çš„å…³é”®ï¼Œåœ¨äºå›è°ƒå‡½æ•°æ‰§è¡Œçš„æ—¶æœºï¼Œé—­åŒ…å°±åƒæ˜¯ä¸€ä¸ªç…§ç›¸æœºï¼ŒæŠŠå›è°ƒå‡½æ•°æ‰§è¡Œçš„é‚£ä¸ªæ—¶æœºçš„é‚£äº›å€¼ä¿å­˜äº†ä¸‹æ¥ã€‚ä¹‹å‰è¯´çš„å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æˆ‘æƒ³å°±åƒæ˜¯ä¸€ä¸ªä»1000å¹´å‰ç©¿è¶Šåˆ°ç°ä»£çš„äººï¼Œè™½ç„¶æ¥åˆ°äº†ç°ä»£ï¼Œä½†æ˜¯èº«ä¸Šçš„è¡€æ¶²ã€å¤´å‘éƒ½æ˜¯1000å¹´å‰çš„ã€‚</p><h2 id="3-ä¸ºä»€ä¹ˆä½¿ç”¨useRefèƒ½å¤Ÿæ¯æ¬¡æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆä½¿ç”¨useRefèƒ½å¤Ÿæ¯æ¬¡æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ" class="headerlink" title="3 ä¸ºä»€ä¹ˆä½¿ç”¨useRefèƒ½å¤Ÿæ¯æ¬¡æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ"></a>3 ä¸ºä»€ä¹ˆä½¿ç”¨useRefèƒ½å¤Ÿæ¯æ¬¡æ‹¿åˆ°æ–°é²œçš„å€¼ï¼Ÿ</h2><p>å¤§ç™½è¯è¯´ï¼šå› ä¸ºåˆå§‹åŒ–çš„ <code>useRef</code> æ‰§è¡Œä¹‹åï¼Œè¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚å†™åˆ°è¿™é‡Œå®å®åˆä¸ç¦å›å¿†èµ·åˆšå­¦jsé‚£ä¼šå„¿ï¼Œæ§ç€çº¢å®ä¹¦å•ƒæ—¶å€™çš„åœºæ™¯äº†ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> A = &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'evanchen'</span>&#125;<span class="hljs-keyword">var</span> B = AB.name = <span class="hljs-string">'baobao'</span><span class="hljs-built_in">console</span>.log(A.name) <span class="hljs-comment">// baobao</span></code></pre><p>å¯¹ï¼Œè¿™å°±æ˜¯è¿™ä¸ªåœºæ™¯æˆç«‹çš„æœ€æ ¹æœ¬åŸå› ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç»„ä»¶æ¯ä¸€æ¬¡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ã€‚ æ¯”å¦‚ <code>ref = useRef()</code> æ‰€è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ¯æ¬¡ç»„ä»¶æ›´æ–°æ‰€ç”Ÿæˆçš„<code>ref</code>æŒ‡å‘çš„éƒ½æ˜¯åŒä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œ é‚£ä¹ˆå½“ç„¶èƒ½å¤Ÿæ¯æ¬¡éƒ½æ‹¿åˆ°æœ€æ–°é²œçš„å€¼äº†ã€‚çŠ¬å¤œå‰çœ‹è¿‡æŠŠï¼Ÿä¸€å£å¤äº•è¿æ¥äº†ç°ä»£ä¸–ç•Œä¸500å¹´å‰çš„æˆ˜å›½æ—¶ä»£ï¼Œè¿™ä¸ªåŒä¸€ä¸ªå¯¹è±¡ä¹Ÿå°†è¿™äº›ä¸ªè¢«ä¿å­˜äºä¸åŒé—­åŒ…æ—¶æœºçš„å˜é‡äº†è”ç³»äº†èµ·æ¥ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ªä¾‹å­æˆ–è®¸å¥½ç†è§£ä¸€ç‚¹ï¼š</p><pre><code class="hljs js">   <span class="hljs-comment">/* å°†è¿™äº›ç›¸å…³çš„å˜é‡å†™åœ¨å‡½æ•°å¤– ä»¥æ¨¡æ‹Ÿreact hookså¯¹åº”çš„å¯¹è±¡ */</span><span class="hljs-keyword">let</span> isC = <span class="hljs-literal">false</span><span class="hljs-keyword">let</span> isInit = <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ¨¡æ‹Ÿç»„ä»¶ç¬¬ä¸€æ¬¡åŠ è½½</span><span class="hljs-keyword">let</span> ref = &#123;current: <span class="hljs-literal">null</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useEffect</span>(<span class="hljs-params">cb</span>)</span>&#123;<span class="hljs-comment">// è¿™é‡Œç”¨æ¥æ¨¡æ‹Ÿ useEffect ä¾èµ–ä¸º [] çš„æ—¶å€™åªæ‰§è¡Œä¸€æ¬¡ã€‚</span><span class="hljs-keyword">if</span> (isC) <span class="hljs-keyword">return</span>isC = <span class="hljs-literal">true</span>cb()&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useRef</span>(<span class="hljs-params">value</span>)</span>&#123;<span class="hljs-comment">// ç»„ä»¶æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½çš„è¯è®¾ç½®å€¼ å¦åˆ™ç›´æ¥è¿”å›å¯¹è±¡</span><span class="hljs-keyword">if</span> ( isInit ) &#123;ref.current = valueisInit = <span class="hljs-literal">false</span>&#125;<span class="hljs-keyword">return</span> ref&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">let</span> ref_ = useRef(<span class="hljs-number">1</span>)ref_.current++useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;setInterval(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;<span class="hljs-built_in">console</span>.log(ref.current) <span class="hljs-comment">// 3</span>&#125;, <span class="hljs-number">2000</span>)&#125;)&#125;<span class="hljs-comment">// è¿ç»­æ‰§è¡Œä¸¤æ¬¡ ç¬¬ä¸€æ¬¡ç»„ä»¶åŠ è½½ ç¬¬äºŒæ¬¡ç»„ä»¶æ›´æ–°</span>App()App()</code></pre><p>æ‰€ä»¥ï¼Œæå‡ºä¸€ä¸ªåˆç†çš„è®¾æƒ³ã€‚åªè¦æˆ‘ä»¬èƒ½ä¿è¯æ¯æ¬¡ç»„ä»¶æ›´æ–°çš„æ—¶å€™ï¼Œ<code>useState</code> è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„è¯ï¼Ÿæˆ‘ä»¬ä¹Ÿèƒ½ç»•å¼€é—­åŒ…é™·é˜±è¿™ä¸ªæƒ…æ™¯å—ï¼Ÿ è¯•ä¸€ä¸‹å§ã€‚</p><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">// return &lt;Demo1 /&gt;</span>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Demo2</span> /&gt;</span></span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Demo2</span>(<span class="hljs-params"></span>)</span>&#123;  <span class="hljs-keyword">const</span> [obj, setObj] = useState(&#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'evanchen'</span>&#125;)  useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;    setInterval(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>&#123;      <span class="hljs-built_in">console</span>.log(obj)    &#125;, <span class="hljs-number">2000</span>)  &#125;, [])    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handClick</span>(<span class="hljs-params"></span>)</span>&#123;    setObj(<span class="hljs-function">(<span class="hljs-params">prevState</span>)=&gt;</span> &#123;      <span class="hljs-keyword">var</span> nowObj = <span class="hljs-built_in">Object</span>.assign(prevState, &#123;        name: <span class="hljs-string">'baobao'</span>,        age: <span class="hljs-number">24</span>      &#125;)      <span class="hljs-built_in">console</span>.log(nowObj == prevState)      <span class="hljs-keyword">return</span> nowObj    &#125;)  &#125;  <span class="hljs-keyword">return</span> (    &lt;div&gt;      &lt;div&gt;        &lt;span&gt;name: &#123;obj.name&#125; | age: &#123;obj.age&#125;&lt;<span class="hljs-regexp">/span&gt;</span><span class="hljs-regexp">        &lt;div&gt;&lt;button onClick=&#123;handClick&#125;&gt;click!&lt;/</span>button&gt;&lt;<span class="hljs-regexp">/div&gt;</span><span class="hljs-regexp">      &lt;/</span>div&gt;    &lt;<span class="hljs-regexp">/div&gt;</span><span class="hljs-regexp">  )</span><span class="hljs-regexp">&#125;</span></code></pre><p>ç®€å•è¯´ä¸‹è¿™æ®µä»£ç ï¼Œåœ¨æ‰§è¡Œ <code>setObj</code> çš„æ—¶å€™ï¼Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ç§ç”¨æ³•å°±ä¸ç”¨æˆ‘å¤šè¯´äº†æŠŠï¼Ÿç„¶å <code>Object.assign</code> è¿”å›çš„å°±æ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚æ€»å„¿è¨€ä¹‹ï¼Œå°±æ˜¯åœ¨è®¾ç½®çš„æ—¶å€™è¿”å›äº†åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p>æ‰§è¡Œè¿™æ®µä»£ç å‘ç°ï¼Œç¡®å®ç‚¹å‡»buttonåï¼Œå®šæ—¶å™¨æ‰“å°çš„å€¼ä¹Ÿå˜æˆäº†ï¼š</p><pre><code class="hljs js">&#123;    name: <span class="hljs-string">'baobao'</span>,    age: <span class="hljs-number">24</span> &#125;</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>react</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TypeScriptä¸­çš„typeå’ŒinterfaceåŒºåˆ«</title>
    <link href="/2019-09-03-TypeScript%E4%B8%AD%E7%9A%84type%E5%92%8Cinterface%E5%8C%BA%E5%88%AB/"/>
    <url>/2019-09-03-TypeScript%E4%B8%AD%E7%9A%84type%E5%92%8Cinterface%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¥å£VSç±»å‹"><a href="#æ¥å£VSç±»å‹" class="headerlink" title="æ¥å£VSç±»å‹"></a>æ¥å£VSç±»å‹</h1><p>å¤§å®¶ä½¿ç”¨typescriptæ€»ä¼šä½¿ç”¨åˆ°æ¥å£å’Œç±»å‹ï¼Œ<a href="https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md" target="_blank" rel="noopener">å®˜æ–¹è§„èŒƒ</a>ç¨å¾®è¯´äº†ä¸‹ä¸¤è€…çš„åŒºåˆ«</p><blockquote><ul><li>å¯ä»¥åœ¨extendæˆ–Implementså­å¥ä¸­å‘½åæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ä¸ºå¯¹è±¡ç±»å‹æ–‡å­—æä¾›ç±»å‹åˆ«åã€‚</li><li>ä¸€ä¸ªæ¥å£å¯ä»¥å…·æœ‰å¤šä¸ªåˆå¹¶çš„å£°æ˜ï¼Œä½†æ˜¯å¯¹è±¡ç±»å‹æ–‡å­—çš„ç±»å‹åˆ«åä¸èƒ½<br>ã€‚</li></ul></blockquote><p>æ˜äººä¸è¯´æš—è¯ï¼Œç›´æ¥ä¸ŠåŒºåˆ«ã€‚</p><h2 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h2><h3 id="éƒ½å¯ä»¥æè¿°ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°"><a href="#éƒ½å¯ä»¥æè¿°ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°" class="headerlink" title="éƒ½å¯ä»¥æè¿°ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°"></a>éƒ½å¯ä»¥æè¿°ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°</h3><h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> User &#123;  name: <span class="hljs-built_in">string</span>  age: <span class="hljs-built_in">number</span>&#125;<span class="hljs-keyword">interface</span> SetUser &#123;  (name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;&#125;</code></pre><h4 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h4><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> User = &#123;  name: <span class="hljs-built_in">string</span>  age: <span class="hljs-built_in">number</span>&#125;;<span class="hljs-keyword">type</span> SetUser = (name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;</code></pre><h3 id="æ‰©å±•ï¼ˆextendsï¼‰ä¸äº¤å‰ç±»å‹ï¼ˆIntersection-Typesï¼‰"><a href="#æ‰©å±•ï¼ˆextendsï¼‰ä¸äº¤å‰ç±»å‹ï¼ˆIntersection-Typesï¼‰" class="headerlink" title="æ‰©å±•ï¼ˆextendsï¼‰ä¸äº¤å‰ç±»å‹ï¼ˆIntersection Typesï¼‰"></a>æ‰©å±•ï¼ˆextendsï¼‰ä¸äº¤å‰ç±»å‹ï¼ˆIntersection Typesï¼‰</h3><p>interfaceå¯ä»¥æ‰©å±•ï¼Œä½†ç±»å‹æ˜¯å¯ä»¥æ‰©å±•å’Œå®ç°çš„ï¼Œ<strong>ä½†æ˜¯ç±»å‹ç¼ºå¯ä»¥é€šè¿‡äº¤å‰ç±»å‹å®ç°interfaceçš„extendè¡Œä¸º</strong>ï¼Œå¹¶ä¸”å½¼æ­¤æ— å…³ç›¸äº’ç‹¬ç«‹çš„ï¼Œåˆ™interfaceå¯ä»¥æ‰©å±•ç±»å‹ï¼Œç±»å‹ä¹Ÿå¯ä»¥ä¸æ¥å£ç±»å‹äº¤å‰ã€‚</p><p><strong>è™½ç„¶æ•ˆæœå·®ä¸å¤šï¼Œä½†æ˜¯æŸäº›è¯­æ³•ä¸åŒ</strong>ã€‚</p><h4 id="æ¥å£æ‰©å±•æ¥å£"><a href="#æ¥å£æ‰©å±•æ¥å£" class="headerlink" title="æ¥å£æ‰©å±•æ¥å£"></a>æ¥å£æ‰©å±•æ¥å£</h4><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> Name &#123;   name: <span class="hljs-built_in">string</span>; &#125;<span class="hljs-keyword">interface</span> User <span class="hljs-keyword">extends</span> Name &#123;   age: <span class="hljs-built_in">number</span>; &#125;</code></pre><h4 id="ç±»å‹ä¸ç±»å‹äº¤å‰"><a href="#ç±»å‹ä¸ç±»å‹äº¤å‰" class="headerlink" title="ç±»å‹ä¸ç±»å‹äº¤å‰"></a>ç±»å‹ä¸ç±»å‹äº¤å‰</h4><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> Name = &#123;   name: <span class="hljs-built_in">string</span>; &#125;<span class="hljs-keyword">type</span> User = Name &amp; &#123; age: <span class="hljs-built_in">number</span>  &#125;;</code></pre><h4 id="æ¥å£æ‰©å±•ç±»å‹"><a href="#æ¥å£æ‰©å±•ç±»å‹" class="headerlink" title="æ¥å£æ‰©å±•ç±»å‹"></a>æ¥å£æ‰©å±•ç±»å‹</h4><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> Name = &#123;   name: <span class="hljs-built_in">string</span>; &#125;<span class="hljs-keyword">interface</span> User <span class="hljs-keyword">extends</span> Name &#123;   age: <span class="hljs-built_in">number</span>; &#125;</code></pre><h4 id="ç±»å‹ä¸æ¥å£äº¤å‰"><a href="#ç±»å‹ä¸æ¥å£äº¤å‰" class="headerlink" title="ç±»å‹ä¸æ¥å£äº¤å‰"></a>ç±»å‹ä¸æ¥å£äº¤å‰</h4><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> Name &#123;   name: <span class="hljs-built_in">string</span>; &#125;<span class="hljs-keyword">type</span> User = Name &amp; &#123;   age: <span class="hljs-built_in">number</span>; &#125;</code></pre><h2 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h2><h3 id="ç±»å‹å¯ä»¥è€Œinterfaceä¸è¡Œ"><a href="#ç±»å‹å¯ä»¥è€Œinterfaceä¸è¡Œ" class="headerlink" title="ç±»å‹å¯ä»¥è€Œinterfaceä¸è¡Œ"></a>ç±»å‹å¯ä»¥è€Œinterfaceä¸è¡Œ</h3><ul><li>ç±»å‹å¯ä»¥å£°æ˜åŸºæœ¬ç±»å‹åˆ«åï¼Œè”åˆç±»å‹ï¼Œå…ƒç»„ç­‰ç±»å‹</li></ul><pre><code class="hljs typescript"><span class="hljs-comment">//åŸºæœ¬ç±»å‹åˆ«å</span><span class="hljs-keyword">type</span>  Name  =  <span class="hljs-built_in">string</span><span class="hljs-comment">//è”åˆç±»å‹</span>æ¥å£ Dog  &#123;     wong ï¼ˆï¼‰; &#125; æ¥å£ Cat  &#123;     miao ï¼ˆï¼‰; &#125;é”®å…¥ å® ç‰© =  ç‹— | çŒ«<span class="hljs-comment">//å…·ä½“å®šä¹‰æ¯ä¸ªæ¯ä¸ªä½ç½®çš„ç±»å‹</span><span class="hljs-keyword">type</span>  PetList  =  [ Dog ï¼Œ Pet ]</code></pre><ul><li>typeè¯­å¥ä¸­è¿˜å¯ä»¥ä½¿ç”¨typeofè·å–å®ä¾‹çš„ç±»å‹è¿›è¡Œèµ‹å€¼</li></ul><pre><code class="hljs typescript"><span class="hljs-comment">// å½“ä½ æƒ³è·å–ä¸€ä¸ªå˜é‡çš„ç±»å‹æ—¶ï¼Œä½¿ç”¨ typeof</span><span class="hljs-keyword">let</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);<span class="hljs-keyword">type</span> B = <span class="hljs-keyword">typeof</span> div</code></pre><ul><li>å…¶ä»–éªšæ“ä½œ</li></ul><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> StringOrNumber = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;  <span class="hljs-keyword">type</span> Text = <span class="hljs-built_in">string</span> | &#123; text: <span class="hljs-built_in">string</span> &#125;;  <span class="hljs-keyword">type</span> NameLookup = Dictionary&lt;<span class="hljs-built_in">string</span>, Person&gt;;  <span class="hljs-keyword">type</span> Callback&lt;T&gt; = <span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-keyword">type</span> Pair&lt;T&gt; = [T, T];  <span class="hljs-keyword">type</span> Coordinates = Pair&lt;<span class="hljs-built_in">number</span>&gt;;  <span class="hljs-keyword">type</span> Tree&lt;T&gt; = T | &#123; left: Tree&lt;T&gt;, right: Tree&lt;T&gt; &#125;;</code></pre><h3 id="æ¥å£å¯ä»¥è€Œtypeä¸è¡Œ"><a href="#æ¥å£å¯ä»¥è€Œtypeä¸è¡Œ" class="headerlink" title="æ¥å£å¯ä»¥è€Œtypeä¸è¡Œ"></a>æ¥å£å¯ä»¥è€Œtypeä¸è¡Œ</h3><p>æ¥å£èƒ½å¤Ÿå£°æ˜åˆå¹¶</p><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> User &#123;  name: <span class="hljs-built_in">string</span>  age: <span class="hljs-built_in">number</span>&#125;<span class="hljs-keyword">interface</span> User &#123;  sex: <span class="hljs-built_in">string</span>&#125;<span class="hljs-comment">/*</span><span class="hljs-comment">User æ¥å£ä¸º &#123;</span><span class="hljs-comment">  name: string</span><span class="hljs-comment">  age: number</span><span class="hljs-comment">  sex: string </span><span class="hljs-comment">&#125;</span><span class="hljs-comment">*/</span></code></pre><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è‡³å°‘ï¼Œå¦‚æœä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™ç”¨interface / typeï¼Œèƒ½ç”¨interfaceå®ç°ï¼Œå°±ç”¨interfaceï¼Œå¦‚æœä¸èƒ½å°±ç”¨typeã€‚å…¶ä»–æ›´å¤šè¯¦æƒ…å‚è§<a href="https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md" target="_blank" rel="noopener">å®˜æ–¹è§„èŒƒæ–‡æ¡£</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Goè¯­è¨€åŸºç¡€ä¹‹å˜é‡å’Œå¸¸é‡</title>
    <link href="/2019-08-07-Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/"/>
    <url>/2019-08-07-Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ‡è¯†ç¬¦ä¸å…³é”®å­—"><a href="#æ ‡è¯†ç¬¦ä¸å…³é”®å­—" class="headerlink" title="æ ‡è¯†ç¬¦ä¸å…³é”®å­—"></a>æ ‡è¯†ç¬¦ä¸å…³é”®å­—</h1><h2 id="æ ‡è¯†ç¬¦"><a href="#æ ‡è¯†ç¬¦" class="headerlink" title="æ ‡è¯†ç¬¦"></a>æ ‡è¯†ç¬¦</h2><p>åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ ‡è¯†ç¬¦å°±æ˜¯ç¨‹åºå‘˜å®šä¹‰çš„å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„è¯ï¼Œæ¯”å¦‚å˜é‡åã€å¸¸é‡åã€å‡½æ•°åç­‰ç­‰ã€‚ Goè¯­è¨€ä¸­æ ‡è¯†ç¬¦ç”±å­—æ¯æ•°å­—å’Œ<code>_</code>(ä¸‹åˆ’çº¿ï¼‰ç»„æˆï¼Œå¹¶ä¸”åªèƒ½ä»¥å­—æ¯å’Œ<code>_</code>å¼€å¤´ã€‚ ä¸¾å‡ ä¸ªä¾‹å­ï¼š<code>abc</code>, <code>_</code>, <code>_123</code>, <code>a123</code>ã€‚</p><hr><h2 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h2><p>å…³é”®å­—æ˜¯æŒ‡ç¼–ç¨‹è¯­è¨€ä¸­é¢„å…ˆå®šä¹‰å¥½çš„å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„æ ‡è¯†ç¬¦ã€‚ å…³é”®å­—å’Œä¿ç•™å­—éƒ½ä¸å»ºè®®ç”¨ä½œå˜é‡åã€‚</p><p>Goè¯­è¨€ä¸­æœ‰25ä¸ªå…³é”®å­—ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">break</span>        <span class="hljs-keyword">default</span>      <span class="hljs-function"><span class="hljs-keyword">func</span>         <span class="hljs-title">interface</span>    <span class="hljs-title">select</span></span><span class="hljs-keyword">case</span>         <span class="hljs-keyword">defer</span>        <span class="hljs-keyword">go</span>           <span class="hljs-keyword">map</span>          <span class="hljs-keyword">struct</span><span class="hljs-keyword">chan</span>         <span class="hljs-keyword">else</span>         <span class="hljs-keyword">goto</span>         <span class="hljs-keyword">package</span>      <span class="hljs-keyword">switch</span><span class="hljs-keyword">const</span>        <span class="hljs-keyword">fallthrough</span>  <span class="hljs-keyword">if</span>           <span class="hljs-keyword">range</span>        <span class="hljs-keyword">type</span><span class="hljs-keyword">continue</span>     <span class="hljs-keyword">for</span>          <span class="hljs-keyword">import</span>       <span class="hljs-keyword">return</span>       <span class="hljs-keyword">var</span></code></pre><p>æ­¤å¤–ï¼ŒGoè¯­è¨€ä¸­è¿˜æœ‰37ä¸ªä¿ç•™å­—ã€‚</p><pre><code class="hljs go">Constants:    <span class="hljs-literal">true</span>  <span class="hljs-literal">false</span>  <span class="hljs-literal">iota</span>  <span class="hljs-literal">nil</span>    Types:    <span class="hljs-keyword">int</span>  <span class="hljs-keyword">int8</span>  <span class="hljs-keyword">int16</span>  <span class="hljs-keyword">int32</span>  <span class="hljs-keyword">int64</span>                <span class="hljs-keyword">uint</span>  <span class="hljs-keyword">uint8</span>  <span class="hljs-keyword">uint16</span>  <span class="hljs-keyword">uint32</span>  <span class="hljs-keyword">uint64</span>  <span class="hljs-keyword">uintptr</span>              <span class="hljs-keyword">float32</span>  <span class="hljs-keyword">float64</span>  <span class="hljs-keyword">complex128</span>  <span class="hljs-keyword">complex64</span>              <span class="hljs-keyword">bool</span>  <span class="hljs-keyword">byte</span>  <span class="hljs-keyword">rune</span>  <span class="hljs-keyword">string</span>  errorFunctions:   <span class="hljs-built_in">make</span>  <span class="hljs-built_in">len</span>  <span class="hljs-built_in">cap</span>  <span class="hljs-built_in">new</span>  <span class="hljs-built_in">append</span>  <span class="hljs-built_in">copy</span>  <span class="hljs-built_in">close</span>  <span class="hljs-built_in">delete</span>             <span class="hljs-built_in">complex</span>  <span class="hljs-built_in">real</span>  <span class="hljs-built_in">imag</span>             <span class="hljs-built_in">panic</span>  <span class="hljs-built_in">recover</span></code></pre><h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><h2 id="å˜é‡çš„æ¥å†"><a href="#å˜é‡çš„æ¥å†" class="headerlink" title="å˜é‡çš„æ¥å†"></a>å˜é‡çš„æ¥å†</h2><p>ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­æ“ä½œæŸä¸ªæ•°æ®æ—¶å°±éœ€è¦å»å†…å­˜ä¸Šæ‰¾åˆ°è¿™ä¸ªå˜é‡ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ä»£ç ä¸­é€šè¿‡å†…å­˜åœ°å€å»æ“ä½œå˜é‡çš„è¯ï¼Œä»£ç çš„å¯è¯»æ€§ä¼šéå¸¸å·®è€Œä¸”è¿˜å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åˆ©ç”¨å˜é‡å°†è¿™ä¸ªæ•°æ®çš„å†…å­˜åœ°å€ä¿å­˜èµ·æ¥ï¼Œä»¥åç›´æ¥é€šè¿‡è¿™ä¸ªå˜é‡å°±èƒ½æ‰¾åˆ°å†…å­˜ä¸Šå¯¹åº”çš„æ•°æ®äº†ã€‚</p><h2 id="å˜é‡ç±»å‹"><a href="#å˜é‡ç±»å‹" class="headerlink" title="å˜é‡ç±»å‹"></a>å˜é‡ç±»å‹</h2><p>å˜é‡ï¼ˆVariableï¼‰çš„åŠŸèƒ½æ˜¯å­˜å‚¨æ•°æ®ã€‚ä¸åŒçš„å˜é‡ä¿å­˜çš„æ•°æ®ç±»å‹å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚ç»è¿‡åŠä¸ªå¤šä¸–çºªçš„å‘å±•ï¼Œç¼–ç¨‹è¯­è¨€å·²ç»åŸºæœ¬å½¢æˆäº†ä¸€å¥—å›ºå®šçš„ç±»å‹ï¼Œå¸¸è§å˜é‡çš„æ•°æ®ç±»å‹æœ‰ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹ç­‰ã€‚</p><p>Goè¯­è¨€ä¸­çš„æ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰è‡ªå·±çš„ç±»å‹ï¼Œå¹¶ä¸”å˜é‡å¿…é¡»ç»è¿‡å£°æ˜æ‰èƒ½å¼€å§‹ä½¿ç”¨ã€‚</p><h2 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h2><p>Goè¯­è¨€ä¸­çš„å˜é‡éœ€è¦å£°æ˜åæ‰èƒ½ä½¿ç”¨ï¼ŒåŒä¸€ä½œç”¨åŸŸå†…ä¸æ”¯æŒé‡å¤å£°æ˜ã€‚ å¹¶ä¸”Goè¯­è¨€çš„å˜é‡å£°æ˜åå¿…é¡»ä½¿ç”¨ã€‚</p><h3 id="æ ‡å‡†å£°æ˜"><a href="#æ ‡å‡†å£°æ˜" class="headerlink" title="æ ‡å‡†å£°æ˜"></a>æ ‡å‡†å£°æ˜</h3><p>Goè¯­è¨€çš„å˜é‡å£°æ˜æ ¼å¼ä¸ºï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> å˜é‡å å˜é‡ç±»å‹</code></pre><p>å˜é‡å£°æ˜ä»¥å…³é”®å­—<code>var</code>å¼€å¤´ï¼Œå˜é‡ç±»å‹æ”¾åœ¨å˜é‡çš„åé¢ï¼Œè¡Œå°¾æ— éœ€åˆ†å·ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> name <span class="hljs-keyword">string</span><span class="hljs-keyword">var</span> age <span class="hljs-keyword">int</span><span class="hljs-keyword">var</span> isOk <span class="hljs-keyword">bool</span></code></pre><h3 id="æ‰¹é‡å£°æ˜"><a href="#æ‰¹é‡å£°æ˜" class="headerlink" title="æ‰¹é‡å£°æ˜"></a>æ‰¹é‡å£°æ˜</h3><p>æ¯å£°æ˜ä¸€ä¸ªå˜é‡å°±éœ€è¦å†™<code>var</code>å…³é”®å­—ä¼šæ¯”è¾ƒç¹çï¼Œgoè¯­è¨€ä¸­è¿˜æ”¯æŒæ‰¹é‡å˜é‡å£°æ˜ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> (    a <span class="hljs-keyword">string</span>    b <span class="hljs-keyword">int</span>    c <span class="hljs-keyword">bool</span>    d <span class="hljs-keyword">float32</span>)</code></pre><h3 id="å˜é‡çš„åˆå§‹åŒ–"><a href="#å˜é‡çš„åˆå§‹åŒ–" class="headerlink" title="å˜é‡çš„åˆå§‹åŒ–"></a>å˜é‡çš„åˆå§‹åŒ–</h3><p>Goè¯­è¨€åœ¨å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å¯¹å˜é‡å¯¹åº”çš„å†…å­˜åŒºåŸŸè¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚æ¯ä¸ªå˜é‡ä¼šè¢«åˆå§‹åŒ–æˆå…¶ç±»å‹çš„é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š æ•´å‹å’Œæµ®ç‚¹å‹å˜é‡çš„é»˜è®¤å€¼ä¸º<code>0</code>ã€‚ å­—ç¬¦ä¸²å˜é‡çš„é»˜è®¤å€¼ä¸º<code>ç©ºå­—ç¬¦ä¸²</code>ã€‚ å¸ƒå°”å‹å˜é‡é»˜è®¤ä¸º<code>false</code>ã€‚ åˆ‡ç‰‡ã€å‡½æ•°ã€æŒ‡é’ˆå˜é‡çš„é»˜è®¤ä¸º<code>nil</code>ã€‚</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯åœ¨å£°æ˜å˜é‡çš„æ—¶å€™ä¸ºå…¶æŒ‡å®šåˆå§‹å€¼ã€‚å˜é‡åˆå§‹åŒ–çš„æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> å˜é‡å ç±»å‹ = è¡¨è¾¾å¼</code></pre><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> name <span class="hljs-keyword">string</span> = <span class="hljs-string">"Q1mi"</span><span class="hljs-keyword">var</span> age <span class="hljs-keyword">int</span> = <span class="hljs-number">18</span></code></pre><p>æˆ–è€…ä¸€æ¬¡åˆå§‹åŒ–å¤šä¸ªå˜é‡</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> name, age = <span class="hljs-string">"Q1mi"</span>, <span class="hljs-number">20</span></code></pre><h4 id="ç±»å‹æ¨å¯¼"><a href="#ç±»å‹æ¨å¯¼" class="headerlink" title="ç±»å‹æ¨å¯¼"></a>ç±»å‹æ¨å¯¼</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå°†å˜é‡çš„ç±»å‹çœç•¥ï¼Œè¿™ä¸ªæ—¶å€™ç¼–è¯‘å™¨ä¼šæ ¹æ®ç­‰å·å³è¾¹çš„å€¼æ¥æ¨å¯¼å˜é‡çš„ç±»å‹å®Œæˆåˆå§‹åŒ–ã€‚</p><pre><code class="hljs go"><span class="hljs-keyword">var</span> name = <span class="hljs-string">"Q1mi"</span><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span></code></pre><h4 id="çŸ­å˜é‡å£°æ˜"><a href="#çŸ­å˜é‡å£°æ˜" class="headerlink" title="çŸ­å˜é‡å£°æ˜"></a>çŸ­å˜é‡å£°æ˜</h4><p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç®€ç•¥çš„ <code>:=</code> æ–¹å¼å£°æ˜å¹¶åˆå§‹åŒ–å˜é‡ã€‚</p><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<span class="hljs-keyword">import</span> (<span class="hljs-string">"fmt"</span>)<span class="hljs-comment">// å…¨å±€å˜é‡m</span><span class="hljs-keyword">var</span> m = <span class="hljs-number">100</span><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;n := <span class="hljs-number">10</span>m := <span class="hljs-number">200</span> <span class="hljs-comment">// æ­¤å¤„å£°æ˜å±€éƒ¨å˜é‡m</span>fmt.Println(m, n)&#125;</code></pre><h4 id="åŒ¿åå˜é‡"><a href="#åŒ¿åå˜é‡" class="headerlink" title="åŒ¿åå˜é‡"></a>åŒ¿åå˜é‡</h4><p>åœ¨ä½¿ç”¨å¤šé‡èµ‹å€¼æ—¶ï¼Œå¦‚æœæƒ³è¦å¿½ç•¥æŸä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>åŒ¿åå˜é‡ï¼ˆanonymous variableï¼‰</code>ã€‚ åŒ¿åå˜é‡ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿<code>_</code>è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š</p><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">string</span>)</span></span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-number">10</span>, <span class="hljs-string">"Q1mi"</span>&#125;<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;x, _ := foo()_, y := foo()fmt.Println(<span class="hljs-string">"x="</span>, x)fmt.Println(<span class="hljs-string">"y="</span>, y)&#125;</code></pre><p>åŒ¿åå˜é‡ä¸å ç”¨å‘½åç©ºé—´ï¼Œä¸ä¼šåˆ†é…å†…å­˜ï¼Œæ‰€ä»¥åŒ¿åå˜é‡ä¹‹é—´ä¸å­˜åœ¨é‡å¤å£°æ˜ã€‚ (åœ¨<code>Lua</code>ç­‰ç¼–ç¨‹è¯­è¨€é‡Œï¼ŒåŒ¿åå˜é‡ä¹Ÿè¢«å«åšå“‘å…ƒå˜é‡ã€‚)</p><p>æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>å‡½æ•°å¤–çš„æ¯ä¸ªè¯­å¥éƒ½å¿…é¡»ä»¥å…³é”®å­—å¼€å§‹ï¼ˆvarã€constã€funcç­‰ï¼‰</li><li><code>:=</code>ä¸èƒ½ä½¿ç”¨åœ¨å‡½æ•°å¤–ã€‚</li><li><code>_</code>å¤šç”¨äºå ä½ï¼Œè¡¨ç¤ºå¿½ç•¥å€¼ã€‚</li></ol><h1 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h1><p>ç›¸å¯¹äºå˜é‡ï¼Œå¸¸é‡æ˜¯æ’å®šä¸å˜çš„å€¼ï¼Œå¤šç”¨äºå®šä¹‰ç¨‹åºè¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜çš„é‚£äº›å€¼ã€‚ å¸¸é‡çš„å£°æ˜å’Œå˜é‡å£°æ˜éå¸¸ç±»ä¼¼ï¼Œåªæ˜¯æŠŠ<code>var</code>æ¢æˆäº†<code>const</code>ï¼Œå¸¸é‡åœ¨å®šä¹‰çš„æ—¶å€™å¿…é¡»èµ‹å€¼ã€‚</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> pi = <span class="hljs-number">3.1415</span><span class="hljs-keyword">const</span> e = <span class="hljs-number">2.7182</span></code></pre><p>å£°æ˜äº†<code>pi</code>å’Œ<code>e</code>è¿™ä¸¤ä¸ªå¸¸é‡ä¹‹åï¼Œåœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´å®ƒä»¬çš„å€¼éƒ½ä¸èƒ½å†å‘ç”Ÿå˜åŒ–äº†ã€‚</p><p>å¤šä¸ªå¸¸é‡ä¹Ÿå¯ä»¥ä¸€èµ·å£°æ˜ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (    pi = <span class="hljs-number">3.1415</span>    e = <span class="hljs-number">2.7182</span>)</code></pre><p>conståŒæ—¶å£°æ˜å¤šä¸ªå¸¸é‡æ—¶ï¼Œå¦‚æœçœç•¥äº†å€¼åˆ™è¡¨ç¤ºå’Œä¸Šé¢ä¸€è¡Œçš„å€¼ç›¸åŒã€‚ ä¾‹å¦‚ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (    n1 = <span class="hljs-number">100</span>    n2    n3)</code></pre><p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå¸¸é‡<code>n1</code>ã€<code>n2</code>ã€<code>n3</code>çš„å€¼éƒ½æ˜¯100ã€‚</p><h2 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h2><p><code>iota</code>æ˜¯goè¯­è¨€çš„å¸¸é‡è®¡æ•°å™¨ï¼Œåªèƒ½åœ¨å¸¸é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚</p><p><code>iota</code>åœ¨constå…³é”®å­—å‡ºç°æ—¶å°†è¢«é‡ç½®ä¸º0ã€‚constä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡å£°æ˜å°†ä½¿<code>iota</code>è®¡æ•°ä¸€æ¬¡(iotaå¯ç†è§£ä¸ºconstè¯­å¥å—ä¸­çš„è¡Œç´¢å¼•)ã€‚ ä½¿ç”¨iotaèƒ½ç®€åŒ–å®šä¹‰ï¼Œåœ¨å®šä¹‰æšä¸¾æ—¶å¾ˆæœ‰ç”¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (n1 = <span class="hljs-literal">iota</span> <span class="hljs-comment">//0</span>n2        <span class="hljs-comment">//1</span>n3        <span class="hljs-comment">//2</span>n4        <span class="hljs-comment">//3</span>)</code></pre><h3 id="å‡ ä¸ªå¸¸è§çš„iotaç¤ºä¾‹"><a href="#å‡ ä¸ªå¸¸è§çš„iotaç¤ºä¾‹" class="headerlink" title="å‡ ä¸ªå¸¸è§çš„iotaç¤ºä¾‹:"></a>å‡ ä¸ªå¸¸è§çš„<code>iota</code>ç¤ºä¾‹:</h3><p>ä½¿ç”¨<code>_</code>è·³è¿‡æŸäº›å€¼</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (n1 = <span class="hljs-literal">iota</span> <span class="hljs-comment">//0</span>n2        <span class="hljs-comment">//1</span>_n4        <span class="hljs-comment">//3</span>)</code></pre><p><code>iota</code>å£°æ˜ä¸­é—´æ’é˜Ÿ</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (n1 = <span class="hljs-literal">iota</span> <span class="hljs-comment">//0</span>n2 = <span class="hljs-number">100</span>  <span class="hljs-comment">//100</span>n3 = <span class="hljs-literal">iota</span> <span class="hljs-comment">//2</span>n4        <span class="hljs-comment">//3</span>)<span class="hljs-keyword">const</span> n5 = <span class="hljs-literal">iota</span> <span class="hljs-comment">//0</span></code></pre><p>å®šä¹‰æ•°é‡çº§ ï¼ˆè¿™é‡Œçš„<code>&lt;&lt;</code>è¡¨ç¤ºå·¦ç§»æ“ä½œï¼Œ<code>1&lt;&lt;10</code>è¡¨ç¤ºå°†1çš„äºŒè¿›åˆ¶è¡¨ç¤ºå‘å·¦ç§»10ä½ï¼Œä¹Ÿå°±æ˜¯ç”±<code>1</code>å˜æˆäº†<code>10000000000</code>ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„1024ã€‚åŒç†<code>2&lt;&lt;2</code>è¡¨ç¤ºå°†2çš„äºŒè¿›åˆ¶è¡¨ç¤ºå‘å·¦ç§»2ä½ï¼Œä¹Ÿå°±æ˜¯ç”±<code>10</code>å˜æˆäº†<code>1000</code>ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„8ã€‚ï¼‰</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (_  = <span class="hljs-literal">iota</span>KB = <span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">10</span> * <span class="hljs-literal">iota</span>)MB = <span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">10</span> * <span class="hljs-literal">iota</span>)GB = <span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">10</span> * <span class="hljs-literal">iota</span>)TB = <span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">10</span> * <span class="hljs-literal">iota</span>)PB = <span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">10</span> * <span class="hljs-literal">iota</span>))</code></pre><p>å¤šä¸ª<code>iota</code>å®šä¹‰åœ¨ä¸€è¡Œ</p><pre><code class="hljs go"><span class="hljs-keyword">const</span> (a, b = <span class="hljs-literal">iota</span> + <span class="hljs-number">1</span>, <span class="hljs-literal">iota</span> + <span class="hljs-number">2</span> <span class="hljs-comment">//1,2</span>c, d                      <span class="hljs-comment">//2,3</span>e, f                      <span class="hljs-comment">//3,4</span>)</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>GO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è·¨åŸŸé‚£ç‚¹äº‹</title>
    <link href="/2019-07-13-%E8%B7%A8%E5%9F%9F%E9%82%A3%E7%82%B9%E4%BA%8B/"/>
    <url>/2019-07-13-%E8%B7%A8%E5%9F%9F%E9%82%A3%E7%82%B9%E4%BA%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç›¸ä¿¡æ¯ä¸ªå‰ç«¯å¯¹äºè·¨åŸŸè¿™ä¸¤ä¸ªå­—éƒ½ä¸ä¼šé™Œç”Ÿï¼Œåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨ä¹Ÿå¾ˆå¤šï¼Œä½†è·¨åŸŸæ–¹æ³•çš„å¤šç§å¤šæ ·è®©äººç›®ä¸æš‡æ¥ï¼Œå‰æ®µæ—¶é—´å…¬å¸åŒäº‹å‡ºç°äº†è·¨åŸŸé—®é¢˜ï¼Œåˆä¸€æ—¶æ‰¾ä¸åˆ°é—®é¢˜æ‰€åœ¨ï¼Œæ‰€ä»¥åœ¨æ­¤æ€»ç»“ä¸‹è·¨åŸŸçŸ¥è¯†ï¼Œä¸€ç¯‡ç”±æµ…å…¥æ·±çš„ä¸‡å­—WebåŸºæ“æ–‡</p><p>å…¶å®å¾ˆæ—©å°±å¼€å§‹å†™äº†ï¼Œåªä¸è¿‡åˆšå¼€å§‹å†™çš„æ—¶å€™ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œåæ¥æ…¢æ…¢å°±å†™å…¶ä»–è§‰å¾—è¾ƒé«˜å¤§å°šè¾ƒå†…æ¶µçš„äº†ï¼Œç„¶åå°±åˆæ˜¯è§‰å¾—ä¸å¤Ÿå®Œç¾ä¸å¤Ÿæ·±åˆ»åˆå†™ä¸€åŠï¼Œå°±æ­¤é™·å…¥å¼ºè¿«ç—‡æ‚£è€…æ˜çŸ¥ä¸å¯ä¸ºè€Œä¸ºçš„æ­»å¾ªç¯ï¼ŒSOï¼Œäº§å‡ºå°‘ï¼Œå‘¨æœŸé•¿ï¼ˆä¸è¿‡å¤§å®¶èƒ½çœ‹åˆ°çš„æ–‡ç« éƒ½æ˜¯å‡†å¤‡è‰¯ä¹…åˆåå¤æ–Ÿé…Œåè‡ªè®¤ä¸ºè¿˜ä¸é”™çš„ï¼‰ã€‚ã€‚ã€‚</p><p>æ€»ä¹‹åˆæ˜¯ä¸€ç¯‡ç”±äºå„ç§åŸå› åŠé€”è€ŒåºŸçš„ç§¯å‹æ–‡ï¼Œè¿™é‡Œç»ˆäºæ”¶å°¾äº†ï¼Œé•¿å‡ºä¸€å£æ°”ï¼Œå“ï¼Œè¿˜æ˜¯å¤ªå¹´è½»ï¼Œåæ§½ç»“æŸï¼Œè¿›å…¥æ­£æ–‡</p><h2 id="ä»€ä¹ˆæ˜¯è·¨åŸŸ"><a href="#ä»€ä¹ˆæ˜¯è·¨åŸŸ" class="headerlink" title="ä»€ä¹ˆæ˜¯è·¨åŸŸ"></a>ä»€ä¹ˆæ˜¯è·¨åŸŸ</h2><p>ç®€å•æ¥è¯´è·¨åŸŸæ˜¯æŒ‡ä¸€ä¸ªåŸŸä¸‹çš„æ–‡æ¡£æˆ–è„šæœ¬æƒ³è¦å»å»è¯·æ±‚å¦ä¸€ä¸ªåŸŸä¸‹çš„èµ„æº</p><p>å…¶å®ä¸€äº›åƒAé“¾æ¥ã€é‡å®šå‘ã€è¡¨å•æäº¤çš„èµ„æºè·³è½¬ï¼Œåƒ <code>&lt;link&gt;ã€&lt;script&gt;ã€&lt;img&gt;ã€&lt;frame&gt;</code> ç­‰domæ ‡ç­¾ï¼Œè¿˜æœ‰æ ·å¼ä¸­ <code>background:url()ã€@font-face()</code> ç­‰åµŒå…¥çš„æ–‡ä»¶å¤–é“¾ï¼Œåˆæ¯”å¦‚ä¸€äº›åƒ  js å‘èµ·çš„ajaxè¯·æ±‚ã€dom å’Œ js å¯¹è±¡çš„è·¨åŸŸæ“ä½œç­‰ç­‰éƒ½æ˜¯è·¨åŸŸ</p><p>æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è·¨åŸŸï¼Œå¤§å¤šæ˜¯ç”±æµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶å¼•èµ·çš„ä¸€ç±»è¯·æ±‚åœºæ™¯ï¼Œè¿™é‡Œä½ å¯èƒ½æ³¨æ„åˆ°äº†åŒæºç­–ç•¥ï¼Œé‚£ä¹ˆæµè§ˆå™¨çš„åŒæºç­–ç•¥æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><h2 id="æµè§ˆå™¨åŒæºç­–ç•¥"><a href="#æµè§ˆå™¨åŒæºç­–ç•¥" class="headerlink" title="æµè§ˆå™¨åŒæºç­–ç•¥"></a>æµè§ˆå™¨åŒæºç­–ç•¥</h2><p>åŒæºç­–ç•¥/SOPï¼ˆSame origin policyï¼‰æ˜¯ä¸€ç§çº¦å®šï¼Œç”± <code>Netscape</code> å…¬å¸1995å¹´å¼•å…¥æµè§ˆå™¨ï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œæµè§ˆå™¨å¾ˆå®¹æ˜“å—åˆ° <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Types_of_attacks#Cross-site_request_forgery_CSRF" target="_blank" rel="noopener">XSSã€CSFR</a> ç­‰æ”»å‡»</p><p>åŒæºåŒæºï¼Œä»€ä¹ˆæ˜¯æºå‘¢ï¼ŸæºæŒ‡çš„æ˜¯ <code>åè®®ã€åŸŸåã€ç«¯å£</code> ï¼Œé‚£ä¹ˆåŒæºå³ä¸‰è€…ç›¸åŒï¼Œå³ä¾¿æ˜¯ä¸åŒçš„åŸŸåæŒ‡å‘åŒä¸€ä¸ªipåœ°å€ï¼Œä¹Ÿä¸åŒæº</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåŸŸåç»„æˆï¼Œæˆ‘ä»¬ä»¥ <code>http://www.hahaha.com/abc/a.js</code> ä¸ºä¾‹</p><ul><li>http://            â€“&gt;    åè®®</li><li>www              â€“&gt;    å­åŸŸå</li><li>hahaha.com â€“&gt;    ä¸»åŸŸå</li><li>80                   â€“&gt;     ç«¯å£ï¼ˆ<code>http://</code> é»˜è®¤ç«¯å£æ˜¯80ï¼‰</li><li>abc/a.js         â€“&gt;     è¯·æ±‚èµ„æºè·¯å¾„</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬ä»¥è¿™ä¸ªåŸŸåçš„æºä¸ºä¾‹ï¼Œæ¥ä¸ä¸‹é¢è¿™äº›åšä¸‹å¯¹æ¯”</p><table><thead><tr><th>URL</th><th>ç»“æœ</th><th>åŸå› </th></tr></thead><tbody><tr><td><code>http://www.hahaha.com/abc/b.js</code></td><td>åŒæº</td><td>åªæœ‰è·¯å¾„ä¸åŒ</td></tr><tr><td><code>http://www.hahaha.com/def/b.js</code></td><td>åŒæº</td><td>åªæœ‰è·¯å¾„ä¸åŒ</td></tr><tr><td><code>https://www.hahaha.com/abc/a.js</code></td><td>ä¸åŒæº</td><td>åè®®ä¸åŒ</td></tr><tr><td><code>http://www.hahaha.com:8081/abc/a.js</code></td><td>ä¸åŒæº</td><td>ç«¯å£ä¸åŒ</td></tr><tr><td><code>http://aaa.hahaha.com/abc/a.js</code></td><td>ä¸åŒæº</td><td>ä¸»æœºä¸åŒ</td></tr></tbody></table><p>è€Œåœ¨ä¸åŒæºçš„æƒ…å†µä¸‹ï¼ŒåŒæºç­–ç•¥é™åˆ¶äº†æˆ‘ä»¬</p><ul><li>Cookieã€LocalStorageã€IndexedDB ç­‰å­˜å‚¨æ€§å†…å®¹æ— æ³•è¯»å–</li><li>DOM èŠ‚ç‚¹å’Œ Jså¯¹è±¡æ— æ³•è·å¾—</li><li>AJAX è¯·æ±‚å‘é€åï¼Œç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªï¼ˆæ³¨æ„æ˜¯ <strong>è¯·æ±‚å‘é€å‡ºå»äº†ï¼Œä¹Ÿæ‹¿åˆ°ç»“æœäº†ï¼Œåªæ˜¯è¢«æµè§ˆå™¨æˆªèƒ¡äº†</strong>ï¼‰</li></ul><p>åˆ°äº†è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹è·¨åŸŸå·²ç»æœ‰æ‰€äº†è§£äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æœ‰æ•ˆçš„è§„é¿è·¨åŸŸå‘¢ï¼Œåº”è¯¥è¯´å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å…ä¸äº†è¦è·¨åŸŸï¼Œé’ˆå¯¹ä¸åŒçš„ç±»å‹ï¼Œè§£å†³è·¨åŸŸçš„æ–¹å¼ä¹Ÿæœ‰å¾ˆå¤š</p><h2 id="ä¸åŒç±»å‹çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆ"><a href="#ä¸åŒç±»å‹çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸åŒç±»å‹çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆ"></a>ä¸åŒç±»å‹çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h2><h3 id="No-1-document-domain-iframeè·¨åŸŸ"><a href="#No-1-document-domain-iframeè·¨åŸŸ" class="headerlink" title="No.1 document.domain+iframeè·¨åŸŸ"></a>No.1 document.domain+iframeè·¨åŸŸ</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><code>document.domain</code> çš„æ–¹å¼å®ç°è·¨åŸŸï¼Œé€‚ç”¨åœºæ™¯ä»…åœ¨ <strong>ä¸»åŸŸåç›¸åŒï¼Œå­çº§åŸŸåä¸åŒ</strong> çš„æƒ…å†µä¸‹</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªé¡µé¢</p><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//aaa.hahaha.com/a.html</span><span class="hljs-symbol">http:</span><span class="hljs-comment">//bbb.hahaha.com/b.html</span>å¤åˆ¶ä»£ç </code></pre><p>é‚£ä¹ˆå®ƒå¯ä»¥åšåˆ°ä»€ä¹ˆå‘¢</p><ul><li>ä¸¤ä¸ªé¡µé¢è®¾ç½®ç›¸åŒçš„ <code>document.domain</code> ï¼Œå…±äº«Cookie</li><li>ä¸¤ä¸ªé¡µé¢è®¾ç½®ç›¸åŒçš„ <code>document.domain</code> ï¼Œé€šè¿‡ <code>iframe</code> å®ç°ä¸¤ä¸ªé¡µé¢çš„æ•°æ®äº’é€š</li></ul><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><h5 id="å…±äº«Cookie"><a href="#å…±äº«Cookie" class="headerlink" title="å…±äº«Cookie"></a>å…±äº«Cookie</h5><p>é¦–å…ˆï¼Œä¸¤ä¸ªé¡µé¢éƒ½è®¾ç½®ç›¸åŒçš„ <code>document.domain</code></p><pre><code class="hljs js"><span class="hljs-built_in">document</span>.domain = <span class="hljs-string">'hahaha.com'</span>;</code></pre><p>é¡µé¢ a é€šè¿‡è„šæœ¬è®¾ç½®ä¸€ä¸ª Cookie</p><pre><code class="hljs js"><span class="hljs-built_in">document</span>.cookie = <span class="hljs-string">"test=a"</span>;</code></pre><p>ç½‘é¡µ b è¯»è¿™ä¸ª Cookie</p><pre><code class="hljs js"><span class="hljs-keyword">let</span> cookieA = <span class="hljs-built_in">document</span>.cookie;<span class="hljs-built_in">console</span>.log(cookieA)</code></pre><p>æœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨è®¾ç½®Cookieçš„æ—¶å€™ï¼ŒæŒ‡å®šCookieçš„æ‰€å±åŸŸåä¸ºä¸€çº§åŸŸåï¼Œæ¯”å¦‚<code>.hahaha.com</code></p><pre><code class="hljs js"><span class="hljs-built_in">Set</span>-Cookie: key=value; domain=.hahaha.com; path=<span class="hljs-regexp">/</span></code></pre><p>è¿™æ ·çš„è¯ï¼ŒäºŒçº§åŸŸåå’Œä¸‰çº§åŸŸåä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œéƒ½å¯ä»¥è¯»å–è¿™ä¸ªCookie</p><h5 id="å…±äº«æ•°æ®"><a href="#å…±äº«æ•°æ®" class="headerlink" title="å…±äº«æ•°æ®"></a>å…±äº«æ•°æ®</h5><pre><code class="hljs html"><span class="hljs-comment">&lt;!--aé¡µé¢--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://bbb.hahaha.com/b.html"</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">"load()"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frame"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-built_in">document</span>.domain = <span class="hljs-string">'hahaha.com'</span>;</span><span class="javascript">  <span class="hljs-keyword">let</span> a = <span class="hljs-string">"this is a"</span>;</span>  <span class="actionscript">  <span class="hljs-comment">// è·å–bé¡µé¢æ•°æ®</span></span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span><span class="hljs-params">()</span></span>&#123;</span><span class="javascript">    <span class="hljs-keyword">let</span> frame = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"frame"</span>)</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(frame.contentWindow.b) <span class="hljs-comment">// this is b</span></span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-comment">&lt;!--bé¡µé¢--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-built_in">document</span>.domain = <span class="hljs-string">'hahaha.com'</span>;</span><span class="javascript">  <span class="hljs-keyword">let</span> b = <span class="hljs-string">"this is b"</span></span>  <span class="actionscript">  <span class="hljs-comment">// è·å–aé¡µé¢æ•°æ®</span></span><span class="javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.parent.a); <span class="hljs-comment">// this is a</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><h4 id="å±€é™"><a href="#å±€é™" class="headerlink" title="å±€é™"></a>å±€é™</h4><ul><li>é¦–å…ˆï¼Œä»…åœ¨ä¸»åŸŸåç›¸åŒï¼Œå­çº§åŸŸåä¸åŒçš„æƒ…å†µä¸‹</li><li>åªé€‚ç”¨äº Cookie å’Œ iframe çª—å£ï¼ŒLocalStorage å’Œ IndexDB æ•°æ®æ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•å…±äº«</li></ul><h3 id="No-2-location-hash-iframeè·¨åŸŸ"><a href="#No-2-location-hash-iframeè·¨åŸŸ" class="headerlink" title="No.2 location.hash + iframeè·¨åŸŸ"></a>No.2 location.hash + iframeè·¨åŸŸ</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸¤ä¸ªé¡µé¢ä¸åŒæºï¼Œæ˜¯æ— æ³•æ‹¿åˆ°å¯¹æ–¹DOMçš„ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯ <code>iframe</code> çª—å£å’Œ <code>window.open</code> æ–¹æ³•æ‰“å¼€çš„çª—å£ï¼Œå®ƒä»¬ä¸çˆ¶çª—å£æ˜¯æ— æ³•é€šä¿¡çš„</p><p>æ¯”å¦‚ï¼Œä¸åŒæºçš„é¡µé¢aå’Œé¡µé¢bï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è·å–å¯¹æ–¹æ•°æ®</p><p>é¡µé¢aï¼š<code>http://www.hahaha0.com/a.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha1.com/b.html"</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">"load()"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frame"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">let</span> a = <span class="hljs-string">"this is a"</span></span>  <span class="actionscript">  <span class="hljs-comment">// è·å–bé¡µé¢æ•°æ®</span></span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span><span class="hljs-params">()</span></span>&#123;</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"frame"</span>).contentWindow.b) </span><span class="actionscript">    <span class="hljs-comment">// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame.</span></span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢bï¼š<code>http://www.hahaha1.com/b.html</code></p><pre><code class="hljs html"><span class="hljs-comment">&lt;!--b--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">let</span> b = <span class="hljs-string">"this is b"</span></span>  <span class="actionscript">  <span class="hljs-comment">// è·å–aé¡µé¢æ•°æ®</span></span><span class="javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.parent.a); <span class="hljs-comment">// æŠ¥é”™</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>æ˜¾è€Œæ˜“è§ï¼Œéƒ½æ˜¯è·å–ä¸åˆ°çš„ï¼Œå› ä¸ºéƒ½è·¨åŸŸäº†ï¼Œä¸Šé¢æˆ‘ä»¬è®²åˆ°çš„ <code>document.domain</code>ï¼Œåªèƒ½åœ¨åŒä¸»åŸŸåçš„æƒ…å†µä¸‹ä½¿ç”¨æ‰èƒ½è§„é¿åŒæºæ”¿ç­–ï¼Œè€Œåœ¨ä¸»åŸŸåä¸ç›¸åŒçš„æƒ…å†µä¸‹æ˜¯æ²¡æœ‰åŠæ³•åšåˆ°çš„</p><p>æˆ‘ä»¬æ¥äº†è§£å¦ä¸€ç§åŠæ³• <code>window.location.hash</code>ï¼Œå®ƒæ‹¿åˆ°çš„æ˜¯ URL çš„<code>#</code>å·åé¢çš„éƒ¨åˆ†ï¼Œå®ƒå«ç‰‡æ®µæ ‡è¯†ç¬¦ï¼ˆfragment identifierï¼‰</p><p>æ¯”å¦‚ <code>http://hahaha.com/a.html#fragment</code> çš„ <code>#fragment</code> ï¼Œå¦‚æœåªæ˜¯æ”¹å˜ç‰‡æ®µæ ‡è¯†ç¬¦ï¼Œé¡µé¢æ˜¯ä¸ä¼šé‡æ–°åˆ·æ–°çš„ï¼Œå°±åƒå¤§åé¼é¼çš„Vueä¸­çš„hashè·¯ç”±å°±æ˜¯ç”¨çš„è¿™ç§æ–¹å¼</p><p>é€šè¿‡ <code>location.hash</code> + <code>iframe</code> æˆ‘ä»¬å¯ä»¥åšåˆ°åœ¨ä¸åŒä¸»åŸŸä¸‹ä¹Ÿå¯ä»¥æ‹¿åˆ°å¯¹æ–¹çš„æ•°æ®</p><h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®ç°é¡µé¢aå’Œé¡µé¢bçš„è·¨åŸŸç›¸äº’é€šä¿¡ï¼Œå› ä¸ºä¸åŒåŸŸæ‰€ä»¥åˆ©ç”¨ <code>iframe</code> åŠ ä¸Š <code>location.hash</code> ä¼ å€¼ï¼Œä½†æ˜¯è¿™ä¸ªä¼ å€¼æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸€æ–¹å‘å¦ä¸€æ–¹ä¼ å€¼ï¼Œä¸åŒåŸŸæ—¶å­é¡µé¢å¹¶ä¸èƒ½è·å–åˆ°çˆ¶é¡µé¢ï¼Œä¹Ÿå°±ä¸èƒ½ç›¸äº’é€šä¿¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´äººé¡µé¢cæ¥å¸®å¿™</p><p>ä¸åŒåŸŸä¹‹é—´åˆ©ç”¨ <code>iframe</code> çš„<code>location.hash</code> ä¼ å€¼ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥ JS è®¿é—®æ¥é€šä¿¡</p><p>é‚£ä¹ˆæˆ‘ä»¬çš„é€»è¾‘å°±å˜æˆäº†ä¸‹é¢è¿™æ ·</p><blockquote><p>a ä¸ b ä¸åŒåŸŸåªèƒ½é€šè¿‡hashå€¼å•å‘é€šä¿¡ï¼Œb ä¸ c ä¹Ÿä¸åŒåŸŸä¹Ÿåªèƒ½å•å‘é€šä¿¡ï¼Œä½† c ä¸ a åŒåŸŸï¼Œæ‰€ä»¥ c å¯é€šè¿‡parent.parent è®¿é—® a é¡µé¢æ‰€æœ‰å¯¹è±¡</p></blockquote><p>é¡µé¢aï¼š<code>http://www.hahaha0.com/a.html</code></p><pre><code class="hljs html"><span class="hljs-comment">&lt;!--aä¸­é€šè¿‡iframeå¼•å…¥äº†b--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frame"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha1.com/b.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">let</span> frame = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'frame'</span>);</span><span class="actionscript">  <span class="hljs-comment">// å‘bä¼ hashå€¼</span></span><span class="actionscript">  frame.src = frame.src + <span class="hljs-string">'#a=æˆ‘æ˜¯a'</span>;</span><span class="actionscript">  <span class="hljs-comment">// ç»™åŒåŸŸcä½¿ç”¨çš„å›è°ƒæ–¹æ³•</span></span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cb</span><span class="hljs-params">(data)</span> </span>&#123;</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(data) <span class="hljs-comment">// æ‰“å° æˆ‘æ˜¯a+b</span></span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢bï¼š<code>http://www.hahaha1.com/b.html</code></p><pre><code class="hljs html"><span class="hljs-comment">&lt;!--bä¸­é€šè¿‡iframeå¼•å…¥äº†ä¸­é—´äººc--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frame"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha0.com/c.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">let</span> frame = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'frame'</span>);</span><span class="actionscript">  <span class="hljs-comment">// ç›‘å¬aä¼ æ¥çš„hashå€¼ï¼Œä¼ ç»™c.html</span></span><span class="javascript">  <span class="hljs-built_in">window</span>.onhashchange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="actionscript">    frame.src = frame.src + location.hash + <span class="hljs-string">'+b'</span>;</span>  &#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢cï¼š<code>http://www.hahaha0.com/c.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">  <span class="hljs-comment">// ç›‘å¬ b çš„hashå€¼å˜åŒ–</span></span><span class="javascript">  <span class="hljs-built_in">window</span>.onhashchange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><span class="actionscript">    <span class="hljs-comment">// cè°ƒç”¨çˆ¶äº²çš„çˆ¶äº²ï¼Œæ¥æ“ä½œåŒåŸŸaçš„jså›è°ƒï¼Œå°†ç»“æœä¼ å›</span></span><span class="javascript">    <span class="hljs-built_in">window</span>.parent.parent.cb(location.hash.replace(<span class="hljs-string">'#a='</span>, <span class="hljs-string">''</span>));</span>  &#125;;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><h3 id="No-3-window-name-iframeè·¨åŸŸ"><a href="#No-3-window-name-iframeè·¨åŸŸ" class="headerlink" title="No.3 window.name + iframeè·¨åŸŸ"></a>No.3 window.name + iframeè·¨åŸŸ</h3><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p><code>window</code> å¯¹è±¡æœ‰ä¸€ä¸ª <code>name</code> å±æ€§ï¼Œè¯¥å±æ€§æœ‰ä¸€ä¸ªç‰¹å¾ï¼Œå³åœ¨ä¸€ä¸ªçª—å£çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçª—å£è½½å…¥æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å…±äº«ä¸€ä¸ª <code>window.name</code> çš„ï¼Œæ¯ä¸€ä¸ªé¡µé¢å¯¹ <code>window.name</code> éƒ½æœ‰è¯»å†™çš„æƒé™</p><p><code>window.name</code> æ˜¯æŒä¹…çš„å­˜åœ¨äºä¸€ä¸ªçª—å£è½½å…¥çš„æ‰€æœ‰é¡µé¢ä¸­çš„ï¼Œå¹¶ä¸ä¼šå› ä¸ºæ–°çš„é¡µé¢çš„è½½å…¥è€Œè¢«é‡ç½®ï¼Œæ¯”å¦‚ä¸‹ä¾‹</p><p>é¡µé¢a</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-built_in">window</span>.name = <span class="hljs-string">'æˆ‘æ˜¯a'</span>;</span><span class="actionscript">  setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;</span><span class="javascript">    <span class="hljs-built_in">window</span>.location = <span class="hljs-string">'b.html'</span>; <span class="hljs-comment">// ä¸¤ç§’åæŠŠä¸€ä¸ªæ–°é¡µé¢b.htmlè½½å…¥åˆ°å½“å‰çš„windowä¸­</span></span>  &#125;,2000) <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢b</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.name); <span class="hljs-comment">// æˆ‘æ˜¯a</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ï¼Œa é¡µé¢è½½å…¥2såï¼Œè·³è½¬åˆ° b é¡µé¢ï¼Œb ä¼šåœ¨æ§åˆ¶å°è¾“å‡º <code>æˆ‘æ˜¯a</code></p><p>ä¸è¿‡ <code>window.name</code> çš„å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²çš„å½¢å¼ï¼Œæœ€å¤§å…è®¸2Må·¦å³ï¼Œå…·ä½“å–å†³äºä¸åŒçš„æµè§ˆå™¨ï¼Œä½†æ˜¯ä¸€èˆ¬æ˜¯å¤Ÿç”¨äº†</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒè¿™ä¸€ç‰¹æ€§æ¥å®ç°è·¨åŸŸï¼Œçœ‹æ ‡é¢˜å°±çŸ¥é“æ˜¯ä½¿ç”¨ <code>window.name</code> å’Œ <code>iframe</code> ï¼Œé‚£ä¹ˆä½ èƒ½æƒ³åˆ°è¦å¦‚ä½•æŠ•æœºå–å·§ï¼Œå“¦ä¸ï¼Œæ˜¯å·§å¦™çš„è§„é¿è·¨åŸŸè€Œä¸ç•™ç—•è¿¹å—ï¼Ÿ</p><p>ç»å†è¿‡ä¸Šæ–‡çš„æ‘§æ®‹æˆ‘ä»¬çŸ¥é“ï¼Œä¸åŒåŸŸæƒ…å†µä¸‹çš„ a é¡µé¢å’Œ b é¡µé¢ï¼Œä½¿ç”¨ <code>iframe</code> åµŒå…¥ä¸€ä¸ªé¡µé¢ï¼Œæ•°æ®ä¹Ÿæ˜¯äº’é€šä¸äº†çš„ï¼Œå› ä¸ºä¼šè·¨åŸŸï¼Œè¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨ <code>window.name</code> + <code>iframe</code> æ¥å®ç°è·¨åŸŸæ•°æ®äº’é€šï¼Œæ˜¾ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ a é¡µé¢ä¸­é€šè¿‡æ”¹å˜ <code>window.location</code> æ¥è½½å…¥b é¡µé¢ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°çš„æ˜¯ a é¡µé¢ä¸è·³è½¬ï¼Œä½†æ˜¯ä¹Ÿèƒ½å¤Ÿè·å–åˆ° b ä¸­çš„æ•°æ®</p><blockquote><p>ç©¶ç«Ÿè¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿå…¶å®è¿˜æ˜¯è¦é ä¸€ä¸ªä¸­é—´äººé¡µé¢ c</p><p>é¦–å…ˆä¸­é—´äºº c è¦å’Œ a æ˜¯åŒåŸŸ</p><p>a é¡µé¢ä¸­é€šè¿‡ <code>iframe</code> åŠ è½½äº† b ï¼Œåœ¨ b é¡µé¢ä¸­æŠŠæ•°æ®ç•™åœ¨äº†å½“å‰ <code>iframe</code> çª—å£çš„  <code>window.name</code> å±æ€§é‡Œ</p><p>è¿™ä¸ªæ—¶å€™ a æ˜¯è¯»å–ä¸äº† <code>iframe</code> çš„ï¼Œå› ä¸ºä¸åŒåŸŸï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ a ä¸­åŠ¨æ€çš„æŠŠ <code>iframe</code> çš„ <code>src</code> æ”¹ä¸º c</p><p>ä¸­é—´äºº c ä»€ä¹ˆéƒ½ä¸ç”¨å†™ï¼Œå› ä¸ºå®ƒç›´æ¥ç»§æ‰¿äº† b ç•™ä¸‹çš„ <code>window.name</code></p><p>å› ä¸ºc å’Œ aå› ä¸ºæ˜¯åŒåŸŸï¼Œæ‰€ä»¥ a å¯ä»¥æ­£å¸¸æ‹¿åˆ°å­é¡µé¢ c ä¸­çš„ <code>window.name</code> å±æ€§å€¼</p><p>ä¸å¾—ä¸è¯´ï¼Œè¿™ç§åšæ³•è¿˜çœŸæŒºè®©äººå¹ä¸ºè§‚æ­¢çš„ï¼Œè‡´æ•¬å‰è¾ˆä»¬</p></blockquote><h4 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>é¡µé¢aï¼š<code>http://www.hahaha1.com/abc/a.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha2.com/abc/b.html"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frame"</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">"load()"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">let</span> flag = <span class="hljs-literal">true</span></span><span class="actionscript">  <span class="hljs-comment">// onloadäº‹ä»¶ä¼šè§¦å‘2æ¬¡</span></span><span class="actionscript">  <span class="hljs-comment">// ç¬¬1æ¬¡onloadè·¨åŸŸé¡µbæˆåŠŸåï¼Œç•™ä¸‹æ•°æ®window.nameï¼Œååˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢</span></span><span class="actionscript">  <span class="hljs-comment">// ç¬¬2æ¬¡onloadåŒåŸŸé¡µcæˆåŠŸåï¼Œè¯»å–åŒåŸŸwindow.nameä¸­æ•°æ®</span></span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span><span class="hljs-params">()</span> </span>&#123;</span>    if(flag)&#123;<span class="actionscript">      <span class="hljs-comment">// ç¬¬1æ¬¡</span></span><span class="javascript">      <span class="hljs-keyword">let</span> frame = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'frame'</span>)</span><span class="actionscript">      frame.src = <span class="hljs-string">'http://www.hahaha1.com/abc/c.html'</span></span><span class="actionscript">      flag = <span class="hljs-literal">false</span></span><span class="actionscript">    &#125;<span class="hljs-keyword">else</span>&#123;</span><span class="actionscript">      <span class="hljs-comment">// ç¬¬äºŒæ¬¡</span></span><span class="javascript">      <span class="hljs-built_in">console</span>.log(frame.contentWindow.name) <span class="hljs-comment">// æˆ‘æ˜¯b</span></span>    &#125;  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢bï¼š<code>http://www.hahaha2.com/abc/b.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-built_in">window</span>.name = <span class="hljs-string">'æˆ‘æ˜¯b'</span>  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><h3 id="No-4-window-postMessageè·¨åŸŸ"><a href="#No-4-window-postMessageè·¨åŸŸ" class="headerlink" title="No.4 window.postMessageè·¨åŸŸ"></a>No.4 window.postMessageè·¨åŸŸ</h3><h4 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>æˆ‘ä»¬ä¸Šé¢è¯´çš„å‡ ç§çª—å£è·¨åŸŸåšæ³•æ˜¯å¯ä»¥é€‚ç”¨ç›¸åº”åœºæ™¯ä¸”å®‰å…¨å¯é çš„ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯å±äºæŠ•æœºå–å·§ï¼Œä¸å¯¹ï¼Œæ˜¯å¦è¾Ÿæ·å¾„ï¼Œä½†æ˜¯<code>HTML5 XMLHttpRequest Level 2</code>ä¸­ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„APIï¼šè·¨æ–‡æ¡£é€šä¿¡ APIï¼ˆCross-document messagingï¼‰</p><p>è¿™ä¸ªAPIä¸º <code>window</code> å¯¹è±¡æ–°å¢äº†ä¸€ä¸ª <code>window.postMessage</code> æ–¹æ³•ï¼Œå¯ä»¥å…è®¸æ¥è‡ªä¸åŒæºçš„è„šæœ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œæœ‰é™çš„é€šä¿¡ï¼Œå¯ä»¥å®ç°è·¨æ–‡æœ¬æ¡£ã€å¤šçª—å£ã€è·¨åŸŸæ¶ˆæ¯ä¼ é€’</p><p>ä¸»æµæµè§ˆå™¨çš„å…¼å®¹æƒ…å†µä¹Ÿéå¸¸å¯è§‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggpfeqc7f4j31h20cxn1h.jpg" srcset="/img/loading.gif" alt="image-20200713163012343"></p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„ä½¿ç”¨ï¼Œå…ˆæ¥çœ‹çœ‹å®ƒæ€ä¹ˆå‘é€æ•°æ®</p><pre><code class="hljs js">otherWindow.postMessage(message, targetOrigin, [transfer]);</code></pre><ul><li>otherWindow<ul><li>çª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚ <code>iframe</code> çš„ <code>contentWindow</code> å±æ€§ï¼Œæ‰§è¡Œ <code>window.open</code> è¿”å›çš„çª—å£å¯¹è±¡ï¼Œæˆ–è€…æ˜¯å‘½åè¿‡çš„æˆ–æ•°å€¼ç´¢å¼•çš„ <code>window.frames</code></li></ul></li><li>message<ul><li>è¦å‘é€åˆ°å…¶ä»–çª—å£çš„æ•°æ®ï¼Œå®ƒå°†ä¼šè¢« <a href="https://developer.mozilla.org/en-US/docs/DOM/The_structured_clone_algorithm" target="_blank" rel="noopener">ç»“æ„åŒ–å…‹éš†ç®—æ³• </a> åºåˆ—åŒ–ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä¸å—ä»€ä¹ˆé™åˆ¶çš„å°†æ•°æ®å¯¹è±¡å®‰å…¨çš„ä¼ é€ç»™ç›®æ ‡çª—å£è€Œæ— éœ€è‡ªå·±åºåˆ—åŒ–</li></ul></li><li>targetOrigin<ul><li>é€šè¿‡çª—å£çš„ <code>origin</code> å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼ŒæŒ‡å®šååªæœ‰å¯¹åº” <code>origin</code> ä¸‹çš„çª—å£æ‰å¯ä»¥æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºé€šé…ç¬¦ <code>*</code> è¡¨ç¤ºå¯ä»¥å‘é€åˆ°ä»»ä½•çª—å£ï¼Œä½†é€šå¸¸å¤„äºå®‰å…¨æ€§è€ƒè™‘ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå¦‚æœæƒ³è¦å‘é€åˆ°ä¸å½“å‰çª—å£åŒæºçš„çª—å£ï¼Œå¯è®¾ç½®ä¸º <code>/</code></li></ul></li><li>transfer | å¯é€‰å±æ€§<ul><li>æ˜¯ä¸€ä¸²å’Œ <code>message</code> åŒæ—¶ä¼ é€’çš„ <strong>Transferable</strong> å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒ</li></ul></li></ul><p>å®ƒä¹Ÿå¯ä»¥ç›‘å¬ <code>message</code> äº‹ä»¶çš„å‘ç”Ÿæ¥æ¥æ”¶æ•°æ®</p><pre><code class="hljs js"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"message"</span>, receiveMessage, <span class="hljs-literal">false</span>)<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">receiveMessage</span>(<span class="hljs-params">event</span>) </span>&#123;  <span class="hljs-keyword">let</span> origin= event.origin  <span class="hljs-built_in">console</span>.log(event)&#125;</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®æˆ˜ä¸‹è·¨åŸŸæƒ…å†µä¸‹ï¼Œé€šè¿‡ <code>window.postMessage</code> æ¥äº’é€šæ•°æ®</p><h4 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>è¿˜æ˜¯ä»¥ä¸åŒåŸŸçš„é¡µé¢ a å’Œ b ä¸ºä¾‹å­</p><p>é¡µé¢aï¼š<code>http://www.hahaha1.com/abc/a.html</code>ï¼Œåˆ›å»ºè·¨åŸŸ <code>iframe</code> å¹¶å‘é€ä¿¡æ¯</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha2.com/abc/b.html"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frame"</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">"load()"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span><span class="hljs-params">()</span> </span>&#123;</span><span class="javascript">    <span class="hljs-keyword">let</span> frame = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'frame'</span>)</span><span class="actionscript">    <span class="hljs-comment">// å‘é€</span></span><span class="actionscript">    frame.contentWindow.postMessage(<span class="hljs-string">'å“ˆå–½ï¼Œæˆ‘æ˜¯a'</span>, <span class="hljs-string">'http://www.hahaha2.com/abc/b.html'</span>)</span>    <span class="actionscript">    <span class="hljs-comment">// æ¥æ”¶</span></span><span class="javascript">    <span class="hljs-built_in">window</span>.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;</span><span class="javascript">      <span class="hljs-built_in">console</span>.log(e.data) <span class="hljs-comment">// ä½ å¥½ï¼Œæˆ‘æ˜¯b</span></span>    &#125;  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢bï¼š<code>http://www.hahaha2.com/abc/b.html</code>ï¼Œæ¥æ”¶æ•°æ®å¹¶è¿”å›ä¿¡æ¯</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">  <span class="hljs-comment">// æ¥æ”¶</span></span><span class="javascript">  <span class="hljs-built_in">window</span>.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(e.data) <span class="hljs-comment">// å“ˆå–½ï¼Œæˆ‘æ˜¯a</span></span><span class="actionscript">    <span class="hljs-comment">// è¿”å›æ•°æ®</span></span><span class="actionscript">    e.source.postMessage(<span class="hljs-string">'ä½ å¥½ï¼Œæˆ‘æ˜¯b'</span>, e.origin)</span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><h3 id="No-5-JSONPè·¨åŸŸ"><a href="#No-5-JSONPè·¨åŸŸ" class="headerlink" title="No.5 JSONPè·¨åŸŸ"></a>No.5 JSONPè·¨åŸŸ</h3><h4 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h4><p>å¯¹äº <code>JSONP</code> è¿™å—ï¼Œè™½ç„¶ä¸å¸¸ç”¨ï¼Œæˆ‘ä»¬å¥½å¥½çš„æä¸€ä¸‹ï¼Œå› ä¸ºé‡åˆ°è¿‡ä¸€äº›åˆå­¦è€…ï¼ŒæŠŠ <code>AJAX</code> å’Œ <code>JSONP</code> æ··ä¸ºä¸€è°ˆäº†ï¼Œæèµ· <code>JSONP</code> ï¼Œä¼šè¯´å¾ˆ easyï¼Œå°±æ˜¯åœ¨ <code>AJAX</code> è¯·æ±‚é‡Œè®¾ç½®ä¸€ä¸‹å­—æ®µå°±è¡Œäº†ï¼Œå¯èƒ½ä½ ç”¨è¿‡ <code>JQuery</code> å°è£…åçš„ <code>JSONP</code> è·¨åŸŸæ–¹å¼ï¼Œç¡®å®åªæ˜¯åœ¨è¯·æ±‚é‡ŒåŠ ä¸ªå­—æ®µï¼Œä½†æ˜¯ï¼Œé‚£æ˜¯ JQ å°è£…å¥½çš„ä¸€ç§ä½¿ç”¨æ–¹å¼è€Œå·²ï¼Œå¯ä¸èƒ½è¢«è¡¨è±¡è¿·æƒ‘ï¼Œä½ çœŸçš„æ‡‚å®ƒçš„åŸç†å—ï¼ˆJQï¼šæˆ‘å¯ä¸èƒŒé”…ï¼ï¼ï¼ï¼‰</p><h4 id="AJAXå·¥ä½œåŸç†"><a href="#AJAXå·¥ä½œåŸç†" class="headerlink" title="AJAXå·¥ä½œåŸç†"></a>AJAXå·¥ä½œåŸç†</h4><p><code>Ajax</code> çš„åŸç†ç®€å•æ¥è¯´é€šè¿‡æµè§ˆå™¨çš„ <code>javascript</code> å¯¹è±¡ <code>XMLHttpRequest</code> ï¼ˆAjaxå¼•æ“ï¼‰å¯¹è±¡å‘æœåŠ¡å™¨å‘é€å¼‚æ­¥è¯·æ±‚å¹¶æ¥æ”¶æœåŠ¡å™¨çš„å“åº”æ•°æ®ï¼Œç„¶åç”¨ <code>javascript</code> æ¥æ“ä½œ DOM è€Œæ›´æ–°é¡µé¢</p><p>è¿™å…¶ä¸­æœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ä»æœåŠ¡å™¨è·å¾—è¯·æ±‚æ•°æ®ï¼Œå³ç”¨æˆ·çš„è¯·æ±‚é—´æ¥é€šè¿‡ <code>Ajax</code> å¼•æ“å‘å‡ºè€Œä¸æ˜¯é€šè¿‡æµè§ˆå™¨ç›´æ¥å‘å‡ºï¼ŒåŒæ—¶ <code>Ajax</code> å¼•æ“ä¹Ÿæ¥æ”¶æœåŠ¡å™¨è¿”å›å“åº”çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´æµè§ˆå™¨ä¸Šçš„é¡µé¢å…¨éƒ¨åˆ·æ–°</p><p>ä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆç®€å•</p><pre><code class="hljs livecodeserver">ä¸€ï¼šåˆ›å»ºXMLHttpRequestå¯¹è±¡,ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªå¼‚æ­¥è°ƒç”¨å¯¹è±¡äºŒï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„HTTPè¯·æ±‚,å¹¶æŒ‡å®šè¯¥HTTPè¯·æ±‚çš„æ–¹æ³•ã€<span class="hljs-built_in">URL</span>åŠéªŒè¯ä¿¡æ¯ä¸‰ï¼šè®¾ç½®å“åº”HTTPè¯·æ±‚çŠ¶æ€å˜åŒ–çš„å‡½æ•°å››ï¼šå‘é€HTTPè¯·æ±‚äº”ï¼šè·å–å¼‚æ­¥è°ƒç”¨è¿”å›çš„æ•°æ®</code></pre><h4 id="JSONPï¼ŒJSONï¼Ÿ"><a href="#JSONPï¼ŒJSONï¼Ÿ" class="headerlink" title="JSONPï¼ŒJSONï¼Ÿ"></a>JSONPï¼ŒJSONï¼Ÿ</h4><p><code>JSONï¼ˆJavaScript Object Notationï¼‰</code> å¤§å®¶åº”è¯¥æ˜¯å¾ˆäº†è§£ï¼Œå°±æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œä¸äº†è§£çš„åŒå­¦å¯ä»¥å»<a href="http://www.json.org/json-zh.html" target="_blank" rel="noopener">json.org </a> ä¸Šäº†è§£ä¸‹ï¼Œåˆ†åˆ†é’Ÿæå®š</p><p>è€Œ <code>JSONPï¼ˆJSON with Paddingï¼‰</code> ï¼Œå®ƒæ˜¯ä¸€ä¸ª <strong>éå®˜æ–¹</strong> çš„åè®®ï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯é›†æˆ <code>Script tags</code> è¿”å›è‡³å®¢æˆ·ç«¯ï¼Œé€šè¿‡ <code>javascript callback</code> çš„å½¢å¼å®ç°è·¨åŸŸè®¿é—®ï¼Œè¿™å°±æ˜¯ç®€å•çš„JSONPå®ç°å½¢å¼ï¼Œè¿™ä¹ˆè¯´å¯èƒ½ä¸å¤ªæ˜ç™½ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒåˆ°åº•æ˜¯æ€ä¹ˆä¸ªåŸç†</p><h4 id="JSONPå·¥ä½œåŸç†"><a href="#JSONPå·¥ä½œåŸç†" class="headerlink" title="JSONPå·¥ä½œåŸç†"></a>JSONPå·¥ä½œåŸç†</h4><p>å…ˆæ¥çœ‹ä¸ªå°ä¾‹å­ï¼Œè¿˜æ˜¯ä¸åŒåŸŸçš„ a å’Œ b ä¸¤é¡µé¢</p><p>é¡µé¢aï¼š<code>http://www.hahaha1.com/abc/a.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha2.com/abc/b.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-built_in">console</span>.log(b) <span class="hljs-comment">// æˆ‘æ˜¯b</span></span>  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p>é¡µé¢bï¼š<code>http://www.hahaha2.com/abc/b.js</code></p><pre><code class="hljs js"><span class="hljs-keyword">var</span> b = <span class="hljs-string">"æˆ‘æ˜¯b"</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ä¸åŒåŸŸï¼Œä½†æ˜¯ a é¡µé¢ä¸­è¿˜æ˜¯å¯ä»¥è®¿é—®åˆ°å¹¶æ‰“å°å‡ºäº† b é¡µé¢ä¸­çš„å˜é‡</p><p>è¿™ä¸ªå°ä¾‹å­æˆ‘ä»¬å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ° <code>&lt;script&gt;</code> æ ‡ç­¾çš„ src å±æ€§å¹¶ä¸è¢«åŒæºç­–ç•¥æ‰€çº¦æŸï¼Œæ‰€ä»¥å¯ä»¥è·å–ä»»ä½•æœåŠ¡å™¨ä¸Šè„šæœ¬å¹¶æ‰§è¡Œå®ƒï¼Œè¿™å°±æ˜¯ <code>JSONP</code> æœ€æ ¸å¿ƒçš„åŸç†äº†ï¼Œè‡³äºå®ƒå¦‚ä½•ä¼ é€’æ•°æ®ï¼Œæˆ‘ä»¬æ¥ç®€å•å®ç°ä¸€ä¸ª</p><h4 id="JSONPçš„CallBackå®ç°"><a href="#JSONPçš„CallBackå®ç°" class="headerlink" title="JSONPçš„CallBackå®ç°"></a>JSONPçš„CallBackå®ç°</h4><p>åˆšæ‰çš„ä¾‹å­è¯´äº†è·¨åŸŸçš„åŸç†ï¼Œè€Œä¸”æˆ‘ä»¬ä¹‹å‰æœ‰è®²åˆ° <code>javascript callback</code> çš„å½¢å¼å®ç°è·¨åŸŸè®¿é—®ï¼Œé‚£æˆ‘ä»¬å°±æ¥ä¿®æ”¹ä¸‹ä»£ç ï¼Œå¦‚ä½•å®ç° <code>JSONP</code> çš„ <code>javascript callback</code> çš„å½¢å¼</p><p>é¡µé¢aï¼š<code>http://www.hahaha1.com/abc/a.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="actionscript">  <span class="hljs-comment">//å›è°ƒå‡½æ•°</span></span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cb</span><span class="hljs-params">(res)</span> </span>&#123;</span><span class="javascript">      <span class="hljs-built_in">console</span>.log(res.data.b) <span class="hljs-comment">// æˆ‘æ˜¯b</span></span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.hahaha2.com/abc/b.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>é¡µé¢bï¼š<code>http://www.hahaha2.com/abc/b.js</code></p><pre><code class="hljs js"><span class="hljs-keyword">var</span> b = <span class="hljs-string">"æˆ‘æ˜¯b"</span><span class="hljs-comment">// è°ƒç”¨cbå‡½æ•°ï¼Œå¹¶ä»¥jsonæ•°æ®å½¢å¼ä½œä¸ºå‚æ•°ä¼ é€’</span>cb(&#123;  code:<span class="hljs-number">200</span>,   msg:<span class="hljs-string">"success"</span>,  data:&#123;    b: b  &#125;&#125;)</code></pre><p>åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡ä¸Šè°ƒç”¨è¿™ä¸ªå‡½æ•°å¹¶ä¸”å°†JSON æ•°æ®å½¢å¼ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå®Œæˆå›è°ƒï¼Œå°±æ˜¯ <code>JSONP</code> çš„ç®€å•å®ç°æ¨¡å¼ï¼Œæˆ–è€…è¯´æ˜¯ <code>JSONP</code> çš„åŸå‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢</p><p>å°† <code>JSON</code> æ•°æ®å¡«å……è¿›å›è°ƒå‡½æ•°ï¼Œç°åœ¨æ‡‚ä¸ºä»€ä¹ˆ <code>JSONP</code> å« <code>JSON with Padding</code> äº†å§</p><p>ä¸Šé¢è¿™ç§å®ç°å¾ˆç®€å•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ª <code>script</code> æ ‡ç­¾èƒ½å¤ŸåŠ¨æ€çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯åƒä¸Šé¢å› ä¸ºå›ºå®šåœ¨ <code>HTML</code> é‡Œé¢åŠ è½½æ—¶ç›´æ¥æ‰§è¡Œäº†ï¼Œå¾ˆä¸çµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>javascript</code> åŠ¨æ€çš„åˆ›å»º <code>script</code> æ ‡ç­¾ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çµæ´»è°ƒç”¨è¿œç¨‹æœåŠ¡äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç®€å•æ”¹é€ ä¸‹é¡µé¢ a å¦‚ä¸‹</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cb</span><span class="hljs-params">(res)</span> </span>&#123;</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(res.data.b)  <span class="hljs-comment">// æˆ‘æ˜¯b</span></span>  &#125;  <span class="handlebars"><span class="xml">  // åŠ¨æ€æ·»åŠ  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> æ ‡ç­¾æ–¹æ³•</span></span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addScriptTag</span><span class="hljs-params">(src)</span></span>&#123;</span><span class="javascript">    <span class="hljs-keyword">let</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>)</span><span class="actionscript">    script.setAttribute(<span class="hljs-string">"type"</span>,<span class="hljs-string">"text/javascript"</span>)</span>    script.src = src<span class="javascript">    <span class="hljs-built_in">document</span>.body.appendChild(script)</span>  &#125;<span class="javascript">  <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;</span><span class="actionscript">    addScriptTag(<span class="hljs-string">"http://www.hahaha2.com/abc/b.js"</span>)</span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œåªæ˜¯äº›åŸºç¡€æ“ä½œï¼Œå°±ä¸è§£é‡Šäº†ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä¼˜é›…çš„æ§åˆ¶æ‰§è¡Œäº†ï¼Œå†æƒ³è°ƒç”¨ä¸€ä¸ªè¿œç¨‹æœåŠ¡çš„è¯ï¼Œåªè¦æ·»åŠ  <code>addScriptTag</code> æ–¹æ³•ï¼Œä¼ å…¥è¿œç¨‹æœåŠ¡çš„ src å€¼å°±å¯ä»¥</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„è¿›è¡Œä¸€æ¬¡çœŸæ­£æ„ä¹‰ä¸Šçš„ <code>JSONP</code> æœåŠ¡è°ƒå–äº†</p><p>æˆ‘ä»¬ä½¿ç”¨ <code>jsonplaceholder</code> çš„ <code>todos</code> æ¥å£ä½œä¸ºç¤ºä¾‹ï¼Œæ¥å£åœ°å€å¦‚ä¸‹</p><pre><code class="hljs dts"><span class="hljs-symbol">https:</span><span class="hljs-comment">//jsonplaceholder.typicode.com/todos?callback=?</span></code></pre><p><code>callback=?</code> è¿™ä¸ªæ‹¼åœ¨æ¥å£åé¢è¡¨ç¤ºå›è°ƒå‡½æ•°çš„åç§°ï¼Œä¹Ÿå°±æ˜¯å°†ä½ è‡ªå·±åœ¨å®¢æˆ·ç«¯å®šä¹‰çš„å›è°ƒå‡½æ•°çš„å‡½æ•°åä¼ é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åˆ™ä¼šè¿”å›ä»¥ä½ å®šä¹‰çš„å›è°ƒå‡½æ•°åçš„æ–¹æ³•ï¼Œå°†è·å–çš„ <code>JSON</code> æ•°æ®ä¼ å…¥è¿™ä¸ªæ–¹æ³•å®Œæˆå›è°ƒï¼Œæˆ‘ä»¬çš„å›è°ƒå‡½æ•°åå­—å« <code>cb</code>ï¼Œé‚£ä¹ˆå®Œæ•´çš„æ¥å£åœ°å€å°±å¦‚ä¸‹</p><pre><code class="hljs vim">http<span class="hljs-variable">s:</span>//jsonplaceholder.typicode.<span class="hljs-keyword">com</span>/todos?callback=<span class="hljs-keyword">cb</span></code></pre><p>é‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬æ¥è¯•ä¸‹</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cb</span><span class="hljs-params">(res)</span> </span>&#123;</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(res)</span>  &#125;  <span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addScriptTag</span><span class="hljs-params">(src)</span></span>&#123;</span><span class="javascript">    <span class="hljs-keyword">let</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>)</span><span class="actionscript">    script.setAttribute(<span class="hljs-string">"type"</span>,<span class="hljs-string">"text/javascript"</span>)</span>    script.src = src<span class="javascript">    <span class="hljs-built_in">document</span>.body.appendChild(script)</span>  &#125;<span class="javascript">  <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;</span><span class="actionscript">    addScriptTag(<span class="hljs-string">"https://jsonplaceholder.typicode.com/todos?callback=cb"</span>)</span>  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢åœ¨åŠ è½½å®Œæˆåï¼Œè¾“å‡ºäº†æ¥å£è¿”å›çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†æ¥çœ‹ JQ ä¸­çš„ JSONP å®ç°</p><h4 id="JSONPçš„JQueryå®ç°"><a href="#JSONPçš„JQueryå®ç°" class="headerlink" title="JSONPçš„JQueryå®ç°"></a>JSONPçš„JQueryå®ç°</h4><p>è¿˜æ˜¯ç”¨ä¸Šé¢çš„æ¥å£ï¼Œæˆ‘ä»¬æ¥çœ‹ JQ æ€ä¹ˆæ‹¿æ•°æ®</p><pre><code class="hljs js">$.ajax(&#123;  url:<span class="hljs-string">"https://jsonplaceholder.typicode.com/todos?callback=?"</span>,     dataType:<span class="hljs-string">"jsonp"</span>,  jsonpCallback:<span class="hljs-string">"cb"</span>,  success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>&#123;    <span class="hljs-built_in">console</span>.log(res)  &#125;&#125;);</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ºäº†è®© JQ æŒ‰ç…§ <code>JSONP</code> çš„æ–¹å¼è®¿é—®ï¼Œ<code>dataType</code> å­—æ®µè®¾ç½®ä¸º <code>jsonp</code> ï¼Œ <code>jsonpCallback</code> å±æ€§çš„ä½œç”¨å°±æ˜¯è‡ªå®šä¹‰æˆ‘ä»¬çš„å›è°ƒæ–¹æ³•åï¼Œå…¶å®å†…éƒ¨å’Œæˆ‘ä»¬ä¸Šé¢å†™çš„å·®ä¸å¤š</p><h4 id="JSONPå’ŒAJAXå¯¹æ¯”"><a href="#JSONPå’ŒAJAXå¯¹æ¯”" class="headerlink" title="JSONPå’ŒAJAXå¯¹æ¯”"></a>JSONPå’ŒAJAXå¯¹æ¯”</h4><ul><li>è°ƒç”¨æ–¹å¼ä¸Š<ul><li><code>AJAX</code> å’Œ <code>JSONP</code> å¾ˆåƒï¼Œéƒ½æ˜¯è¯·æ±‚urlï¼Œç„¶åæŠŠæœåŠ¡å™¨è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†</li><li>æ‰€ä»¥ç±» <code>JQuery</code> çš„åº“åªæ˜¯æŠŠ <code>JSONP</code> ä½œä¸º <code>AJAX</code> è¯·æ±‚çš„ä¸€ç§å½¢å¼è¿›è¡Œå°è£…ï¼Œä¸è¦ææ··</li></ul></li><li>æ ¸å¿ƒåŸç†ä¸Š<ul><li><code>AJAX</code> çš„æ ¸å¿ƒæ˜¯é€šè¿‡ <code>xmlHttpRequest</code> è·å–éæœ¬é¡µå†…å®¹</li><li><code>JSONP</code>çš„æ ¸å¿ƒæ˜¯åŠ¨æ€æ·»åŠ  <code>script</code> æ ‡ç­¾è°ƒç”¨æœåŠ¡å™¨æä¾›çš„ JS è„šæœ¬ï¼Œåç¼€ <code>.json</code></li></ul></li><li>ä¸¤è€…åŒºåˆ«ä¸Šï¼Œ<ul><li><code>AJAX</code> ä¸åŒåŸŸä¼šæŠ¥è·¨åŸŸé”™è¯¯ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥é€šè¿‡æœåŠ¡ç«¯ä»£ç†ã€<code>CORS</code> ç­‰æ–¹å¼è·¨åŸŸï¼Œè€Œ <code>JSONP</code> æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼ŒåŒåŸŸä¸åŒåŸŸéƒ½å¯ä»¥</li><li><code>JSONP</code> æ˜¯ä¸€ç§æ–¹å¼æˆ–è€…è¯´éå¼ºåˆ¶æ€§çš„åè®®ï¼Œ<code>AJAX</code> ä¹Ÿä¸ä¸€å®šéè¦ç”¨ <code>json</code> æ ¼å¼æ¥ä¼ é€’æ•°æ®â€ƒ</li><li><code>JSONP</code> åªæ”¯æŒ <code>GET</code> è¯·æ±‚ï¼Œ<code>AJAX</code> æ”¯æŒ <code>GET</code> å’Œ <code>POST</code></li></ul></li></ul><p>æœ€åï¼ŒJSONPæ˜¯å¾ˆè€çš„ä¸€ç§è·¨åŸŸæ–¹å¼äº†ï¼Œç°åœ¨åŸºæœ¬æ²¡ä»€ä¹ˆäººç”¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬äº†è§£æ‡‚å®ƒå³å¯</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªscriptæ ‡ç­¾èƒ½å¤ŸåŠ¨æ€çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯åƒä¸Šé¢å› ä¸ºå›ºå®šåœ¨htmlé‡Œé¢æ‰€ä»¥æ²¡ç­‰é¡µé¢æ˜¾ç¤ºå°±æ‰§è¡Œäº†ï¼Œå¾ˆä¸çµæ´»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡javascriptåŠ¨æ€çš„åˆ›å»ºscriptæ ‡ç­¾ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çµæ´»è°ƒç”¨è¿œç¨‹æœåŠ¡äº†</p><h3 id="No-6-CORSè·¨åŸŸèµ„æºå…±äº«"><a href="#No-6-CORSè·¨åŸŸèµ„æºå…±äº«" class="headerlink" title="No.6 CORSè·¨åŸŸèµ„æºå…±äº«"></a>No.6 CORSè·¨åŸŸèµ„æºå…±äº«</h3><h4 id="ä»€ä¹ˆæ˜¯CORSï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯CORSï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯CORSï¼Ÿ"></a>ä»€ä¹ˆæ˜¯CORSï¼Ÿ</h4><p>åœ¨å‡ºç° <code>CORS</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ <code>JSONP</code> çš„æ–¹å¼å®ç°è·¨åŸŸï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä»…é™äº <code>GET</code> è¯·æ±‚ï¼Œè€Œ <code>CORS</code> çš„å‡ºç°ï¼Œä¸ºæˆ‘ä»¬å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯å®ƒæˆä¸ºä¸€ä¸ªè¶‹åŠ¿çš„åŸå› </p><pre><code class="hljs routeros">CORS` æ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯ `è·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-origin<span class="hljs-built_in"> resource </span>sharingï¼‰</code></pre><p>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º <code>XMLHttpRequest</code> è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† <code>AJAX</code> åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶</p><p><code>CORS</code> éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒï¼Œç›®å‰åŸºæœ¬æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸ä½äº IE10 å³å¯</p><p>æ•´ä¸ª <code>CORS</code> é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œæ˜¯ä¸éœ€è¦ç”¨æˆ·å‚ä¸çš„ï¼Œå¯¹äºæˆ‘ä»¬å¼€å‘è€…æ¥è¯´ï¼Œ<code>CORS</code> é€šä¿¡ä¸åŒæºçš„ <code>AJAX</code> é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ï¼Œæµè§ˆå™¨ä¸€æ—¦å‘ç° <code>AJAX</code> è¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰çš„æ—¶å€™è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä¸­ç”¨æˆ·æ˜¯æ— æ„Ÿçš„</p><p>å› æ­¤ï¼Œå®ç° <code>CORS</code> é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ï¼Œåªè¦æœåŠ¡å™¨è®¾ç½®äº†å…è®¸çš„ <code>CORS</code> æ¥å£ï¼Œå°±å¯ä»¥è¿›è¡Œè·¨æºé€šä¿¡ï¼Œè¦äº†è§£æ€ä¹ˆå®ç° <code>CORS</code> è·¨åŸŸé€šä¿¡ï¼Œæˆ‘ä»¬è¿˜è¦å…ˆäº†è§£æµè§ˆå™¨å¯¹æ¯ä¸ªè¯·æ±‚éƒ½åšäº†ä»€ä¹ˆ</p><p>æµè§ˆå™¨ä¼šå°† <code>CORS</code> è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼Œç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ï¼Œæµè§ˆå™¨å¯¹è¿™ä¸¤ç§è¯·æ±‚çš„å¤„ç†ï¼Œæ˜¯ä¸ä¸€æ ·çš„</p><h4 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h4><p>ä»€ä¹ˆæ˜¯ç®€å•è¯·æ±‚ï¼Œå…¶å®å¾ˆå¥½ç†è§£è®°ä½ä¸¤æ¡å°±å¥½äº†</p><ul><li>è¯·æ±‚æ–¹æ³•æ˜¯ <code>HEADã€GETã€POST</code> ä¸‰ç§æ–¹æ³•ä¹‹ä¸€</li><li>HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µ<ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Last-Event-ID</li><li>Content-Typeï¼ˆåªé™äºä¸‰ä¸ªå€¼<code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code>ã€<code>text/plain</code>ï¼‰</li></ul></li></ul><p>åªè¦åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±æ˜¯ä¸€ä¸ªç®€å•è¯·æ±‚</p><p>å¯¹äºç®€å•è¯·æ±‚æ¥è¯´ï¼Œæµè§ˆå™¨ä¼šç›´æ¥å‘å‡ºCORSè¯·æ±‚ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªè¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ï¼Œè‡ªåŠ¨æ·»åŠ ä¸€ä¸ª <code>Origin</code> å­—æ®µæ¥è¯´æ˜æœ¬æ¬¡è¯·æ±‚çš„æ¥æºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ï¼Œè€ŒåæœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚</p><h4 id="éç®€å•è¯·æ±‚"><a href="#éç®€å•è¯·æ±‚" class="headerlink" title="éç®€å•è¯·æ±‚"></a>éç®€å•è¯·æ±‚</h4><p>çŸ¥é“äº†ç®€å•è¯·æ±‚çš„å®šä¹‰ï¼Œéç®€å•è¯·æ±‚å°±æ¯”è¾ƒç®€å•äº†ï¼Œå› ä¸ºåªè¦ä¸æ˜¯ç®€å•è¯·æ±‚ï¼Œå®ƒå°±æ˜¯éç®€å•è¯·æ±‚</p><p>æµè§ˆå™¨åº”å¯¹éç®€å•è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œåšä¸€æ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œå«é¢„æ£€è¯·æ±‚ï¼ˆpreflightï¼‰ï¼Œä¹Ÿå« <code>OPTIONS</code> è¯·æ±‚ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„è¯·æ±‚æ–¹å¼æ˜¯ <code>OPTIONS</code> ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„</p><p>æµè§ˆå™¨ä¼šå…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µï¼Œåªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„ <code>XMLHttpRequest</code> è¯·æ±‚ï¼Œå¦åˆ™å°±ä¼šæŠ¥è·¨åŸŸé”™è¯¯</p><p>åœ¨è¿™ä¸ªé¢„æ£€è¯·æ±‚é‡Œï¼Œå¤´ä¿¡æ¯é™¤äº†æœ‰è¡¨æ˜æ¥æºçš„ <code>Origin</code> å­—æ®µå¤–ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ª <code>Access-Control-Request-Method</code> å­—æ®µå’Œ <code>Access-Control-Request-Headers</code> å­—æ®µï¼Œå®ƒä»¬åˆ†åˆ«è¡¨æ˜äº†è¯¥æµè§ˆå™¨ <code>CORS</code> è¯·æ±‚ç”¨åˆ°çš„ <code>HTTP</code> è¯·æ±‚æ–¹æ³•å’ŒæŒ‡å®šæµè§ˆå™¨ <code>CORS</code> è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œå¦‚æœä½ çœ‹çš„äº‘é‡Œé›¾é‡Œï¼Œä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬çœ‹ä¸ªä¾‹å­</p><p>å¦‚ä¸‹ä¸ºä¸€ä¸ª AJAX è¯·æ±‚ç¤ºä¾‹</p><pre><code class="hljs js"><span class="hljs-keyword">let</span> url = <span class="hljs-string">'http://www.hahaha.com/abc'</span><span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()xhr.open(<span class="hljs-string">'POST'</span>, url, <span class="hljs-literal">true</span>)xhr.setRequestHeader(<span class="hljs-string">'X-Token'</span>, <span class="hljs-string">'YGJHJHGJAHSGJDHGSJGJHDGSJHS'</span>)xhr.setRequestHeader(<span class="hljs-string">'X-Test'</span>, <span class="hljs-string">'YGJHJHGJAHSGJDHGSJGJHDGSJHS'</span>)xhr.send()</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘é€äº†ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œå¹¶åœ¨å®ƒçš„è¯·æ±‚å¤´ä¸­æ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>X-Token</code> å’Œ <code>X-Test</code> å­—æ®µï¼Œå› ä¸ºæ·»åŠ äº†è‡ªå®šä¹‰è¯·æ±‚å¤´å­—æ®µï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚</p><p>é‚£ä¹ˆè¿™ä¸ªéç®€å•è¯·æ±‚åœ¨é¢„æ£€è¯·æ±‚å¤´ä¿¡æ¯ä¸­å°±ä¼šæºå¸¦ä»¥ä¸‹ä¿¡æ¯</p><pre><code class="hljs html">// æ¥æºOrigin: http://www.hahaha.com// è¯¥CORSè¯·æ±‚çš„è¯·æ±‚æ–¹æ³•Access-Control-Request-Method: POST// é¢å¤–å‘å‡ºçš„å¤´ä¿¡æ¯å­—æ®µAccess-Control-Request-Headers: X-Token, X-Test</code></pre><h4 id="withCredentialså±æ€§"><a href="#withCredentialså±æ€§" class="headerlink" title="withCredentialså±æ€§"></a>withCredentialså±æ€§</h4><p>CORS è¯·æ±‚é»˜è®¤ä¸å‘é€ Cookie å’Œ HTTP è®¤è¯ä¿¡æ¯</p><p>å¦‚æœè¦æŠŠ Cookie å‘åˆ°æœåŠ¡ç«¯ï¼Œé¦–å…ˆè¦æœåŠ¡ç«¯åŒæ„ï¼ŒæŒ‡å®š<code>Access-Control-Allow-Credentials</code> å­—æ®µ</p><pre><code class="hljs yaml"><span class="hljs-attr">Access-Control-Allow-Credentials:</span> <span class="hljs-literal">true</span></code></pre><p>å…¶æ¬¡ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨å‘èµ·çš„è¯·æ±‚ä¸­æ‰“å¼€ <code>withCredentials</code> å±æ€§</p><pre><code class="hljs ini"><span class="hljs-attr">xhr</span> = new XMLHttpRequest()<span class="hljs-attr">xhr.withCredentials</span> = <span class="hljs-literal">true</span></code></pre><p>ä¸ç„¶çš„è¯ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æœ‰ä¸€ä¸ªæ²¡è®¾ç½®ï¼Œå°±ä¸ä¼šå‘é€æˆ–å¤„ç†Cookie</p><p>è™½è¯´æµè§ˆå™¨é»˜è®¤ä¸å‘é€ Cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ï¼Œä½†æ˜¯æœ‰çš„æµè§ˆå™¨ï¼Œè¿˜æ˜¯ä¼šä¸€èµ·å‘é€Cookieï¼Œè¿™æ—¶ä½ ä¹Ÿå¯ä»¥æ˜¾å¼å…³é—­ <code>withCredentials</code></p><pre><code class="hljs ini"><span class="hljs-attr">xhr.withCredentials</span> = <span class="hljs-literal">false</span></code></pre><p>æ³¨æ„ï¼Œå¦‚è¦å‘é€ <code>Cookie</code>ï¼Œ<code>Access-Control-Allow-Origin</code> å­—æ®µå°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåï¼ŒåŒæ—¶ï¼Œ<code>Cookie</code> ä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„ <code>Cookie</code> æ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„ <code>Cookie</code> å¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„ <code>document.cookie</code> ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„ <code>Cookie</code> ï¼Œä¸‹é¢è¿˜ä¼šæåˆ°</p><h4 id="æœåŠ¡ç«¯CORSè·¨åŸŸé…ç½®"><a href="#æœåŠ¡ç«¯CORSè·¨åŸŸé…ç½®" class="headerlink" title="æœåŠ¡ç«¯CORSè·¨åŸŸé…ç½®"></a>æœåŠ¡ç«¯CORSè·¨åŸŸé…ç½®</h4><p>ä¸Šé¢çš„ä¸œè¥¿åªæ˜¯ä¸ºäº†è®©æˆ‘ä»¬ç†è§£CORSï¼Œä½†æ˜¯è¦è§£å†³å®ƒè¿˜æ˜¯éœ€è¦æœåŠ¡ç«¯é…ç½®çš„ï¼Œä¸åŒè¯­è¨€çš„é…ç½®é¡¹è¯­æ³•ä¸Šå¯èƒ½æœ‰å·®å¼‚ï¼Œä½†æ˜¯å†…å®¹è‚¯å®šéƒ½æ˜¯ä¸€æ ·çš„</p><p><strong>é…ç½®å…è®¸è·¨åŸŸçš„æ¥æº</strong></p><pre><code class="hljs ada"><span class="hljs-keyword">Access</span>-Control-Allow-Origin: *</code></pre><p><code>CORS</code> è·¨åŸŸè¯·æ±‚ä¸­ï¼Œæœ€å…³é”®çš„å°±æ˜¯ <code>Access-Control-Allow-Origin</code> å­—æ®µï¼Œæ˜¯å¿…éœ€é¡¹ï¼Œå®ƒè¡¨ç¤ºæœåŠ¡ç«¯å…è®¸è·¨åŸŸè®¿é—®çš„åœ°å€æ¥æºï¼Œä½ å¯ä»¥å†™å…¥éœ€è¦è·¨åŸŸçš„åŸŸåï¼Œä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚</p><p>æ³¨æ„ï¼Œå°†æ­¤å­—æ®µè®¾ç½®ä¸º <code>*</code> æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œå»ºè®®æŒ‡å®šæ¥æºï¼Œå¹¶ä¸”è®¾ç½®ä¸º <code>*</code> å·åï¼Œæ¸¸è§ˆå™¨å°†ä¸ä¼šå‘é€ <code>Cookie</code>ï¼Œå³ä½¿ä½ çš„ <code>XHR</code> è®¾ç½®äº† <code>withCredentials</code>ï¼Œä¹Ÿä¸ä¼šå‘é€ <code>Cookie</code></p><p><strong>é…ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•</strong></p><pre><code class="hljs gams">Access-Control-Allow-Methods: GET, POST, <span class="hljs-keyword">OPTIONS</span>, <span class="hljs-keyword">PUT</span>...</code></pre><p>è¯¥å­—æ®µä¹Ÿæ˜¯å¿…éœ€é¡¹ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•</p><p><strong>é…ç½®å…è®¸çš„è¯·æ±‚å¤´å­—æ®µ</strong></p><pre><code class="hljs ada"><span class="hljs-keyword">Access</span>-Control-Allow-Headers: x-requested-<span class="hljs-keyword">with</span>,content-<span class="hljs-keyword">type</span>...</code></pre><p>å¦‚æœä½ çš„è¯·æ±‚ä¸­æœ‰è‡ªå®šä¹‰çš„è¯·æ±‚å¤´å­—æ®µï¼Œé‚£ä¹ˆæ­¤é¡¹ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨é¢„æ£€ä¸­è¯·æ±‚çš„å­—æ®µ</p><p><strong>é…ç½®æ˜¯å¦å…è®¸å‘é€Cookie</strong></p><pre><code class="hljs yaml"><span class="hljs-attr">Access-Control-Allow-Credentials:</span> <span class="hljs-literal">true</span></code></pre><p>è¯¥å­—æ®µå¯é€‰ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­</p><p>è®¾ä¸º<code>true</code>ï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨</p><p>è¯¥å­—æ®µåªèƒ½è®¾ä¸º<code>true</code>ï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯</p><p><strong>é…ç½®æœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸ</strong></p><pre><code class="hljs fortran"><span class="hljs-keyword">Access</span>-Control-<span class="hljs-built_in">Max</span>-Age: <span class="hljs-number">1728000</span></code></pre><p>è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ï¼Œä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯20å¤©ï¼ˆ1728000ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº”20å¤©ï¼Œåœ¨æ­¤æœŸé—´å¦‚æœä½ å†æ¬¡å‘å‡ºäº†è¿™ä¸ªæ¥å£è¯·æ±‚ï¼Œå°±ä¸ç”¨å‘é¢„æ£€è¯·æ±‚äº†ï¼ŒèŠ‚çœæœåŠ¡ç«¯èµ„æº</p><h4 id="å¸¸è§çš„è·¨åŸŸé¢„æ£€è¯·æ±‚æŠ›é”™"><a href="#å¸¸è§çš„è·¨åŸŸé¢„æ£€è¯·æ±‚æŠ›é”™" class="headerlink" title="å¸¸è§çš„è·¨åŸŸé¢„æ£€è¯·æ±‚æŠ›é”™"></a>å¸¸è§çš„è·¨åŸŸé¢„æ£€è¯·æ±‚æŠ›é”™</h4><p>å¯¹äºæˆ‘ä»¬å¼€å‘æ—¶ï¼Œåœ¨è·¨åŸŸä¸­æœ€å®¹æ˜“ç¢°é’‰å­çš„åœ°æ–¹å°±æ˜¯é¢„æ£€è¯·æ±‚ï¼Œæ‰€ä»¥åˆ—ä¸¾å‡ ä¸ªé¢„æ£€è¯·æ±‚é”™è¯¯çš„åŸå› ï¼ŒçŸ¥é“å“ªé”™äº†å¯ä»¥ç›´æ¥æ‰¾åç«¯åŒå­¦ç†è®ºï¼Œå…³äºé¢„æ£€è¯·æ±‚ï¼Œæœ€ç»ˆç›®çš„åªæœ‰ä¸€ä¸ªï¼Œå®¢æˆ·ç«¯å‘é€é¢„æ£€ï¼ŒæœåŠ¡ç«¯å…è®¸å¹¶è¿”å›200å³å¯</p><p><strong>OPTIONS 404</strong></p><pre><code class="hljs routeros"><span class="hljs-literal">No</span> <span class="hljs-string">'Access-Control-Allow-Origin'</span> header is present on the requested resourceä¸” The response had HTTP status code 404</code></pre><p>æœåŠ¡ç«¯æ²¡æœ‰è®¾ç½®å…è®¸ <code>OPTIONS</code> è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨å‘èµ·è¯¥é¢„æ£€è¯·æ±‚æ—¶å“åº”çŠ¶æ€ç ä¼šæ˜¯404ï¼Œå› ä¸ºæ— æ³•æ‰¾åˆ°å¯¹åº”æ¥å£åœ°å€</p><p>é‚£ä¹ˆä½ å¯èƒ½éœ€è¦æ‰¾åˆ°åç«¯ï¼Œä¼˜é›…çš„å‘Šè¯‰ä»–ï¼Œè¯·å…è®¸ä¸‹ <code>OPTIONS</code> è¯·æ±‚</p><p><strong>OPTIONS 405</strong></p><pre><code class="hljs routeros"><span class="hljs-literal">No</span> <span class="hljs-string">'Access-Control-Allow-Origin'</span> header is present on the requested resourceä¸” The response had HTTP status code 405</code></pre><p>æœåŠ¡ç«¯å·²ç»å…è®¸äº† <code>OPTIONS</code> è¯·æ±‚ï¼Œä½†æ˜¯ä¸€äº›é…ç½®æ–‡ä»¶ä¸­ï¼ˆå¦‚å®‰å…¨é…ç½®ï¼‰é˜»æ­¢äº† <code>OPTIONS</code> è¯·æ±‚</p><p>é‚£ä¹ˆä½ å¯èƒ½éœ€è¦æ‰¾åˆ°åç«¯ï¼Œä¼˜é›…çš„å‘Šè¯‰ä»–ï¼Œè¯·å…³é—­å¯¹åº”çš„å®‰å…¨é…ç½®</p><p><strong>OPTIONS 200</strong></p><pre><code class="hljs routeros"><span class="hljs-literal">No</span> <span class="hljs-string">'Access-Control-Allow-Origin'</span> header is present on the requested resourceä¸” OPTIONS è¯·æ±‚ status ä¸º 200</code></pre><p>æœåŠ¡å™¨ç«¯å…è®¸äº† <code>OPTIONS</code> è¯·æ±‚ï¼Œé…ç½®æ–‡ä»¶ä¸­ä¹Ÿæ²¡æœ‰é˜»æ­¢ï¼Œä½†æ˜¯å¤´éƒ¨åŒ¹é…æ—¶å‡ºç°ä¸åŒ¹é…ç°è±¡</p><p>æ‰€è°“å¤´éƒ¨åŒ¹é…ï¼Œå°±æ¯”å¦‚ <code>Origin</code> å¤´éƒ¨æ£€æŸ¥ä¸åŒ¹é…ï¼Œæˆ–è€…å°‘äº†ä¸€äº›å¤´éƒ¨çš„æ”¯æŒï¼ˆå¦‚ <code>X-Requested-With</code> ç­‰ï¼‰,ç„¶åæœåŠ¡ç«¯å°±ä¼šå°† <code>Response</code> è¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯æ£€æµ‹åˆ°è¿™ä¸ªåå°±è§¦å‘ <code>XHR.onerror</code> ï¼Œä»è€Œå¯¼è‡´æŠ¥é”™</p><p>é‚£ä¹ˆä½ å¯èƒ½éœ€è¦æ‰¾åˆ°åç«¯ï¼Œä¼˜é›…çš„å‘Šè¯‰ä»–ï¼Œè¯·å¢åŠ å¯¹åº”çš„å¤´éƒ¨æ”¯æŒ</p><p><strong>OPTIONS 500</strong></p><p>è¿™ä¸ªå°±æ›´ç®€å•äº†ï¼ŒæœåŠ¡ç«¯é’ˆå¯¹ <code>OPTIONS</code> è¯·æ±‚çš„ä»£ç å‡ºäº†é—®é¢˜ï¼Œæˆ–è€…æ²¡æœ‰å“åº”</p><p>é‚£ä¹ˆä½ å¯èƒ½éœ€è¦æ‰¾åˆ°åç«¯ï¼Œå°† <code>Network</code> ä¸­çš„é”™è¯¯ä¿¡æ¯æˆªä¸€å›¾å‘ç»™ä»–ï¼Œä¼˜é›…çš„å‘Šè¯‰ä»–ï¼Œæ£€æµ‹åˆ°é¢„æ£€è¯·æ±‚æ—¶ï¼Œè¯·æŠŠå®ƒææˆ200</p><h3 id="No-7-Nginxä»£ç†è·¨åŸŸ"><a href="#No-7-Nginxä»£ç†è·¨åŸŸ" class="headerlink" title="No.7 Nginxä»£ç†è·¨åŸŸ"></a>No.7 Nginxä»£ç†è·¨åŸŸ</h3><h4 id="iconfontè·¨åŸŸè§£å†³"><a href="#iconfontè·¨åŸŸè§£å†³" class="headerlink" title="iconfontè·¨åŸŸè§£å†³"></a>iconfontè·¨åŸŸè§£å†³</h4><p>æµè§ˆå™¨è·¨åŸŸè®¿é—® <code>js/css/img</code> ç­‰å¸¸è§„é™æ€èµ„æºæ—¶è¢«åŒæºç­–ç•¥è®¸å¯çš„ï¼Œä½† <code>iconfont</code> å­—ä½“æ–‡ä»¶æ¯”å¦‚ <code>eot|otf|ttf|woff|svg</code> ä¾‹å¤–ï¼Œæ­¤æ—¶å¯åœ¨ <code>Nginx</code> çš„é™æ€èµ„æºæœåŠ¡å™¨ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®æ¥è§£å†³</p><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123;</span><span class="hljs-title">  add_header</span> Access-Control-Allow-Origin *;&#125;</code></pre><h4 id="åå‘ä»£ç†æ¥å£è·¨åŸŸ"><a href="#åå‘ä»£ç†æ¥å£è·¨åŸŸ" class="headerlink" title="åå‘ä»£ç†æ¥å£è·¨åŸŸ"></a>åå‘ä»£ç†æ¥å£è·¨åŸŸ</h4><p>æˆ‘ä»¬çŸ¥é“åŒæºç­–ç•¥åªæ˜¯ <strong>æµè§ˆå™¨</strong> çš„å®‰å…¨ç­–ç•¥ï¼Œä¸æ˜¯ <code>HTTP</code> åè®®çš„ä¸€éƒ¨åˆ†ï¼Œ æœåŠ¡å™¨ç«¯è°ƒç”¨ <code>HTTP</code> æ¥å£åªæ˜¯ä½¿ç”¨ <code>HTTP</code> åè®®ï¼Œä¸ä¼šæ‰§è¡Œ JS è„šæœ¬ï¼Œä¸éœ€è¦åŒæºç­–ç•¥ï¼Œä¹Ÿå°±ä¸å­˜åœ¨è·¨è¶Šé—®é¢˜</p><p>é€šä¿—ç‚¹è¯´å°±æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚ä¼šå­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œä½†æ˜¯æœåŠ¡ç«¯å‘å¦ä¸€ä¸ªæœåŠ¡ç«¯å‘èµ·è¯·æ±‚å¹¶æ— è·¨åŸŸï¼Œå› ä¸ºè·¨åŸŸé—®é¢˜å½’æ ¹ç»“åº•æºäºåŒæºç­–ç•¥ï¼Œè€ŒåŒæºç­–ç•¥åªå­˜åœ¨äºæµè§ˆå™¨</p><p>é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ <code>Nginx</code> é…ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œåå‘ä»£ç†è®¿é—®è·¨åŸŸçš„æ¥å£ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥ä¿®æ”¹ <code>Cookie</code> ä¸­ <code>domain</code> ä¿¡æ¯ï¼Œæ–¹ä¾¿å½“å‰åŸŸ <code>Cookie</code> å†™å…¥</p><p><code>Nginx</code> å…¶å®å°±æ˜¯å„ç§é…ç½®ï¼Œç®€å•æ˜“å­¦ï¼Œå°±ç®—æ²¡æ¥è§¦è¿‡ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ç¤ºä¾‹</p><p>é¦–å…ˆå‡å¦‚æˆ‘ä»¬çš„é¡µé¢ a åœ¨ <code>http://www.hahaha.com</code> åŸŸä¸‹ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ¥å£å´åœ¨ <code>http://www.hahaha1.com:9999</code> åŸŸä¸‹</p><p>æ¥ç€æˆ‘ä»¬åœ¨é¡µé¢ a å‘èµ·ä¸€ä¸ª <code>AJAX</code> è¯·æ±‚æ—¶ï¼Œå°±ä¼šè·¨åŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>Nginx</code> é…ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ŒåŸŸåå’Œé¡µé¢ a ç›¸åŒï¼Œéƒ½æ˜¯ <code>http://www.hahaha.com</code> ï¼Œç”¨å®ƒæ¥å……å½“ä¸€ä¸ªè·³æ¿çš„è§’è‰²ï¼Œåå‘ä»£ç†è®¿é—®  <code>http://www.hahaha1.com</code>  æ¥å£</p><pre><code class="hljs bash"><span class="hljs-comment"># Nginxä»£ç†æœåŠ¡å™¨</span>server &#123;  listen       80;  server_name  www.hahaha.com;  location / &#123;    <span class="hljs-comment"># åå‘ä»£ç†åœ°å€</span>    proxy_pass   http://www.hahaha1.com:9999;      <span class="hljs-comment"># ä¿®æ”¹Cookieä¸­åŸŸå</span>    proxy_cookie_domain www.hahaha1.com www.hahaha.com;     index  index.html index.htm;    <span class="hljs-comment"># å‰ç«¯è·¨åŸŸæºå¸¦äº†Cookieï¼Œæ‰€ä»¥Allow-Originé…ç½®ä¸å¯ä¸º*</span>    add_header Access-Control-Allow-Origin http://www.hahaha.com;      add_header Access-Control-Allow-Credentials <span class="hljs-literal">true</span>;  &#125;&#125;</code></pre><p>æ²¡é”™ï¼Œè¿™ä¸ªä»£ç†é…ç½®ç›¸ä¿¡æ²¡æ¥è§¦è¿‡ <code>Nginx</code> ä¹Ÿèƒ½çœ‹æ˜ç™½ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æˆ‘ä»¬ä¸Šæ–‡æåˆ°è¿‡çš„ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢</p><h3 id="No-8-Nodeä»£ç†è·¨åŸŸ"><a href="#No-8-Nodeä»£ç†è·¨åŸŸ" class="headerlink" title="No.8 Nodeä»£ç†è·¨åŸŸ"></a>No.8 Nodeä»£ç†è·¨åŸŸ</h3><p><code>Node</code> å®ç°è·¨åŸŸä»£ç†ï¼Œä¸ <code>Nginx</code> é“ç†ç›¸åŒï¼Œéƒ½æ˜¯å¯ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå°±åƒæˆ‘ä»¬å¸¸ç”¨çš„ <code>Vue-CLI</code> é…ç½®è·¨åŸŸï¼Œå…¶å®ä¹Ÿæ˜¯ <code>Node</code> å¯äº†ä¸€ä¸ªä»£ç†æœåŠ¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•åšçš„</p><h4 id="Vue-CLIä¸­ä»£ç†çš„å¤šç§é…ç½®"><a href="#Vue-CLIä¸­ä»£ç†çš„å¤šç§é…ç½®" class="headerlink" title="Vue-CLIä¸­ä»£ç†çš„å¤šç§é…ç½®"></a>Vue-CLIä¸­ä»£ç†çš„å¤šç§é…ç½®</h4><p>Vue-CLI æ˜¯åŸºäº <code>webpack</code> çš„ï¼Œé€šè¿‡ <code>webpack-dev-server</code> åœ¨æœ¬åœ°å¯åŠ¨è„šæ‰‹æ¶ï¼Œä¹Ÿå°±æ˜¯åœ¨æœ¬åœ°å¯åŠ¨äº†ä¸€ä¸ª <code>Node</code> æœåŠ¡ï¼Œæ¥å®æ—¶ç›‘å¬å’Œæ‰“åŒ…ç¼–è¯‘é™æ€èµ„æºï¼Œç”±äºéƒ½æ˜¯å°è£…å¥½çš„ï¼Œåªéœ€è¦é…ç½®å³å¯ï¼Œæˆ‘ä»¬åœ¨ <code>vue.config.js</code> ä¸­é…ç½®ä»£ç†å¦‚ä¸‹ï¼Œå†™æ³•å¾ˆå¤šï¼Œåˆ—å‡ ä¸ªå¸¸è§çš„è‡ªè¡Œé€‰æ‹©</p><p><strong>ä½¿ç”¨ä¸€</strong></p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;  <span class="hljs-comment">//...</span>  devServer: &#123;    proxy: &#123;      <span class="hljs-string">'/api'</span>: <span class="hljs-string">'http://www.hahaha.com'</span>    &#125;  &#125;&#125;</code></pre><p>å¦‚ä¸Šæ‰€ç¤ºæ—¶ï¼Œå½“ä½ è¯·æ±‚ <code>/api/abc</code> æ¥å£æ—¶å°±ä¼šè¢«ä»£ç†åˆ° <code>http://www.hahaha.com/api/abc</code></p><p><strong>ä½¿ç”¨äºŒ</strong></p><p>å½“ç„¶ï¼Œä½ å¯èƒ½æƒ³å°†å¤šä¸ªè·¯å¾„ä»£ç†åˆ°åŒä¸€ä¸ª <code>target</code> ä¸‹ï¼Œé‚£ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;  <span class="hljs-comment">//...</span>  devServer: &#123;    proxy: [&#123;      context: [<span class="hljs-string">'/api1'</span>, <span class="hljs-string">'/api2'</span>, <span class="hljs-string">'/api3'</span>],      target: <span class="hljs-string">'http://www.hahaha.com'</span>,    &#125;]  &#125;&#125;</code></pre><p><strong>ä½¿ç”¨ä¸‰</strong></p><p>æ­£å¦‚æˆ‘ä»¬ç¬¬ä¸€ç§ä½¿ç”¨æ–¹å¼ä»£ç†æ—¶ï¼Œä»£ç†äº† <code>/api</code> ï¼Œæœ€ç»ˆçš„ä»£ç†ç»“æœæ˜¯ <code>http://www.hahaha.com/api/abc</code> ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬å¹¶ä¸æƒ³ä»£ç†æ—¶ä¼ é€’ <code>/api</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼Œé€šè¿‡ <code>pathRewrite</code> å±æ€§æ¥è¿›è¡Œè·¯å¾„é‡å†™</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;  <span class="hljs-comment">//...</span>  devServer: &#123;    proxy: &#123;      <span class="hljs-string">'/api'</span>: &#123;        target: <span class="hljs-string">'http://www.hahaha.com'</span>,        pathRewrite: &#123;<span class="hljs-string">'^/api'</span> : <span class="hljs-string">''</span>&#125;      &#125;    &#125;  &#125;&#125;</code></pre><p>è¿™ä¸ªæ—¶å€™ï¼Œ<code>/api/abc</code> æ¥å£å°±ä¼šè¢«ä»£ç†åˆ° <code>http://www.hahaha.com/abc</code></p><p><strong>ä½¿ç”¨å››</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»£ç†æ˜¯ä¸æ¥å—è¿è¡Œåœ¨ <code>HTTPS</code> ä¸Šï¼Œä¸”ä½¿ç”¨äº†æ— æ•ˆè¯ä¹¦çš„åç«¯æœåŠ¡å™¨çš„</p><p>å¦‚æœä½ æƒ³è¦æ¥å—ï¼Œéœ€è¦è®¾ç½® <code>secure: false</code> ï¼Œå¦‚ä¸‹</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;  <span class="hljs-comment">//...</span>  devServer: &#123;    proxy: &#123;      <span class="hljs-string">'/api'</span>: &#123;        target: <span class="hljs-string">'https://www.hahaha.com'</span>,        secure: <span class="hljs-literal">false</span>      &#125;    &#125;  &#125;&#125;</code></pre><p><strong>ä½¿ç”¨äº”</strong></p><p>é…ç½®ä¸€ä¸ªå­—æ®µ <code>changeOrigin</code> ï¼Œå½“å®ƒä¸º <code>true</code> æ—¶ï¼Œæœ¬åœ°å°±ä¼šè™šæ‹Ÿä¸€ä¸ªæœåŠ¡å™¨æ¥æ”¶ä½ çš„è¯·æ±‚å¹¶ä¸”ä»£ä½ å‘é€è¯¥è¯·æ±‚ï¼Œæ‰€ä»¥å¦‚æœä½ è¦ä»£ç†è·¨åŸŸï¼Œè¿™ä¸ªå­—æ®µæ˜¯å¿…é€‰é¡¹</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;  <span class="hljs-comment">// ...</span>  devServer: &#123;    proxy: &#123;      <span class="hljs-string">"/api"</span>: &#123;        target: <span class="hljs-string">'http://www.hahaha.com'</span>,        changeOrigin: <span class="hljs-literal">true</span>,      &#125;    &#125;  &#125;&#125;</code></pre><p><strong>ä½¿ç”¨å…­</strong></p><p>å¦‚æœä½ æƒ³é…ç½®å¤šä¸ªä¸åŒçš„ä»£ç†ï¼Œä¹Ÿç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥åœ¨ä»»æ„ä»£ç†ä¸­è®¾ç½®å¯¹åº”çš„ä»£ç†è§„åˆ™</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;  <span class="hljs-comment">// ...</span>  devServer: &#123;    proxy: &#123;      <span class="hljs-string">"/api1"</span>: &#123;        target: <span class="hljs-string">'http://www.hahaha1.com'</span>,        changeOrigin: <span class="hljs-literal">true</span>      &#125;,      <span class="hljs-string">"/api2"</span>: &#123;        target: <span class="hljs-string">'http://www.hahaha2.com'</span>,        pathRewrite: &#123;<span class="hljs-string">'^/api2'</span> : <span class="hljs-string">''</span>&#125;      &#125;,      <span class="hljs-string">"/api3"</span>: &#123;        target: <span class="hljs-string">'http://www.hahaha3.com'</span>,        changeOrigin: <span class="hljs-literal">true</span>,        pathRewrite: &#123;<span class="hljs-string">'^/api3'</span> : <span class="hljs-string">''</span>&#125;      &#125;      <span class="hljs-comment">// ...</span>    &#125;  &#125;&#125;</code></pre><p>æ³¨æ„ï¼Œåœ¨æœ¬åœ°é…ç½®ä»£ç†è·¨åŸŸï¼Œåªæ˜¯è§£å†³å¼€å‘æ—¶çš„è·¨åŸŸé—®é¢˜ï¼Œå½“ä½ çš„é¡¹ç›®ä¸Šçº¿æ—¶ï¼Œå‰ç«¯é™æ€æ–‡ä»¶å’Œåç«¯åœ¨ä¸€ä¸ªåŸŸä¸‹æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœå¹¶ä¸åœ¨ä¸€ä¸ªåŸŸä¸‹ï¼Œä¾ç„¶ä¼šæŠ¥è·¨åŸŸé”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™è¿˜å¾—éœ€è¦åç«¯é…ç½®è·¨åŸŸ</p><h4 id="Nodeå®ç°ä»£ç†æœåŠ¡å™¨"><a href="#Nodeå®ç°ä»£ç†æœåŠ¡å™¨" class="headerlink" title="Nodeå®ç°ä»£ç†æœåŠ¡å™¨"></a>Nodeå®ç°ä»£ç†æœåŠ¡å™¨</h4><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>express + http-proxy-middleware</code> æ¥æ­å»ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œä½¿ç”¨ <code>http-proxy-middleware</code> è¿™ä¸ªä¸­é—´ä»¶æ²¡æœ‰åˆ«çš„æ„æ€ï¼Œåªæ˜¯å› ä¸º <code>webpack-dev-server</code> é‡Œå°±æ˜¯ä½¿ç”¨çš„å®ƒ</p><pre><code class="hljs js"><span class="hljs-keyword">let</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)<span class="hljs-keyword">let</span> proxy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http-proxy-middleware'</span>)<span class="hljs-keyword">let</span> app = express()app.use(<span class="hljs-string">'/'</span>, proxy(&#123;    <span class="hljs-comment">// ä»£ç†è·¨åŸŸç›®æ ‡æ¥å£</span>    target: <span class="hljs-string">'http://www.hahaha1.com:9999'</span>,    changeOrigin: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// ä¿®æ”¹å“åº”å¤´ä¿¡æ¯ï¼Œå®ç°è·¨åŸŸå¹¶å…è®¸å¸¦cookie</span>    onProxyRes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">proxyRes, req, res</span>) </span>&#123;        res.header(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'http://www.hahaha.com'</span>)        res.header(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>)    &#125;,    <span class="hljs-comment">// ä¿®æ”¹å“åº”ä¿¡æ¯ä¸­çš„cookieåŸŸåï¼Œä¸ºfalseæ—¶ï¼Œè¡¨ç¤ºä¸ä¿®æ”¹</span>    cookieDomainRewrite: <span class="hljs-string">'www.hahaha.com'</span>&#125;))app.listen(<span class="hljs-number">3000</span>)</code></pre><h3 id="No-9-WebSocketè·¨åŸŸ"><a href="#No-9-WebSocketè·¨åŸŸ" class="headerlink" title="No.9 WebSocketè·¨åŸŸ"></a>No.9 WebSocketè·¨åŸŸ</h3><h4 id="WebSocketç®€ä»‹"><a href="#WebSocketç®€ä»‹" class="headerlink" title="WebSocketç®€ä»‹"></a>WebSocketç®€ä»‹</h4><p><code>WebSocket</code> æ˜¯ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ï¼Œ2008å¹´è¯ç”Ÿï¼Œ2011å¹´è¢« IETF å®šä¸ºæ ‡å‡† <code>RFC 6455</code>ï¼Œå¹¶ç”± <code>RFC7936</code> è¡¥å……è§„èŒƒï¼Œ<code>WebSocket API</code> ä¹Ÿè¢« W3C å®šä¸ºæ ‡å‡†</p><p><code>WebSocket</code> ä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•ï¼Œå…è®¸æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œ åœ¨ <code>WebSocket API</code> ä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ï¼ŒåŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯è·¨åŸŸçš„ä¸€ç§è§£å†³æ–¹æ¡ˆ</p><h4 id="WebSocketç‰¹ç‚¹"><a href="#WebSocketç‰¹ç‚¹" class="headerlink" title="WebSocketç‰¹ç‚¹"></a>WebSocketç‰¹ç‚¹</h4><ul><li>å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼ŒæœåŠ¡å™¨ç«¯çš„å®ç°æ¯”è¾ƒå®¹æ˜“</li><li>ä¸ HTTP åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ï¼Œé»˜è®¤ç«¯å£ä¹Ÿæ˜¯ 80 å’Œ 443ï¼Œå¹¶ä¸”æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œå› æ­¤æ¡æ‰‹æ—¶ä¸å®¹æ˜“å±è”½ï¼Œèƒ½é€šè¿‡å„ç§ HTTP ä»£ç†æœåŠ¡å™¨</li><li>æ•°æ®æ ¼å¼æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡é«˜æ•ˆ</li><li>å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®</li><li>æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡</li><li>åè®®æ ‡è¯†ç¬¦æ˜¯ <code>ws</code>ï¼ˆå¦‚æœåŠ å¯†ï¼Œåˆ™ä¸º <code>wss</code> ï¼‰ï¼ŒæœåŠ¡å™¨ç½‘å€å°±æ˜¯ URL</li></ul><p>å¦‚ä¸‹</p><pre><code class="hljs vim"><span class="hljs-keyword">w</span><span class="hljs-variable">s:</span>//www.hahaha.<span class="hljs-keyword">com</span>:<span class="hljs-number">80</span>/<span class="hljs-keyword">abc</span>/def</code></pre><h4 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>æ¯ä¸ªæœåŠ¡ç«¯è¯­è¨€å¯¹ <code>websocket</code> æœ‰ç›¸åº”çš„æ”¯æŒï¼Œå†™æ³•ä¸åŒç½¢äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>Node</code> åšç¤ºä¾‹</p><p>åœ¨å®¢æˆ·ç«¯æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ HTML5 çš„ <code>websocket API</code> ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>nodejs-websocket</code> å®ç° <code>websocket server</code> ï¼Œä½†æ˜¯ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºåŸç”Ÿ <code>WebSocket API</code> ä½¿ç”¨èµ·æœ‰äº›å¤æ‚ï¼Œåœ¨æµè§ˆå™¨çš„å…¼å®¹æ€§ä¸Šè¿˜ä¸å¤Ÿç†æƒ³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>Socket.io</code>ï¼Œå®ƒå¾ˆå¥½åœ°å°è£…äº† <code>webSocket</code> æ¥å£ï¼Œæä¾›äº†æ›´ç®€å•ã€çµæ´»çš„æ¥å£ï¼Œä¹Ÿå¯¹ä¸æ”¯æŒ <code>webSocket</code> çš„æµè§ˆå™¨æä¾›äº†å‘ä¸‹å…¼å®¹ï¼Œä½¿ç”¨ <code>Socket.io</code> åº“å®ç° <code>websocket</code>ï¼Œåœ¨å‘é€æ•°æ®æ—¶å¯ä»¥ç›´æ¥å‘é€å¯åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ¶ˆæ¯ï¼Œåˆ©ç”¨äº‹ä»¶å­—ç¬¦ä¸²æ¥åŒºåˆ†ä¸åŒæ¶ˆæ¯ï¼Œæ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¼šèˆ’æœå¾ˆå¤š</p><p>æƒ³è¦äº†è§£æ›´å¤šçœ‹å®˜ç½‘å³å¯ <a href="https://socket.io/" target="_blank" rel="noopener">Socket.io - ä¼ é€é—¨</a> ï¼Œæˆ‘ä»¬æ¥çœ‹ç¤ºä¾‹</p><p>å®¢æˆ·ç«¯ï¼š<code>http://www.hahaha.com/a.html</code></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/socket.io/socket.io.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">let</span> socket = io.connect(<span class="hljs-string">'http://www.hahaha1.com:3000'</span>)</span>  <span class="actionscript">  socket.on(<span class="hljs-string">'my event'</span>, (data) =&gt; &#123;</span><span class="javascript">    <span class="hljs-built_in">console</span>.log(data) <span class="hljs-comment">// &#123; hello: 'world' &#125;</span></span>    <span class="actionscript">    socket.emit(<span class="hljs-string">'my other event'</span>, &#123; my: <span class="hljs-string">'data'</span> &#125;)</span>  &#125;)<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>æœåŠ¡ç«¯ï¼š<code>http://www.hahaha1.com:3000</code></p><pre><code class="hljs js"><span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>).createServer()<span class="hljs-keyword">const</span> io = <span class="hljs-built_in">require</span>(<span class="hljs-string">'socket.io'</span>)(app)app.listen(<span class="hljs-number">3000</span>)io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; &#123;  socket.emit(<span class="hljs-string">'my event'</span>, &#123; <span class="hljs-attr">hello</span>: <span class="hljs-string">'world'</span> &#125;)    socket.on(<span class="hljs-string">'my other event'</span>, (data) =&gt; &#123;    <span class="hljs-built_in">console</span>.log(data) <span class="hljs-comment">// &#123; my: 'data' &#125;</span>  &#125;)&#125;)</code></pre><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä½¿ç”¨äº† <code>Socket.io</code> ä¹‹åçš„ <code>websocket</code> è¿æ¥æ˜¯ä¸æ˜¯è¶…çº§ç®€å•å‘¢ï¼Œè·Ÿç€æ–‡æ¡£è‡ªå·±åŠ¨æ‰‹è¯•è¯•å§</p>]]></content>
    
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºjsä¸­æ”¹å˜thisæŒ‡å‘é—®é¢˜</title>
    <link href="/2019-1-29-%E5%85%B3%E4%BA%8Ejs%E4%B8%AD%E6%94%B9%E5%8F%98this%E6%8C%87%E5%90%91%E9%97%AE%E9%A2%98/"/>
    <url>/2019-1-29-%E5%85%B3%E4%BA%8Ejs%E4%B8%AD%E6%94%B9%E5%8F%98this%E6%8C%87%E5%90%91%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æ”¹å˜thisæŒ‡å‘ä¸‰ç§æ–¹æ³•"><a href="#1-æ”¹å˜thisæŒ‡å‘ä¸‰ç§æ–¹æ³•" class="headerlink" title="1.æ”¹å˜thisæŒ‡å‘ä¸‰ç§æ–¹æ³•"></a>1.æ”¹å˜thisæŒ‡å‘ä¸‰ç§æ–¹æ³•</h2><h5 id="1-call"><a href="#1-call" class="headerlink" title="1.call"></a>1.call</h5><pre><code class="hljs js"><span class="hljs-keyword">let</span> obj = &#123;  name: <span class="hljs-string">'evan'</span>,  age: <span class="hljs-number">18</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">a, b</span>) </span>&#123;  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name,<span class="hljs-keyword">this</span>.age, a, b);&#125;fn.call(obj, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</code></pre><p>è°ƒç”¨fnå¹¶ä½¿ç”¨objä¸­çš„this</p><h5 id="2-apply"><a href="#2-apply" class="headerlink" title="2.apply"></a>2.apply</h5><pre><code class="hljs js"><span class="hljs-keyword">let</span> obj = &#123;  name: <span class="hljs-string">'evan'</span>,  age: <span class="hljs-number">18</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">a, b</span>) </span>&#123;  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name,<span class="hljs-keyword">this</span>.age, a, b);&#125;fn.apply(obj, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>])</code></pre><p>è°ƒç”¨fnå¹¶ä½¿ç”¨objä¸­çš„this</p><h6 id="ä¸¤è€…çš„ä¸åŒåœ¨äºå‚æ•°æ•°ç»„çš„åŒºåˆ«-å¦‚æœå‚æ•°å¤æ‚å°±ç”¨call-å¦‚ä½•ä¸å¤æ‚å°±ç”¨apply-è§†æƒ…å†µè€Œå®š"><a href="#ä¸¤è€…çš„ä¸åŒåœ¨äºå‚æ•°æ•°ç»„çš„åŒºåˆ«-å¦‚æœå‚æ•°å¤æ‚å°±ç”¨call-å¦‚ä½•ä¸å¤æ‚å°±ç”¨apply-è§†æƒ…å†µè€Œå®š" class="headerlink" title="ä¸¤è€…çš„ä¸åŒåœ¨äºå‚æ•°æ•°ç»„çš„åŒºåˆ«,å¦‚æœå‚æ•°å¤æ‚å°±ç”¨call,å¦‚ä½•ä¸å¤æ‚å°±ç”¨apply,è§†æƒ…å†µè€Œå®š"></a>ä¸¤è€…çš„ä¸åŒåœ¨äºå‚æ•°æ•°ç»„çš„åŒºåˆ«,å¦‚æœå‚æ•°å¤æ‚å°±ç”¨call,å¦‚ä½•ä¸å¤æ‚å°±ç”¨apply,è§†æƒ…å†µè€Œå®š</h6><h5 id="3-bind"><a href="#3-bind" class="headerlink" title="3.bind"></a>3.bind</h5><p>bindå’Œå…¶ä»–ä¸¤è€…çš„åŒºåˆ«æ˜¯è¿”å›çš„æ˜¯ä¸€ä¸ªæ”¹å˜thisæŒ‡å‘çš„å‡½æ•°,è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨(callå’Œapplyè¿”å›çš„æ˜¯undefined)</p><pre><code class="hljs js"><span class="hljs-keyword">let</span> obj = &#123;  name: <span class="hljs-string">'evan'</span>,  age: <span class="hljs-number">18</span>&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">a, b</span>) </span>&#123;  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.name,<span class="hljs-keyword">this</span>.age, a, b);&#125;<span class="hljs-keyword">const</span> a = fn.bind(obj, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)a()</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonJSã€AMDã€CMDã€ES6 æ¨¡å—è§„èŒƒè®²è§£</title>
    <link href="/2019-1-24-CommonJS%E3%80%81AMD%E3%80%81CMD%E3%80%81ES6-%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E8%AE%B2%E8%A7%A3/"/>
    <url>/2019-1-24-CommonJS%E3%80%81AMD%E3%80%81CMD%E3%80%81ES6-%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E8%AE%B2%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¨¡å—åŒ–åŸå§‹å†™æ³•"><a href="#æ¨¡å—åŒ–åŸå§‹å†™æ³•" class="headerlink" title="æ¨¡å—åŒ–åŸå§‹å†™æ³•"></a>æ¨¡å—åŒ–åŸå§‹å†™æ³•</h1><p>åœ¨æ²¡æœ‰<code>CommonJS</code>å’Œ<code>ES6</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦è¾¾åˆ°æ¨¡å—åŒ–çš„æ•ˆæœå¯èƒ½æœ‰è¿™ä¹ˆä¸‰ç§ï¼š</p><h2 id="1-ä¸€ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªæ¨¡å—"><a href="#1-ä¸€ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªæ¨¡å—" class="headerlink" title="1. ä¸€ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªæ¨¡å—"></a>1. ä¸€ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªæ¨¡å—</h2><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>  <span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">m1</span> <span class="hljs-params">()</span> </span>&#123;  </span><span class="actionscript">    <span class="hljs-comment">// ...  </span></span>  &#125;  <span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">m2</span> <span class="hljs-params">()</span> </span>&#123;  </span><span class="actionscript">    <span class="hljs-comment">// ...  </span></span>  &#125;  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><blockquote><p>ç¼ºç‚¹ï¼šæ±¡æŸ“äº†å…¨å±€å˜é‡ï¼Œæ— æ³•ä¿è¯ä¸ä¼šä¸å…¶å®ƒæ¨¡å—å‘ç”Ÿå†²çªï¼Œè€Œä¸”æ¨¡å—æˆå‘˜ä¹‹é—´çœ‹ä¸å‡ºç›´æ¥å…³ç³»ã€‚</p></blockquote><h2 id="2-ä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ¨¡å—"><a href="#2-ä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ¨¡å—" class="headerlink" title="2. ä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ¨¡å—"></a>2. ä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ¨¡å—</h2><p>å¯¹è±¡å†™æ³• ä¸ºäº†è§£å†³ä¸Šé¢çš„ç¼ºç‚¹ï¼Œå¯ä»¥æŠŠæ¨¡å—å†™æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰çš„æ¨¡å—æˆå‘˜éƒ½æ”¾åˆ°è¿™ä¸ªå¯¹è±¡é‡Œé¢ã€‚</p><p><strong>index.html</strong></p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>  <span class="javascript">  <span class="hljs-keyword">var</span> module1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>(&#123;  </span>    _sum: 0,  <span class="actionscript">    foo1: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;&#125;,  </span><span class="actionscript">    foo2: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;&#125;  </span>  &#125;)  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><blockquote><p>ç¼ºç‚¹ï¼šä¼šæš´éœ²æ‰€æœ‰æ¨¡å—æˆå‘˜ï¼Œå†…éƒ¨çš„çŠ¶æ€å¯èƒ½è¢«æ”¹å†™ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦‚æœåªæ˜¯æƒ³æš´éœ²å‡ºä¸¤ä¸ªæ–¹æ³•è€Œä¸æš´éœ²å‡º <code>_sum</code>ï¼Œå°±åšä¸åˆ°ã€‚</p><p>è€Œæ­¤æ—¶ï¼Œ<code>_sum</code> å¯èƒ½è¢«å¤–éƒ¨æ”¹å†™ï¼š</p><pre><code class="hljs js">module1._sum = <span class="hljs-number">2</span>;</code></pre><h2 id="3-ç«‹å³æ‰§è¡Œå‡½æ•°ä¸ºä¸€ä¸ªæ¨¡å—"><a href="#3-ç«‹å³æ‰§è¡Œå‡½æ•°ä¸ºä¸€ä¸ªæ¨¡å—" class="headerlink" title="3. ç«‹å³æ‰§è¡Œå‡½æ•°ä¸ºä¸€ä¸ªæ¨¡å—"></a>3. ç«‹å³æ‰§è¡Œå‡½æ•°ä¸ºä¸€ä¸ªæ¨¡å—</h2><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>  <span class="actionscript">  <span class="hljs-keyword">var</span> module1 = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>&#123;  </span><span class="actionscript">    <span class="hljs-keyword">var</span> _sum = <span class="hljs-number">0</span>;  </span><span class="actionscript">    <span class="hljs-keyword">var</span> foo1 = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;&#125;;  </span><span class="actionscript">    <span class="hljs-keyword">var</span> foo2 = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>&#123;&#125;;  </span><span class="actionscript">    <span class="hljs-keyword">return</span> &#123;  </span>      foo1: foo1,        foo2: foo2      &#125;    &#125;)();  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>åˆ©ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°å†…çš„ä½œç”¨åŸŸå·²ç»é—­åŒ…æ¥å®ç°æ¨¡å—åŠŸèƒ½ï¼Œå¯¼å‡ºæˆ‘ä»¬æƒ³è¦å¯¼å‡ºçš„æˆå‘˜ã€‚</p><p>æ­¤æ—¶å¤–éƒ¨ä»£ç å°±ä¸èƒ½è¯»å–åˆ° <code>_sum</code> äº†ï¼š</p><pre><code class="hljs js"><span class="hljs-built_in">console</span>.log(module1._sum) <span class="hljs-comment">// undefined</span></code></pre><h1 id="CommonJSè§„èŒƒ"><a href="#CommonJSè§„èŒƒ" class="headerlink" title="CommonJSè§„èŒƒ"></a>CommonJSè§„èŒƒ</h1><p>è¿™é‡Œä¸åšå…·ä½“çš„ä»‹ç»äº†ï¼Œæˆ‘åªæŠŠä¸€äº›é‡è¦çš„çŸ¥è¯†ç‚¹ä»¥åŠæ··æ·†ç‚¹ä¾‹ä¸¾å‡ºæ¥ã€‚</p><p>ä¸»è¦æ˜¯ä»è¿™å››ä¸ªæ–¹é¢è¯´ï¼š</p><ul><li>æš´éœ²æ¨¡å—</li><li>å¼•ç”¨æ¨¡å—</li><li>æ¨¡å—æ ‡è¯†ç¬¦</li><li>CommonJSè§„èŒƒçš„ç‰¹ç‚¹</li></ul><h2 id="1-æš´éœ²-å®šä¹‰-æ¨¡å—"><a href="#1-æš´éœ²-å®šä¹‰-æ¨¡å—" class="headerlink" title="1. æš´éœ²(å®šä¹‰)æ¨¡å—"></a>1. æš´éœ²(å®šä¹‰)æ¨¡å—</h2><p><strong>æ­£ç¡®çš„æš´éœ²æ–¹å¼ï¼š</strong></p><p>æš´éœ²æ¨¡å—æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><code>module.exports = {}</code></li><li><code>exports.xxx = &#39;xxx&#39;</code></li></ul><p>ä¾‹å¦‚æœ‰ä¸€ä¸ª <code>m1.js</code> æ–‡ä»¶ï¼š</p><p>ç¬¬ä¸€ç§æš´éœ²æ–¹å¼ï¼š</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;      name: <span class="hljs-string">'evanchen'</span>,      sex: <span class="hljs-string">'boy'</span>  &#125;</code></pre><p>ç¬¬äºŒç§æš´éœ²æ–¹å¼ï¼š</p><pre><code class="hljs js">exports.name = <span class="hljs-string">'evanchen'</span>;  exports.sex = <span class="hljs-string">'boy'</span></code></pre><p>ä¸ºä»€ä¹ˆå¯ä»¥æœ‰è¿™ä¸¤ç§å†™æ³•å‘¢ï¼Ÿ</p><p>æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼š<code>module</code>è¿™ä¸ªå˜é‡å®ƒä»£è¡¨çš„å°±æ˜¯æ•´ä¸ªæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯<code>m1.js</code>ã€‚è€Œå…¶å®è¿™ä¸ª<code>module</code>å˜é‡æ˜¯æœ‰ä¸€ä¸ªå±æ€§<code>exports</code>çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«åš<code>exports</code>å˜é‡çš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸‹ä¼ªä»£ç ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> exports = &#123;&#125;;  <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = &#123;      exports: exports  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports</code></pre><p>(å½“ç„¶è¿™åªæ˜¯ä¼ªä»£ç å•Šï¼Œå®é™…ä½ è¿™ä¹ˆå»ç”¨ä¼šå‘ç°æ²¡æœ‰æ•ˆæœ)</p><p>æœ€åå¯¼å‡ºçš„æ˜¯<code>module.exports</code>ï¼Œè€Œä¸æ˜¯<code>exports</code>ã€‚</p><p><strong>å®¹æ˜“æ··æ·†çš„æš´éœ²æ–¹å¼ï¼š</strong></p><p>å¦‚æœä½ åœ¨ä»£ç ä¸­è¯•å›¾ <code>exports = { name: &#39;evanchen&#39; }</code>ï¼Œä½ ä¼šå‘ç°åœ¨å¼•å…¥çš„åœ°æ–¹æ ¹æœ¬è·å–ä¸åˆ°<code>name</code>å±æ€§ã€‚</p><pre><code class="hljs js"><span class="hljs-comment">// m1.js  </span>exports = &#123;      name: <span class="hljs-string">'evanchen'</span>  &#125;<span class="hljs-comment">// test.js</span><span class="hljs-keyword">const</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1.js'</span>)    <span class="hljs-built_in">console</span>.log(m1); <span class="hljs-comment">// &#123;&#125;</span></code></pre><p>åœ¨æ§åˆ¶å°æ‰§è¡Œ <code>node test.js</code>ï¼Œå‘ç°æ‰“å°å‡ºæ¥çš„ <code>m1</code> æ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡ã€‚</p><p>æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼šæ•´ä¸ªæ¨¡å—çš„å¯¼å‡ºæ˜¯é  <code>module.exports</code>çš„ï¼Œå¦‚æœä½ é‡æ–°å¯¹æ•´ä¸ª <code>exports</code> å¯¹è±¡èµ‹å€¼çš„è¯ï¼Œå®ƒå’Œ <code>module.exports</code> å°±ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†ï¼Œå› ä¸ºå®ƒä»¬æŒ‡å‘çš„å¼•ç”¨åœ°å€éƒ½ä¸åŒï¼š</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports -&gt; &#123;&#125; <span class="hljs-comment">// æŒ‡å‘ä¸€ä¸ªç©ºçš„å¯¹è±¡  </span>exports -&gt; &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">'evanchen'</span> &#125; <span class="hljs-comment">// æŒ‡å‘çš„æ˜¯å¦ä¸€ä¸ªå¯¹è±¡</span></code></pre><p>æ‰€ä»¥ä½ å¯¹ <code>exports = {}</code> åšä»»ä½•æ“ä½œéƒ½å½±å“ä¸åˆ° <code>module.exports</code>ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªæ­£ç¡®å’Œé”™è¯¯çš„ç¤ºä¾‹å§ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// m1.js</span><span class="hljs-comment">// 1. æ­£ç¡®  </span><span class="hljs-built_in">module</span>.exports = &#123;      name: <span class="hljs-string">'evanchen'</span>,      sex: <span class="hljs-string">'boy'</span>  &#125;    <span class="hljs-comment">// 2. æ­£ç¡®  </span>exports.name = <span class="hljs-string">'evanchen'</span>;  exports.sex = <span class="hljs-string">'boy'</span>    <span class="hljs-comment">// 3. æ­£ç¡®  </span><span class="hljs-built_in">module</span>.exports.name = <span class="hljs-string">'evanchen'</span>;  <span class="hljs-built_in">module</span>.exports.sex = <span class="hljs-string">'boy'</span>    <span class="hljs-comment">// 4. æ— æ•ˆ  </span>exports = &#123;      name: <span class="hljs-string">'evanchen'</span>,      sex: <span class="hljs-string">'boy'</span>  &#125;</code></pre><p>å¯ä»¥çœ‹åˆ°</p><ul><li><code>exports.name = xxx</code> æ˜¯ <code>module.exports.name = xxx</code> çš„ç¼©å†™ã€‚</li><li><code>exports = {}</code> å´ä¸æ˜¯ <code>module.exports = {}</code> çš„ç¼©å†™ã€‚</li></ul><h2 id="2-å¼•ç”¨-å¼•å…¥-æ¨¡å—"><a href="#2-å¼•ç”¨-å¼•å…¥-æ¨¡å—" class="headerlink" title="2. å¼•ç”¨(å¼•å…¥)æ¨¡å—"></a>2. å¼•ç”¨(å¼•å…¥)æ¨¡å—</h2><p>å¯¹äºæ¨¡å—çš„å¼•ç”¨ä½¿ç”¨å…¨å±€æ–¹æ³• <code>require()</code> å°±å¯ä»¥äº†ã€‚</p><p>æ³¨æ„âš ï¸è¿™ä¸ªå…¨å±€æ–¹æ³•æ˜¯ <code>node</code> ä¸­çš„æ–¹æ³•å“ˆï¼Œå®ƒä¸æ˜¯ <code>window</code> ä¸‹é¢çš„ï¼Œæ‰€ä»¥å¦‚æœä½ æ²¡åšä»»ä½•å¤„ç†æƒ³ç›´æ¥åœ¨ <code>html</code> é‡Œç”¨è‚¯å®šå°±æ˜¯ä¸è¡Œçš„äº†ï¼š</p><p><strong>index.html</strong>:</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>  <span class="javascript">        <span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1.js'</span>)  </span><span class="javascript">        <span class="hljs-built_in">console</span>.log(m1);  </span>    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>ä¾‹å¦‚ä¸Šé¢ğŸ‘†è¿™æ ·ä½ æ‰“å¼€é¡µé¢æ§åˆ¶å°è‚¯å®šå°±æŠ¥é”™äº†ï¼š</p><pre><code class="hljs js">Uncaught <span class="hljs-built_in">ReferenceError</span>: <span class="hljs-built_in">require</span> is not defined      at index.html:<span class="hljs-number">11</span></code></pre><p>è€Œå¦‚æœä½ æ˜¯åœ¨å¦ä¸€ä¸ª <code>js</code> æ–‡ä»¶ä¸­å¼•ç”¨(ä¾‹å¦‚ <code>test.js</code> )ï¼Œå¹¶åœ¨ç»ˆç«¯æ‰§è¡Œ <code>node test.js</code> æ˜¯å¯ä»¥ç”¨çš„ï¼š</p><p><strong>test.js</strong>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1.js'</span>)    <span class="hljs-built_in">console</span>.log(m1);</code></pre><p>é‚£æ˜¯å› ä¸ºä½ çš„ç”µè„‘ä¸Šå…¨å±€å®‰è£…äº† <code>Node.js</code>ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·ç©ã€‚</p><p><strong>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘ç° <code>require()</code> å®ƒæ˜¯ <code>Node.js</code> ä¸­çš„ä¸€ä¸ªå…¨å±€æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯CommonJSç‹¬æœ‰çš„ï¼ŒCommonJSåªæ˜¯ä¼—å¤šè§„èŒƒä¸­çš„å…¶ä¸­ä¸€ç§ã€‚</strong></p><p>è¿™ç§è§„èŒƒå…è®¸æˆ‘ä»¬ï¼š</p><ul><li>ä½¿ç”¨ <code>module.exports = {}</code> æˆ–è€… <code>exports.name = xxx</code> å¯¼å‡ºæ¨¡å—</li><li>ä½¿ç”¨ <code>const m1 = require(&#39;./m1&#39;)</code> å¼•å…¥æ¨¡å—</li></ul><p>æ³¨æ„âš ï¸ï¼š</p><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹æ¯”è¾ƒé‡è¦ï¼Œé‚£å°±æ˜¯ <code>require()</code> çš„å‚æ•°ç”šè‡³èƒ½å…è®¸ä½ æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºä¸€ä¸ªå˜é‡ï¼š</p><p><strong>test.js</strong>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> m1Url = <span class="hljs-string">'./m1.js'</span>;  <span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(m1Url);    <span class="hljs-comment">// ç”šè‡³åšä¸€äº›å­—ç¬¦ä¸²æ‹¼æ¥ï¼š  </span><span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m'</span> + <span class="hljs-string">'1.js'</span>);</code></pre><h2 id="3-æ¨¡å—æ ‡è¯†ç¬¦-æ ‡è¯†"><a href="#3-æ¨¡å—æ ‡è¯†ç¬¦-æ ‡è¯†" class="headerlink" title="3. æ¨¡å—æ ‡è¯†ç¬¦(æ ‡è¯†)"></a>3. æ¨¡å—æ ‡è¯†ç¬¦(æ ‡è¯†)</h2><p>æ¨¡å—æ ‡è¯†ç¬¦å…¶å®å°±æ˜¯ä½ åœ¨å¼•å…¥æ¨¡å—æ—¶è°ƒç”¨ <code>require()</code> å‡½æ•°çš„å‚æ•°ã€‚</p><p>ä½ ä¼šçœ‹åˆ°æˆ‘ä»¬ç»å¸¸ä¼šæœ‰è¿™æ ·çš„ç”¨æ³•ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// ç›´æ¥å¯¼å…¥  </span><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);  <span class="hljs-comment">// ç›¸å¯¹è·¯å¾„  </span><span class="hljs-keyword">const</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1.js'</span>);  <span class="hljs-comment">// ç›´æ¥å¯¼å…¥  </span><span class="hljs-keyword">const</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);</code></pre><p>è¿™å…¶å®æ˜¯å› ä¸ºæˆ‘ä»¬å¼•å…¥çš„æ¨¡å—ä¼šæœ‰ä¸åŒçš„åˆ†ç±»ï¼Œåƒ<code>path</code>è¿™ç§å®ƒæ˜¯<code>Node.js</code>å°±è‡ªå¸¦çš„æ¨¡å—ï¼Œ<code>m1</code>æ˜¯è·¯å¾„æ¨¡å—ï¼Œ<code>lodash</code>æ˜¯æˆ‘ä»¬ä½¿ç”¨<code>npm i lodash</code>ä¸‹è½½åˆ°<code>node_modules</code>é‡Œçš„æ¨¡å—ã€‚</p><p>åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>æ ¸å¿ƒæ¨¡å—(<code>Node.js</code>è‡ªå¸¦çš„æ¨¡å—)</li><li>è·¯å¾„æ¨¡å—(ç›¸å¯¹æˆ–ç»å¯¹å®šä½å¼€å§‹çš„æ¨¡å—)</li><li>è‡ªå®šä¹‰æ¨¡å—(<code>node_modules</code>é‡Œçš„æ¨¡å—)</li></ul><p>ä¸‰ç§æ¨¡å—çš„æŸ¥æ‰¾æ–¹å¼ï¼š</p><ul><li>æ ¸å¿ƒæ¨¡å—ï¼Œç›´æ¥è·³è¿‡è·¯å¾„åˆ†æå’Œæ–‡ä»¶å®šä½</li><li>è·¯å¾„æ¨¡å—ï¼Œç›´æ¥å¾—å‡ºç›¸å¯¹è·¯å¾„å°±å¥½äº†</li><li>è‡ªå®šä¹‰æ¨¡å—ï¼Œå…ˆåœ¨å½“å‰ç›®å½•çš„<code>node_modules</code>é‡Œæ‰¾è¿™ä¸ªæ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šå¾€ä¸Šä¸€çº§ç›®å½•æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾ä¸Šä¸€çº§çš„<code>node_modules</code>ï¼Œä¾æ¬¡å¾€ä¸Šï¼Œç›´åˆ°æ ¹ç›®å½•ä¸‹éƒ½æ²¡æœ‰, å°±æŠ›å‡ºé”™è¯¯ã€‚</li></ul><p><strong>è‡ªå®šä¹‰æ¨¡å—çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼š</strong></p><p>è¿™ä¸ªè¿‡ç¨‹å…¶å®ä¹Ÿå«åš<strong>è·¯å¾„åˆ†æ</strong>ã€‚</p><p>ç°åœ¨æˆ‘æŠŠåˆšåˆšçš„<code>test.js</code>æ¥æ”¹ä¸€ä¸‹ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// var m1 = require('./m1.js');  </span>  <span class="hljs-comment">// console.log(m1);  </span><span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>.paths)</code></pre><p>ç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p><pre><code class="hljs bash">node test.js</code></pre><p>ä¼šå‘ç°è¾“å‡ºäº†ä¸‹é¢çš„ä¸€ä¸ªæ•°ç»„ï¼š</p><pre><code class="hljs bash">node test.js  [    <span class="hljs-string">'/Users/evanchen/codes/test/CommonJSå’ŒES6/commonJS/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/codes/test/CommonJSå’ŒES6/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/codes/test/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/codes/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/node_modules'</span>,    <span class="hljs-string">'/Users/node_modules'</span>,    <span class="hljs-string">'/node_modules'</span>  ]</code></pre><p>è¿™é‡Œæ‰€è¯´çš„æŸ¥æ‰¾ï¼Œæ˜¯æŒ‡æŸ¥æ‰¾ä½ ç°åœ¨ç”¨çš„è¿™ä¸ªæ¨¡å—ï¼Œæˆ‘ç°åœ¨ç”¨çš„æ˜¯<code>test.js</code>ï¼Œä½ å¯èƒ½çœ‹ä¸å‡ºä»€ä¹ˆæ•ˆæœã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªæˆ‘ä»¬ä½¿ç”¨<code>npm i</code>å®‰è£…çš„ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—åŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ªåå«<code>node_modules</code>çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ–°å»ºäº†ä¸€ä¸ªåå«<code>evanchen.js</code>çš„æ–‡ä»¶ï¼Œç”¨æ¥æ¨¡æ‹Ÿä¸€ä¸ª<code>npm</code>å®‰è£…çš„ä¾èµ–ã€‚</p><p>ç›®å½•ç»“æ„ï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000022599814" srcset="/img/loading.gif" alt="img"></p><p>ç¨å¾®ç¼–å†™ä¸€ä¸‹<code>evanchen.js</code>:</p><pre><code class="hljs js"><span class="hljs-built_in">module</span>.exports = &#123;    print: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'evanchen'</span>)    &#125;  &#125;  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'evanchenæ¨¡å—ï¼š'</span>, <span class="hljs-built_in">module</span>.paths)</code></pre><p>ç„¶ååœ¨<code>test.js</code>ä¸­å¼•å…¥è¿™ä¸ª<code>evanchen</code>æ¨¡å—:</p><pre><code class="hljs js"><span class="hljs-comment">// var m1 = require('./m1.js');  </span><span class="hljs-comment">// console.log(m1);  </span><span class="hljs-comment">// console.log(module.paths)  </span>  <span class="hljs-keyword">var</span> evanchen = <span class="hljs-built_in">require</span>(<span class="hljs-string">'evanchen'</span>);  evanchen.print();</code></pre><p>ç°åœ¨æ‰§è¡Œ<code>node test.js</code>ï¼Œä¼šå‘ç°è¾“å‡ºäº†ï¼š</p><pre><code class="hljs js">node test.js  evanchenæ¨¡å—ï¼š [    <span class="hljs-string">'/Users/evanchen/codes/test/CommonJSå’ŒES6/commonJS/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/codes/test/CommonJSå’ŒES6/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/codes/test/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/codes/node_modules'</span>,    <span class="hljs-string">'/Users/evanchen/node_modules'</span>,    <span class="hljs-string">'/Users/node_modules'</span>,    <span class="hljs-string">'/node_modules'</span>  ]  evanchen</code></pre><p>æ‰€ä»¥ç°åœ¨ä½ å¯ä»¥çŸ¥é“ï¼Œå¹³å¸¸æˆ‘ä»¬ä½¿ç”¨è¿™ç§ä¾èµ–çš„æ—¶å€™ï¼Œå®ƒæ˜¯æ€æ ·çš„ä¸€ä¸ªæŸ¥æ‰¾é¡ºåºäº†å§ï¼Œå®ƒå…¶å®å°±æ˜¯æŒ‰ç…§è‡ªå®šä¹‰æ¨¡å—çš„é¡ºåºæ¥è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><p><strong>æ–‡ä»¶å®šä½ï¼š</strong></p><p>ä¸Šé¢ğŸ‘†å·²ç»ä»‹ç»å®Œäº†è·¯å¾„åˆ†æï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬å¯¼å…¥çš„æ¨¡å—å®ƒçš„åç¼€(æ‰©å±•å)æ˜¯å¯ä»¥çœç•¥çš„å•Šï¼Œé‚£<code>Node</code>æ€ä¹ˆçŸ¥é“æˆ‘ä»¬æ˜¯å¯¼å…¥äº†ä¸€ä¸ª<code>js</code>è¿˜æ˜¯ä¸€ä¸ª<code>json</code>å‘¢ï¼Ÿè¿™å…¶å®å°±æ¶‰åŠåˆ°äº†æ–‡ä»¶å®šä½ã€‚</p><p>åœ¨NodeJSä¸­, çœç•¥äº†æ‰©å±•åçš„æ–‡ä»¶, ä¼šä¾æ¬¡è¡¥å……ä¸Š.js, .node, .jsonæ¥å°è¯•, å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªç›®å½•, é‚£ä¹ˆNodeJSä¼šæŠŠå®ƒå½“æˆä¸€ä¸ªåŒ…æ¥çœ‹å¾…, ä¼šé‡‡ç”¨ä»¥ä¸‹æ–¹å¼ç¡®å®šæ–‡ä»¶å</p><p>ç¬¬ä¸€æ­¥, æ‰¾å‡ºç›®å½•ä¸‹çš„package.json, ç”¨JSON.parse()è§£æå‡ºmainå­—æ®µ</p><p>ç¬¬äºŒæ­¥, å¦‚æœmainå­—æ®µæŒ‡å®šçš„æ–‡ä»¶è¿˜æ˜¯çœç•¥äº†æ‰©å±•, é‚£ä¹ˆä¼šä¾æ¬¡è¡¥å…….js, .node, .jsonå°è¯•.</p><p>ç¬¬ä¸‰æ­¥, å¦‚æœmainå­—æ®µåˆ¶å®šçš„æ–‡ä»¶ä¸å­˜åœ¨, æˆ–è€…æ ¹æœ¬å°±ä¸å­˜åœ¨package.json, é‚£ä¹ˆä¼šé»˜è®¤åŠ è½½è¿™ä¸ªç›®å½•ä¸‹çš„index.js, index.node, index.jsonæ–‡ä»¶.</p><p>ä»¥ä¸Šå°±æ˜¯æ–‡ä»¶å®šä½çš„è¿‡ç¨‹, å†æ­é…ä¸Šè·¯å¾„åˆ†æçš„è¿‡ç¨‹, è¿›è¡Œæ’åˆ—ç»„åˆ, è¿™å¾—æœ‰å¤šå°‘ç§å¯èƒ½å‘€. æ‰€ä»¥è¯´, è‡ªå®šä¹‰æ¨¡å—çš„å¼•å…¥, æ˜¯æœ€è´¹æ€§èƒ½çš„.</p><h2 id="4-CommonJSè§„èŒƒçš„ç‰¹ç‚¹"><a href="#4-CommonJSè§„èŒƒçš„ç‰¹ç‚¹" class="headerlink" title="4. CommonJSè§„èŒƒçš„ç‰¹ç‚¹"></a>4. CommonJSè§„èŒƒçš„ç‰¹ç‚¹</h2><p>æˆ‘å…ˆæŠŠ<code>CommonJS</code>è§„èŒƒçš„ä¸€äº›ç‰¹ç‚¹åˆ—ä¸¾å‡ºæ¥å§ï¼Œç„¶åæˆ‘ä»¬å†ä¸€ç‚¹ä¸€ç‚¹çš„å»çœ‹ä¾‹å­ã€‚</p><ul><li>æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸï¼›</li><li>æ¨¡å—æ˜¯åŒæ­¥åŠ è½½çš„ï¼Œå³åªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œï¼›</li><li>æ¨¡å—åœ¨é¦–æ¬¡æ‰§è¡Œåå°±ä¼šç¼“å­˜ï¼Œå†æ¬¡åŠ è½½åªè¿”å›ç¼“å­˜ç»“æœï¼Œå¦‚æœæƒ³è¦å†æ¬¡æ‰§è¡Œï¼Œå¯æ¸…é™¤ç¼“å­˜ï¼›</li><li>CommonJSè¾“å‡ºæ˜¯å€¼çš„æ‹·è´(å³ï¼Œ<code>require</code>è¿”å›çš„å€¼æ˜¯è¢«è¾“å‡ºçš„å€¼çš„æ‹·è´ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–ä¹Ÿä¸ä¼šå½±å“è¿™ä¸ªå€¼)ã€‚</li></ul><p>(æ€»ç»“æ¥æºï¼š<a href="https://juejin.im/post/5db95e3a6fb9a020704bcd8d" target="_blank" rel="noopener">https://juejin.im/post/5db95eâ€¦</a>)</p><p>ç¬¬ä¸€ç‚¹è¿˜æ˜¯å¥½ç†è§£çš„ï¼Œå’±æ¨¡å—çš„ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ä¸å°±æ˜¯è¿™ä¸ªå—ã€‚</p><p>ç¬¬äºŒç‚¹<strong>åŒæ­¥åŠ è½½</strong>ï¼Œè¿™ä¸ªå†™ä¸ªæ¡ˆä¾‹æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹</p><p><strong>åŒæ­¥åŠ è½½æ¡ˆä¾‹</strong>ï¼š</p><p><em>m1.js</em>:</p><pre><code class="hljs js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯m1æ¨¡å—'</span>)  <span class="hljs-built_in">module</span>.exports = &#123;      name: <span class="hljs-string">'evanchen'</span>,      sex: <span class="hljs-string">'boy'</span>  &#125;</code></pre><p><em>test.js</em></p><pre><code class="hljs js"><span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1'</span>);  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯testæ¨¡å—'</span>);</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>test</code>æ¨¡å—ä¾èµ–äº<code>m1</code>ï¼Œä¸”æ˜¯å…ˆä¸‹è½½çš„<code>m1</code>æ¨¡å—ï¼Œæ‰€ä»¥å¦‚æœæˆ‘æ‰§è¡Œ<code>node test.js</code>ï¼Œä¼šæœ‰ä»¥ä¸‹çš„æ‰§è¡Œç»“æœï¼š</p><pre><code class="hljs js">node test.js  æˆ‘æ˜¯m1æ¨¡å—  æˆ‘æ˜¯testæ¨¡å—</code></pre><p>è¿™ä¹Ÿå°±éªŒè¯äº†<code>CommonJS</code>ä¸­ï¼Œæ¨¡å—æ˜¯åŒæ­¥åŠ è½½çš„ï¼Œå³åªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œã€‚</p><p>ç¬¬ä¸‰ç‚¹<strong>æ¨¡å—é¦–æ¬¡æ‰§è¡Œåä¼šç¼“å­˜</strong>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†™ä¸ªæ¡ˆä¾‹æ¥éªŒè¯ä¸€ä¸‹ã€‚</p><p><strong>æ¨¡å—é¦–æ¬¡æ‰§è¡Œåä¼šç¼“å­˜æ¡ˆä¾‹ï¼š</strong></p><p><em>m1.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> name = <span class="hljs-string">'evanchen'</span>;  <span class="hljs-keyword">var</span> sex = <span class="hljs-string">'boy'</span>;    exports.name = name;  exports.sex = sex;</code></pre><p><em>test.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1'</span>);  m1.sex = <span class="hljs-string">'girl'</span>;  <span class="hljs-built_in">console</span>.log(m1);    <span class="hljs-keyword">var</span> m2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1'</span>);  <span class="hljs-built_in">console</span>.log(m2);</code></pre><p><code>test</code>åŒæ ·ä¾èµ–äº<code>m1</code>ï¼Œä½†æ˜¯æˆ‘ä¼šåœ¨å…¶ä¸­å¯¼å…¥ä¸¤æ¬¡<code>m1</code>ï¼Œç¬¬ä¸€æ¬¡å¯¼å…¥çš„æ—¶å€™ä¿®æ”¹äº†<code>m1.sex</code>çš„å€¼ï¼Œç¬¬äºŒæ¬¡çš„æ—¶å€™å‘½åä¸º<code>m2</code>ï¼Œä½†æ˜¯ç»“æœ<code>m1</code>å’Œ<code>m2</code>ç«Ÿç„¶æ˜¯ç›¸ç­‰çš„ï¼š</p><pre><code class="hljs js">LinDaiDaideMBP:commonJS evanchen$ node test.js  &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">'evanchen'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'girl'</span> &#125;  &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">'evanchen'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'girl'</span> &#125;</code></pre><p>ä¹Ÿå°±æ˜¯è¯´æ¨¡å—åœ¨é¦–æ¬¡æ‰§è¡Œåå°±ä¼šç¼“å­˜ï¼Œå†æ¬¡åŠ è½½åªè¿”å›ç¼“å­˜ç»“æœï¼Œè¿™é‡Œæˆ‘æ˜¯ç”¨äº†æ”¹å˜<code>m1.sex</code>çš„å€¼æ¥è¯æ˜å®ƒç¡®å®æ˜¯å–äº†ç¼“å­˜ç»“æœã€‚</p><p>é‚£ä¹ˆå°±æœ‰å°ä¼™ä¼´ä¼šç–‘æƒ‘äº†ï¼Œå…¶å®ä½ è¿™æ ·å†™ä¹Ÿå¹¶ä¸èƒ½è¯æ˜å•Šï¼Œå› ä¸ºä½ æ”¹å˜äº†<code>m1.sex</code>ä¹Ÿå¯èƒ½æ˜¯å½±å“åŸæœ¬<code>m1</code>æ¨¡å—é‡Œçš„<code>sex</code>å±æ€§å‘€ï¼Œè¿™æ ·çš„è¯ç¬¬äºŒæ¬¡<code>m2</code>æ‹¿åˆ°çš„è‚¯å®šå°±æ˜¯è¢«æ”¹å˜çš„å€¼äº†ã€‚</p><p>å””â€¦æˆ‘æ­£æƒ³è¯æ˜æ¥ç€å‘¢ã€‚å› ä¸º<code>CommonJS</code>çš„ç¬¬å››ä¸ªç‰¹ç‚¹å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³ä½ è¿™ä¸ªç–‘é—®ã€‚</p><p>ç¬¬å››ç‚¹<strong>CommonJSè¾“å‡ºæ˜¯å€¼çš„æ‹·è´</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ç”¨<code>require()</code>å¼•å…¥äº†æ¨¡å—ï¼Œä½†æ˜¯ä½ åœ¨æœ€æ–°çš„æ¨¡å—ä¸­æ€æ ·å»æ”¹å˜ï¼Œä¹Ÿä¸ä¼šå½±å“ä½ å·²ç»<code>require()</code>çš„æ¨¡å—ã€‚æ¥çœ‹ä¸ªæ¡ˆä¾‹ã€‚</p><p><strong>CommonJSè¾“å‡ºæ˜¯å€¼çš„æ‹·è´æ¡ˆä¾‹</strong>ï¼š</p><p><em>m1.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> name = <span class="hljs-string">'evanchen'</span>;  <span class="hljs-keyword">var</span> sex = <span class="hljs-string">'boy'</span>;  <span class="hljs-keyword">var</span> advantage = [<span class="hljs-string">'handsome'</span>]    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    sex = <span class="hljs-string">'girl'</span>;    advantage.push(<span class="hljs-string">'cute'</span>);  &#125;, <span class="hljs-number">500</span>)    exports.name = name;  exports.sex = sex;  exports.advantage = advantage;</code></pre><p><em>test.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1'</span>);  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'read count after 1000ms in commonjs is'</span>, m1.sex)    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'read count after 1000ms in commonjs is'</span>, m1.advantage)  &#125;, <span class="hljs-number">1000</span>)</code></pre><p>æ‰§è¡Œ<code>node test.js</code>ä¹‹åçš„æ‰§è¡Œç»“æœæ˜¯ï¼š</p><pre><code class="hljs js">LinDaiDaideMBP:commonJS evanchen$ node test.js  read count after <span class="hljs-number">1000</span>ms <span class="hljs-keyword">in</span> commonjs is boy  read count after <span class="hljs-number">1000</span>ms <span class="hljs-keyword">in</span> commonjs is [ <span class="hljs-string">'handsome'</span>, <span class="hljs-string">'cute'</span> ]</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¼€å§‹<code>var m1 = require(&#39;./m1&#39;)</code>çš„æ—¶å€™ï¼Œ<code>m1</code>å·²ç»è¢«å¼•å…¥è¿›æ¥äº†ï¼Œä½†æ˜¯è¿‡äº†<code>500ms</code>åæˆ‘æ”¹å˜äº†åŸæœ¬<code>m1</code>é‡Œçš„ä¸€äº›å±æ€§ï¼Œ<code>sex</code>è¿™ç§åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä¸ä¼šè¢«æ”¹å˜çš„ï¼Œä½†æ˜¯<code>advantage</code>è¿™ç§å¼•ç”¨ç±»å‹å…±ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚ï¼ˆè¿™ç§å¤åˆ¶çš„å…³ç³»è®©æˆ‘æƒ³åˆ°äº†ä¹‹å‰å­¦åŸå‹é“¾ç»§æ‰¿çš„æ—¶å€™ï¼Œå®ƒé‚£é‡Œä¹Ÿæ˜¯ï¼Œä¼šå½±å“<code>Father.prototype</code>ä¸Šçš„å¼•ç”¨ç±»å‹ï¼‰</p><blockquote><p><strong>å¤‡æ³¨</strong> å…¶å®è¿™é‡Œçš„æ‹·è´æ˜¯æŒ‡ JavaScript çš„æµ…æ‹·è´ï¼Œå¦‚æœå¯¹äº JavaScript çš„æ·±æµ…æ‹·è´æœ‰ç–‘é—®ï¼Œå¯ä»¥å‚è€ƒ <a href="https://segmentfault.com/a/1190000022416673" target="_blank" rel="noopener">JavaScript çš„æµ…æ‹·è´å’Œæ·±æ‹·è´</a></p></blockquote><p>å¦‚æœè¿™é‡Œä½ æ˜¯è¿™æ ·å†™çš„è¯ï¼š</p><p><em>m1.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> name = <span class="hljs-string">'evanchen'</span>;  <span class="hljs-keyword">var</span> sex = <span class="hljs-string">'boy'</span>;  <span class="hljs-keyword">var</span> advantage = [<span class="hljs-string">'handsome'</span>]    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    sex = <span class="hljs-string">'girl'</span>;    <span class="hljs-comment">// advantage.push('cute');  </span>  advantage = [<span class="hljs-string">'cute'</span>];  &#125;, <span class="hljs-number">500</span>)    exports.name = name;  exports.sex = sex;  exports.advantage = advantage;</code></pre><p>ç°åœ¨çš„æ‰§è¡Œç»“æœè‚¯å®šå°±æ˜¯ï¼š</p><pre><code class="hljs js">node test.js  read count after <span class="hljs-number">1000</span>ms <span class="hljs-keyword">in</span> commonjs is boy  read count after <span class="hljs-number">1000</span>ms <span class="hljs-keyword">in</span> commonjs is [ <span class="hljs-string">'handsome'</span> ]</code></pre><p>å› ä¸ºç›¸å½“äºå¯¹<code>m1</code>çš„<code>advantage</code>é‡æ–°èµ‹å€¼äº†ã€‚</p><p>å½“ç„¶ï¼Œæˆ–è€…å¦‚æœä½ çš„<code>m1.js</code>ä¸­è¿”å›çš„å€¼æ˜¯ä¼šæœ‰ä¸€ä¸ªå‡½æ•°çš„è¯ï¼Œåœ¨<code>test.js</code>ä¹Ÿèƒ½æ‹¿åˆ°å˜åŒ–ä¹‹åçš„å€¼äº†ï¼Œæ¯”å¦‚è¿™é‡Œçš„ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> counter = <span class="hljs-number">3</span>;  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">incCounter</span>(<span class="hljs-params"></span>) </span>&#123;    counter++;  &#125;  <span class="hljs-built_in">module</span>.exports = &#123;    <span class="hljs-keyword">get</span> counter() &#123;      <span class="hljs-keyword">return</span> counter    &#125;,    incCounter: incCounter,  &#125;;</code></pre><p>å› ä¸ºåœ¨è¿™é‡Œå®é™…å°±å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œè€Œ<code>counter</code>å±æ€§å°±æ˜¯ä¸€ä¸ªå–å€¼å™¨å‡½æ•°ã€‚</p><p>å¥½æ»´ï¼Œè¿™åŸºæœ¬å°±æ˜¯<code>CommonJS</code>çš„ç‰¹ç‚¹äº†ï¼Œæ€»ç»“å°±ä¸å†™äº†ï¼Œåœ¨å¼€å¤´å·²ç»è¯´è¿‡äº†ï¼Œä¸è¿‡å¯¹äºæœ€åä¸€ç‚¹ï¼š<strong>CommonJSè¾“å‡ºæ˜¯å€¼çš„æ‹·è´</strong>ï¼Œè¿™ä¸ªå¯¹äºå¼•ç”¨ç±»å‹çš„å˜é‡æ¥è¯´è¿˜æ˜¯ä¼šæœ‰ä¸€ç‚¹æ­§ä¹‰çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„<code>advantage</code>é‚£ä¸ªä¾‹å­ï¼Œå¤§å®¶çŸ¥é“å°±è¡Œäº†ã€‚</p><h1 id="AMDè§„èŒƒ"><a href="#AMDè§„èŒƒ" class="headerlink" title="AMDè§„èŒƒ"></a>AMDè§„èŒƒ</h1><h2 id="1-äº§ç”ŸåŸå› "><a href="#1-äº§ç”ŸåŸå› " class="headerlink" title="1. äº§ç”ŸåŸå› "></a>1. äº§ç”ŸåŸå› </h2><p>ä¸Šé¢ä»‹ç»çš„<code>CommonJS</code>è§„èŒƒçœ‹èµ·æ¥æŒºå¥½ç”¨çš„å•Šï¼Œä¸ºä»€ä¹ˆåˆè¿˜è¦æœ‰å…¶å®ƒçš„è§„èŒƒå‘¢ï¼Ÿæ¯”å¦‚<code>AMDã€CMD</code>ï¼Œé‚£å®ƒä»¬å’Œ<code>CommonJS</code>åˆæœ‰ä»€ä¹ˆæ¸Šæºå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¨¡å—åŒ–è¿™ç§æ¦‚å¿µä¸ä»…ä»…é€‚ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯åŒæ ·ä¹Ÿé€‚ç”¨ã€‚</p><p>è€Œ<code>CommonJS</code>è§„èŒƒå°±ä¸å¤ªé€‚åˆç”¨åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨)ç¯å¢ƒäº†ï¼Œæ¯”å¦‚ä¸Šé¢çš„é‚£ä¸ªä¾‹å­ï¼Œä¹Ÿå°±æ˜¯:</p><p><strong>test.js</strong>:</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./m1.js'</span>)  <span class="hljs-built_in">console</span>.log(m1);    <span class="hljs-comment">// ä¸m1æ¨¡å—æ— å…³çš„ä¸€äº›ä»£ç   </span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">other</span> (<span class="hljs-params"></span>) </span>&#123;&#125;  other();</code></pre><p>è¿™æ®µä»£ç æ”¾åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå®ƒä¼šå¦‚ä½•è¿è¡Œå‘¢ï¼Ÿ</p><ul><li>é¦–å…ˆåŠ è½½<code>m1.js</code></li><li>ç­‰<code>m1.js</code>åŠ è½½å®Œæ¯•ä¹‹åæ‰æ‰§è¡Œåé¢çš„å†…å®¹</li></ul><p>è¿™ç‚¹å…¶å®åœ¨<strong>CommonJSè§„èŒƒçš„ç‰¹ç‚¹</strong>ä¸­å·²ç»æåˆ°è¿‡äº†ã€‚</p><p>åé¢çš„å†…å®¹è¦ç­‰å¾…<code>m1</code>åŠ è½½å®Œæ‰ä¼šæ‰§è¡Œï¼Œå¦‚æœ<code>m1</code>åŠ è½½çš„å¾ˆæ…¢å‘¢ï¼Ÿé‚£ä¸å°±é€ æˆäº†å¡é¡¿ï¼Œè¿™å¯¹äºå®¢æˆ·ç«¯æ¥è¯´è‚¯å®šæ˜¯ä¸å‹å¥½çš„ã€‚åƒè¿™ç§è¦ç­‰å¾…ä¸Šä¸€ä¸ªåŠ è½½å®Œæ‰æ‰§è¡Œåé¢å†…å®¹çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥å«åš<code>&quot;åŒæ­¥åŠ è½½&quot;</code>ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œæˆ‘ä»¬æ›´å¸Œæœ›çš„æ˜¯<code>other()</code>çš„æ‰§è¡Œä¸éœ€è¦ç­‰<code>m1</code>åŠ è½½å®Œæ‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›<code>m1</code>å®ƒæ˜¯<code>&quot;å¼‚æ­¥åŠ è½½&quot;</code>çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯<code>AMD</code>ã€‚</p><p>åœ¨ä»‹ç»<code>AMD</code>ä¹‹å‰è®©æˆ‘ä»¬çœ‹çœ‹<code>CommonJS</code>è§„èŒƒå¯¹æœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨çš„ä¸åŒï¼Œå®ƒæœ‰åŠ©äºè®©ä½ ç†è§£ä¸ºä»€ä¹ˆè¯´<code>CommonJS</code>ä¸å¤ªé€‚åˆäºå®¢æˆ·ç«¯ï¼š</p><ul><li>æœåŠ¡å™¨ç«¯æ‰€æœ‰çš„æ¨¡å—éƒ½å­˜æ”¾åœ¨æœ¬åœ°ç¡¬ç›˜ä¸­ï¼Œå¯ä»¥åŒæ­¥åŠ è½½å®Œæˆï¼Œç­‰å¾…æ—¶é—´å°±æ˜¯ç¡¬ç›˜çš„è¯»å–æ—¶é—´ã€‚</li><li>æµè§ˆå™¨ï¼Œæ‰€æœ‰çš„æ¨¡å—éƒ½æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œç­‰å¾…æ—¶é—´å–å†³äºç½‘é€Ÿçš„å¿«æ…¢ï¼Œå¯èƒ½è¦ç­‰å¾ˆé•¿æ—¶é—´ï¼Œæµè§ˆå™¨å¤„äº<strong>å‡æ­»</strong>çŠ¶æ€ã€‚</li></ul><h2 id="2-å®šä¹‰å¹¶æš´éœ²æ¨¡å—"><a href="#2-å®šä¹‰å¹¶æš´éœ²æ¨¡å—" class="headerlink" title="2. å®šä¹‰å¹¶æš´éœ²æ¨¡å—"></a>2. å®šä¹‰å¹¶æš´éœ²æ¨¡å—</h2><p>æœ‰äº†ä¸Šé¢è¿™å±‚èƒŒæ™¯ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œ<code>AMD</code>å®ƒçš„äº§ç”Ÿå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å°±æ˜¯ä¸ºäº†èƒ½è®©æˆ‘ä»¬é‡‡ç”¨<strong>å¼‚æ­¥çš„æ–¹å¼åŠ è½½æ¨¡å—</strong>ã€‚</p><p>æ‰€ä»¥ç°åœ¨æ¥è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„ä»‹ç»å§ã€‚</p><p><code>AMD</code>æ˜¯<code>Asynchronous Module Definition</code>çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯<code>&quot;å¼‚æ­¥æ¨¡å—å®šä¹‰&quot;</code>ã€‚ï¼ˆå‰é¢çš„<code>A</code>å°±å¾ˆå¥½è®°äº†ï¼Œå®ƒè®©æˆ‘ä¸è‡ªè§‰çš„å°±æƒ³åˆ°<code>async</code>è¿™ä¸ªå®šä¹‰å¼‚æ­¥å‡½æ•°çš„ä¿®é¥°ç¬¦ï¼‰</p><blockquote><p>å®ƒé‡‡ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½æ¨¡å—ï¼Œæ¨¡å—çš„åŠ è½½ä¸å½±å“å®ƒåé¢è¯­å¥çš„è¿è¡Œã€‚æ‰€æœ‰ä¾èµ–è¿™ä¸ªæ¨¡å—çš„è¯­å¥ï¼Œéƒ½å®šä¹‰åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç­‰åˆ°åŠ è½½å®Œæˆä¹‹åï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ‰ä¼šè¿è¡Œã€‚</p></blockquote><p>æ­¤æ—¶å°±éœ€è¦å¦ä¸€ä¸ªé‡è¦çš„æ–¹æ³•æ¥å®šä¹‰æˆ‘ä»¬çš„æ¨¡å—ï¼š<code>define()</code>ã€‚</p><p>å®ƒå…¶å®æ˜¯ä¼šæœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><pre><code class="hljs js">define(id?, dependencies?, factory)</code></pre><ul><li>id: ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¨¡å—çš„åç§°ï¼Œä½†æ˜¯æ˜¯å¯é€‰çš„</li><li>dependencies: ä¸€ä¸ªæ•°ç»„ï¼Œæ˜¯æˆ‘ä»¬å½“å‰å®šä¹‰çš„æ¨¡å—è¦ä¾èµ–äºå“ªäº›æ¨¡å—ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹è¡¨ç¤ºçš„æ˜¯è¦ä¾èµ–æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ï¼Œä¸”è¿™ä¸ªå‚æ•°ä¹Ÿæ˜¯å¯é€‰çš„</li><li>factory: å·¥å‚æ–¹æ³•ï¼Œä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œé¢å°±æ˜¯å…·ä½“çš„æ¨¡å—å†…å®¹äº†</li></ul><p><strong>å‘ä¸€</strong>ï¼š</p><p>é‚£å…¶å®å°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œçœ‹äº†è¿™ä¹ˆå¤šçš„æ•™æï¼Œä½†æˆ‘æƒ³è¦å»å†™æ¡ˆä¾‹çš„æ—¶å€™ï¼Œæˆ‘ä»¥ä¸ºè¿™ä¸ª<code>define</code>èƒ½ç›´æ¥åƒ<code>require</code>ä¸€æ ·å»ç”¨ï¼Œç»“æœå‘ç°æ§åˆ¶å°ä¸€ç›´å†æŠ¥é”™ï¼š</p><pre><code class="hljs js"><span class="hljs-built_in">ReferenceError</span>: define is not defined</code></pre><p>çœ‹æ¥å®ƒè¿˜å¹¶ä¸æ˜¯<code>Node.js</code>è‡ªå¸¦çš„ä¸€ä¸ªæ–¹æ³•å•Šï¼Œæœå¯»äº†ä¸€ä¸‹ï¼ŒåŸæ¥å®ƒåªæ˜¯åä¹‰ä¸Šè§„å®šçš„è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä½ çœŸçš„æƒ³è¦å»ç”¨è¿˜æ˜¯å¾—ä½¿ç”¨å¯¹åº”çš„<code>JavaScript</code>åº“ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸å¸¸å¬åˆ°çš„ï¼š</p><blockquote><p>ç›®å‰ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªJavascriptåº“å®ç°äº†AMDè§„èŒƒï¼šrequire.jså’Œcurl.jsã€‚</p></blockquote><p>æˆ‘é…¸äº†â€¦</p><p>è®©æˆ‘ä»¬å»requirejsçš„å®˜ç½‘çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒï¼Œç”±äºæˆ‘çš„æ¡ˆä¾‹éƒ½æ˜¯åœ¨<code>Node</code>æ‰§è¡Œç¯å¢ƒä¸­ï¼Œäºæ˜¯æˆ‘é‡‡ç”¨<code>npm install</code>çš„æ–¹å¼æ¥ä¸‹è½½äº†ï¼š</p><p>æˆ‘æ–°å»ºäº†ä¸€ä¸ªå«<code>AMD</code>çš„æ–‡ä»¶å¤¹ï¼Œä½œä¸º<code>AMD</code>çš„æ¡ˆä¾‹ã€‚</p><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š</p><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> i requirejs</code></pre><p>ï¼ˆæ‰¾äº†ä¸€åœˆNPMä¹Ÿæ²¡çœ‹åˆ°èƒ½ä½¿ç”¨<code>CDN</code>è¿œç¨‹å¼•å…¥çš„ï¼‰</p><p>æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å‡ºç°äº†ä¾èµ–åŒ…ï¼Œæ‰“å¼€çœ‹äº†çœ‹ï¼Œç¡®å®æ˜¯ä¸‹è½½ä¸‹æ¥äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmz1ltur86j30vl0u0qe7.jpg" srcset="/img/loading.gif" alt="image-20210124201016709"></p><p>ç°åœ¨å¯ä»¥å¼€å¿ƒçš„åœ¨é¡¹ç›®é‡Œç”¨<code>define()</code>äº† ğŸ˜Šã€‚</p><p>æ¥çœ‹ä¸ªå°ä¾‹å­ï¼Œæˆ‘é‡æ–°å®šä¹‰äº†ä¸€ä¸ª<code>math.js</code>ï¼š</p><p><strong>math.js</strong></p><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">var</span> add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>&#123;      <span class="hljs-keyword">return</span> a + b;    &#125;    <span class="hljs-keyword">return</span> &#123;      add: add    &#125;  &#125;)</code></pre><p>è¿™é‡Œæ¨¡å—å¾ˆç®€å•ï¼Œå¯¼å‡ºäº†ä¸€ä¸ªåŠ æ³•å‡½æ•°ã€‚</p><p>(è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆ<code>add: add</code>è¦è¿™æ ·å†™ï¼Œè€Œä¸æ˜¯åªç®€å†™ä¸º<code>add</code>å‘¢ï¼Ÿåˆ«å¿˜äº†è¿™ç§å¯¹è±¡åŒåå±æ€§ç®€å†™æ˜¯<code>ES6</code>æ‰å‡ºæ¥çš„å“¦)</p><h2 id="3-å¼•ç”¨æ¨¡å—"><a href="#3-å¼•ç”¨æ¨¡å—" class="headerlink" title="3. å¼•ç”¨æ¨¡å—"></a>3. å¼•ç”¨æ¨¡å—</h2><p><strong>å‘äºŒ</strong>ï¼š</p><p>OKğŸ‘Œï¼Œæ—¢ç„¶æ¨¡å—å·²ç»èƒ½å¯¼å‡ºäº†ï¼Œé‚£å°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¼•ç”¨å§ï¼Œä¾ç…§ç€æ•™æï¼Œæˆ‘åœ¨<code>test.js</code>ä¸­å¼•å…¥äº†<code>math</code>æ¨¡å—å¹¶æƒ³è¦è°ƒç”¨<code>add()</code>æ–¹æ³•ï¼š</p><p><strong>test.js</strong>:</p><pre><code class="hljs js"><span class="hljs-built_in">require</span>([<span class="hljs-string">'math'</span>],<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">math</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(math)    <span class="hljs-built_in">console</span>.log(math.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));  &#125;)</code></pre><p>ä¹‹åç†Ÿç»ƒçš„æ‰§è¡Œ<code>node test.js</code>ã€‚</p><p>æˆ‘é…¸äº†â€¦</p><p>åˆæŠ¥é”™äº†ï¼Œæ“¦â€¦</p><pre><code class="hljs js"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ERR_INVALID_ARG_TYPE(name, <span class="hljs-string">'string'</span>, value);   <span class="hljs-built_in">TypeError</span> [ERR_INVALID_ARG_TYPE]: The <span class="hljs-string">"id"</span> argument must be <span class="hljs-keyword">of</span> type string. Received an instance <span class="hljs-keyword">of</span> <span class="hljs-built_in">Array</span></code></pre><p>ç¡®è®¤äº†ä¸€ä¸‹ï¼Œå’Œæ•™æä»¬ä¸­çš„å†™æ³•ä¸€æ ·å•Šï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦åŠ è½½çš„æ¨¡å—æ•°ç»„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåŠ è½½å®Œä¹‹åçš„å›è°ƒã€‚</p><p>éš¾å—ğŸ˜£â€¦åŸæ¥ä¸Šé¢ğŸ‘†<code>require([modules], callback)</code>è¿™æ ·çš„å†™æ³•å®ƒå’Œ<code>define</code>ä¸€æ ·éƒ½åªæ˜¯ä¸ªå™±å¤´ï¼Œå¦‚æœä½ çœŸå¾—ç”¨çš„è¯ï¼Œè¿˜æ˜¯å¾—ç”¨<code>JavaScript</code>åº“ä¸­çš„æ–¹æ³•ã€‚</p><p>ç”±äºä¸Šé¢å·²ç»å®‰è£…è¿‡<code>requirejs</code>äº†ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ï¼Œç°åœ¨æˆ‘ä¿®æ”¹äº†ä¸€ä¸‹<code>test.js</code>æ–‡ä»¶ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> requirejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"requirejs"</span>); <span class="hljs-comment">//å¼•å…¥requirejsæ¨¡å—  </span>  requirejs([<span class="hljs-string">'math'</span>],<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">math</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(math)    <span class="hljs-built_in">console</span>.log(math.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));  &#125;)</code></pre><p>å¥½äº†ï¼Œç°åœ¨æ‰§è¡Œ<code>node test.js</code>å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†â€¦</p><p>ï¼ˆå¾ˆéš¾å—â€¦æ„Ÿè§‰æ˜æ˜å·²ç»æ˜¯å¾ˆå¸¸è§è€³ç†Ÿèƒ½è¯¦çš„ä¸€äº›çŸ¥è¯†äº†ï¼ŒçœŸçš„è¦å»ç”¨çš„æ—¶å€™å‘ç°å’Œå¾ˆå¤šæ•™æä¸­è¯´çš„ä¸æ˜¯é‚£ä¹ˆä¸€å›äº‹â€¦ä¹Ÿå¸Œæœ›å¤§å®¶åœ¨çœ‹å®Œäº†ä¸€äº›æ•™æä¹‹åæœ€å¥½èƒ½äº²è‡ªå»å®è·µä¸€ä¸‹ï¼Œå› ä¸ºè‡ªå·±ä¹Ÿæ˜¯å†™åšå®¢çš„ï¼Œæ‰€ä»¥ä¹ŸçŸ¥é“æœ‰äº›æ—¶å€™ä¸€äº›çŸ¥è¯†ç‚¹å¯èƒ½ä¹Ÿæ˜¯ä»åˆ«äººçš„æ–‡ç« é‚£é‡Œçœ‹æ¥ä½†æ˜¯æ²¡æœ‰ç»è¿‡å®è·µçš„ï¼Œæ‰€ä»¥æœ€å¥½ä¹Ÿè¿˜æ˜¯è‡ªå·±åŠ¨åŠ¨æ‰‹ï¼‰</p><h2 id="4-ä¾èµ–å…¶å®ƒæ¨¡å—çš„define"><a href="#4-ä¾èµ–å…¶å®ƒæ¨¡å—çš„define" class="headerlink" title="4. ä¾èµ–å…¶å®ƒæ¨¡å—çš„define"></a>4. ä¾èµ–å…¶å®ƒæ¨¡å—çš„define</h2><p>å¯ä»¥çœ‹åˆ°<code>define</code>å®ƒè¿˜æœ‰å¦å¤–ä¸¤ä¸ªå‚æ•°çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ¨¡å—çš„åç§°ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬äºŒä¸ªå®ƒæ‰€ä¾èµ–çš„æ¨¡å—ã€‚</p><p>è¿˜è®°å¾—åœ¨<code>CommonJS</code>è§„èŒƒé‚£é‡Œæˆ‘ä»¬å†™äº†ä¸€ä¸ª<code>m1.js</code>å—ï¼Ÿç°åœ¨å°±è®©æˆ‘ä»¬æŠŠè¿™ä¸ªæ¨¡å—æ‹¿æ¥ç”¨ä¸‹ï¼ŒæŠŠå®ƒä½œä¸º<code>math.js</code>ä¸­çš„ä¸€ä¸ªä¾èµ–ã€‚</p><p><strong>m1.js</strong>:</p><pre><code class="hljs js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯m1, æˆ‘è¢«åŠ è½½äº†...'</span>)  <span class="hljs-built_in">module</span>.exports = &#123;      name: <span class="hljs-string">'evanchen'</span>,      sex: <span class="hljs-string">'boy'</span>  &#125;</code></pre><p>ç„¶åä¿®æ”¹ä¸€ä¸‹<code>math.js</code>ï¼š</p><p><strong>math.js</strong>:</p><pre><code class="hljs js">define([<span class="hljs-string">'m1'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m1</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯math, æˆ‘è¢«åŠ è½½äº†...'</span>)    <span class="hljs-keyword">var</span> add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>&#123;      <span class="hljs-keyword">return</span> a + b;    &#125;    <span class="hljs-keyword">var</span> print = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;      <span class="hljs-built_in">console</span>.log(m1.name)    &#125;    <span class="hljs-keyword">return</span> &#123;      add: add,      print: print    &#125;  &#125;)</code></pre><p>å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶çœ‹ï¼Œæˆ‘ä»¬å†æ¥ä¿®æ”¹ä¸€ä¸‹åˆšåˆšçš„<code>test.js</code>ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">var</span> requirejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"requirejs"</span>); <span class="hljs-comment">//å¼•å…¥requirejsæ¨¡å—  </span>  requirejs([<span class="hljs-string">'math'</span>],<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">math</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯test, æˆ‘è¢«åŠ è½½äº†...'</span>)    <span class="hljs-built_in">console</span>.log(math.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));    math.print();  &#125;)  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">other</span> (<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯testæ¨¡å—å†…çš„, ä½†æ˜¯æˆ‘ä¸ä¾èµ–math'</span>)  &#125;;  other();</code></pre><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¾èµ–å…³ç³»ä¾æ¬¡ä¸ºï¼š</p><pre><code class="hljs js">test -&gt; math -&gt; m1</code></pre><p>å¦‚æœæŒ‰ç…§<code>AMD</code>çš„è§„èŒƒï¼Œæ¨¡å—çš„åŠ è½½éœ€è¦ä¾é å‰ä¸€ä¸ªæ¨¡å—åŠ è½½å®Œæ‰ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°å†…çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æƒ³è±¡å½“æˆ‘åœ¨ç»ˆç«¯è¾“å…¥<code>node test.js</code>çš„æ—¶å€™ï¼Œè¦å‡ºç°çš„ç»“æœåº”è¯¥æ˜¯ï¼š</p><pre><code class="hljs js">LinDaiDaideMBP:commonJS evanchen$ node test.js  æˆ‘æ˜¯testæ¨¡å—å†…çš„, ä½†æ˜¯æˆ‘ä¸ä¾èµ–math  æˆ‘æ˜¯m1, æˆ‘è¢«åŠ è½½äº†...  æˆ‘æ˜¯math, æˆ‘è¢«åŠ è½½äº†...  æˆ‘æ˜¯test, æˆ‘è¢«åŠ è½½äº†...  <span class="hljs-number">3</span>  evanchen</code></pre><p>(è¿™ä¸ªï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥éƒ½çœ‹æ¸…äº†å½¼æ­¤çš„ä¾èµ–å…³ç³»å§ğŸ˜¢)</p><p>ä½†æ˜¯ç°å®æ€»æ˜¯é‚£ä¹ˆçš„æ®‹é…·ï¼Œå½“æˆ‘æŒ‰ä¸‹å›è½¦çš„æ—¶å€™ï¼ŒåˆæŠ¥é”™äº†â€¦</p><p>å†é…¸â€¦</p><pre><code class="hljs js"><span class="hljs-built_in">ReferenceError</span>: <span class="hljs-built_in">module</span> is not defined</code></pre><p>çœ‹äº†ä¸€ä¸‹è¿™ä¸ªæŠ¥é”™çš„å†…å®¹ï¼Œæ˜¯åœ¨<code>m1.js</code>ä¸­â€¦å‘†äº†å‡ ç§’é’Ÿååº”äº†è¿‡æ¥â€¦</p><p>æ—¢ç„¶æ˜¯ä½¿ç”¨<code>AMD</code>çš„è§„èŒƒï¼Œé‚£æˆ‘ä»¬è‚¯å®šæ˜¯è¦ä¸€ç»Ÿåˆ°åº•äº†ï¼Œ<code>m1.js</code>ä¸­ç”¨çš„è¿˜æ˜¯<code>CommonJS</code>çš„è§„èŒƒï¼Œå½“ç„¶ä¸è¡Œäº†ã€‚</p><p>OKï¼Œæ¥ä¿®æ”¹ä¸€ä¸‹<code>m1.js</code>ï¼š</p><p><strong>m1.js</strong>:</p><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯m1, æˆ‘è¢«åŠ è½½äº†...'</span>)    <span class="hljs-keyword">return</span> &#123;      name: <span class="hljs-string">'evanchen'</span>,      sex: <span class="hljs-string">'boy'</span>    &#125;  &#125;)</code></pre><p>OKğŸ‘Œï¼Œè¿™æ¬¡æ²¡å•¥é—®é¢˜äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„å»æ‰§è¡Œäº†â€¦ğŸ˜Šã€‚</p><p>ï¼ˆå½“ç„¶æ®æˆ‘çš„äº†è§£ï¼Œ<code>requirejs</code>è¿˜å¯ç”¨äºåœ¨<code>script</code>ä¸­å¼•ç”¨ç„¶åå®šä¹‰ç½‘é¡µç¨‹åºçš„ä¸»æ¨¡å—ç­‰ä½¿ç”¨ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼š</p><p><a href="http://www.ruanyifeng.com/blog/2012/11/require_js.html" target="_blank" rel="noopener">é˜®ä¸€å³°require</a></p><p><code>AMD</code>çš„çŸ¥è¯†ç‚¹å¤§æ¦‚å°±ä»‹ç»åˆ°äº†è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶ä¹ŸçŸ¥é“å®ƒçš„åŸºæœ¬ä½¿ç”¨äº†å§ï¼Œè‡³äºå…¶ä¸­çš„ä¸€äº›åŒºåˆ«ä»€ä¹ˆçš„æˆ‘åœ¨æœ€åä¹Ÿä¼šåˆ—ä¸€ä»½æ¸…å•ï¼Œä¸è¿‡ç°åœ¨è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>CMD</code>å§ã€‚</p><h1 id="CMDè§„èŒƒ"><a href="#CMDè§„èŒƒ" class="headerlink" title="CMDè§„èŒƒ"></a>CMDè§„èŒƒ</h1><blockquote><p>CMD (Common Module Definition), æ˜¯seajsæ¨å´‡çš„è§„èŒƒï¼Œä¾èµ–å°±è¿‘ï¼Œç”¨çš„æ—¶å€™å†requireã€‚</p></blockquote><p>æ¥çœ‹æ®µä»£ç ï¼Œå¤§æ¦‚æ„Ÿå—ä¸€ä¸‹å®ƒæ˜¯æ€æ ·ç”¨çš„ï¼š</p><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">require, exports, module</span>) </span>&#123;    <span class="hljs-keyword">var</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);    math.print()  &#125;)</code></pre><p>çœ‹ç€å’Œ<code>AMD</code>æœ‰ç‚¹åƒçš„ï¼Œæ²¡é”™ï¼Œå…¶å®<code>define()</code>çš„å‚æ•°ç”šè‡³éƒ½æ˜¯ä¸€æ ·çš„ï¼š</p><pre><code class="hljs js">define(id?, dependencies?, factory)</code></pre><p>ä½†æ˜¯åŒºåˆ«åœ¨äºå“ªé‡Œå‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€åä¸€ä¸ª<code>factory</code>å®ƒå‚æ•°ã€‚</p><p><code>factory</code>å‡½æ•°ä¸­æ˜¯ä¼šæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li><p><code>require</code></p></li><li><p><code>exports</code></p></li><li><pre><code>module<pre><code class="hljs autohotkey">  è¿™ä¸‰ä¸ªå¾ˆå¥½ç†è§£ï¼Œå¯¹åº”ç€ä¹‹å‰çš„`CommonJS`é‚£ä¸å°±æ˜¯ï¼š- `require`ï¼šå¼•å…¥æŸä¸ªæ¨¡å—- `exports`ï¼šå½“å‰æ¨¡å—çš„`exports`ï¼Œä¹Ÿå°±æ˜¯`module.exports`çš„ç®€å†™- `module`ï¼šå½“å‰è¿™ä¸ªæ¨¡å—ç°åœ¨å†æ¥è¯´è¯´`AMD`å’Œ`CMD`çš„åŒºåˆ«ã€‚<span class="hljs-title">è™½ç„¶å®ƒä»¬çš„`define()`æ–¹æ³•çš„å‚æ•°éƒ½ç›¸åŒï¼Œä½†æ˜¯:</span>- `AMD`ä¸­ä¼šæŠŠå½“å‰æ¨¡å—çš„ä¾èµ–æ¨¡å—æ”¾åˆ°`dependencies`ä¸­åŠ è½½ï¼Œå¹¶åœ¨`factory`å›è°ƒä¸­æ‹¿åˆ°åŠ è½½æˆåŠŸçš„ä¾èµ–- `CMD`ä¸€èˆ¬ä¸åœ¨`dependencies`ä¸­åŠ è½½ï¼Œè€Œæ˜¯å†™åœ¨`factory`ä¸­ï¼Œä½¿ç”¨`require`åŠ è½½æŸä¸ªä¾èµ–æ¨¡å—å› æ­¤æ‰æœ‰äº†æˆ‘ä»¬å¸¸å¸¸çœ‹åˆ°çš„ä¸€å¥è¯ï¼š&gt; AMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒï¼ŒäºŒè€…çš†ä¸ºå¼‚æ­¥åŠ è½½æ¨¡å—ã€‚ï¼ˆå¥½å§ï¼Œä»”ç»†è¯»äº†<span class="hljs-number">2</span>éæ„Ÿè§‰è¿˜æ˜¯æ²¡å¤ªæ˜ç™½ï¼Œæ²¡äº‹ï¼Œåé¢å‘†å‘†è¿˜ä¼šè¯¦ç»†è¯´åˆ°ï¼‰æ¯”è¾ƒæœ‰åä¸€ç‚¹çš„ï¼Œ`seajs`ï¼Œæ¥çœ‹çœ‹å®ƒæ¨èçš„CMD æ¨¡å—ä¹¦å†™æ ¼å¼å§ï¼š```js// æ‰€æœ‰æ¨¡å—éƒ½é€šè¿‡ define æ¥å®šä¹‰  define(function(require, exports, module) &#123;      // é€šè¿‡ require å¼•å…¥ä¾èµ–    var $ = require('jquery')<span class="hljs-comment">;  </span>  var Spinning = require('./spinning')<span class="hljs-comment">;  </span>    // é€šè¿‡ exports å¯¹å¤–æä¾›æ¥å£    exports.doSomething = ...      // æˆ–è€…é€šè¿‡ module.exports æä¾›æ•´ä¸ªæ¥å£    module.exports = ...    &#125;)<span class="hljs-comment">;</span></code></pre></code></pre></li></ul><p>è¿™æ˜¯å®˜ç½‘çš„ä¸€ä¸ªå°æ¡ˆä¾‹ï¼Œæˆ‘ä¹Ÿå»seajsçš„æ–‡æ¡£ä¸­çœ‹äº†ä¸€ä¸‹æ²¡å•¥å¤ªå¤§é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸ä¸¾ä¾‹äº†ã€‚</p><h2 id="AMDå’ŒCMDçš„åŒºåˆ«"><a href="#AMDå’ŒCMDçš„åŒºåˆ«" class="headerlink" title="AMDå’ŒCMDçš„åŒºåˆ«"></a>AMDå’ŒCMDçš„åŒºåˆ«</h2><blockquote><p>AMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒï¼ŒäºŒè€…çš†ä¸ºå¼‚æ­¥åŠ è½½æ¨¡å—ã€‚</p></blockquote><p>è¿˜æ˜¯ä¸Šé¢é‚£å¥è¯ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸ªå°ä¾‹å­ç†è§£ä¸€ä¸‹ã€‚</p><p>åŒæ ·æ˜¯<code>math</code>æ¨¡å—ä¸­éœ€è¦åŠ è½½<code>m1</code>æ¨¡å—ã€‚</p><p>åœ¨<code>AMD</code>ä¸­æˆ‘ä»¬ä¼šè¿™æ ·å†™ï¼š</p><p><strong>math.js</strong></p><pre><code class="hljs js">define([<span class="hljs-string">'m1'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m1</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯math, æˆ‘è¢«åŠ è½½äº†...'</span>)    <span class="hljs-keyword">var</span> add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>&#123;      <span class="hljs-keyword">return</span> a + b;    &#125;    <span class="hljs-keyword">var</span> print = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;      <span class="hljs-built_in">console</span>.log(m1.name)    &#125;    <span class="hljs-keyword">return</span> &#123;      add: add,      print: print    &#125;  &#125;)</code></pre><p>ä½†æ˜¯å¯¹äº<code>CMD</code>ï¼Œæˆ‘ä»¬ä¼šè¿™æ ·å†™ï¼š</p><p><strong>math.js</strong></p><pre><code class="hljs js">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">require, exports, module</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æˆ‘æ˜¯math, æˆ‘è¢«åŠ è½½äº†...'</span>)    <span class="hljs-keyword">var</span> m1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'m1'</span>);    <span class="hljs-keyword">var</span> add = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>&#123;      <span class="hljs-keyword">return</span> a + b;    &#125;    <span class="hljs-keyword">var</span> print = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;      <span class="hljs-built_in">console</span>.log(m1.name)    &#125;    <span class="hljs-built_in">module</span>.exports = &#123;      add: add,      print: print    &#125;  &#125;)</code></pre><p>å‡å¦‚æ­¤æ—¶<code>m1.js</code>ä¸­æœ‰ä¸€ä¸ªè¯­å¥æ˜¯åœ¨<code>m1</code>æ¨¡å—è¢«åŠ è½½çš„æ—¶å€™æ‰“å°å‡º<code>&quot;æˆ‘æ˜¯m1, æˆ‘è¢«åŠ è½½äº†...&quot;</code>ã€‚</p><p>æ‰§è¡Œç»“æœåŒºåˆ«ï¼š</p><ul><li><code>AMD</code>ï¼Œä¼šå…ˆåŠ è½½<code>m1</code>ï¼Œ<code>&quot;æˆ‘æ˜¯m1&quot;</code>ä¼šå…ˆæ‰§è¡Œ</li><li><code>CMD</code>ï¼Œæˆ‘æ˜¯<code>&quot;æˆ‘æ˜¯math&quot;</code>ä¼šå…ˆæ‰§è¡Œï¼Œå› ä¸ºæœ¬é¢˜ä¸­<code>console.log(&#39;æˆ‘æ˜¯math, æˆ‘è¢«åŠ è½½äº†...&#39;)</code>æ˜¯æ”¾åœ¨<code>require(&#39;m1&#39;)</code>å‰é¢çš„ã€‚</li></ul><p>ç°åœ¨å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°åŒºåˆ«äº†ã€‚</p><p><code>AMD</code>ä¾èµ–å‰ç½®ï¼Œ<code>js</code>å¾ˆæ–¹ä¾¿çš„å°±çŸ¥é“è¦åŠ è½½çš„æ˜¯å“ªä¸ªæ¨¡å—äº†ï¼Œå› ä¸ºå·²ç»åœ¨<code>define</code>çš„<code>dependencies</code>å‚æ•°ä¸­å°±å®šä¹‰å¥½äº†ï¼Œä¼šç«‹å³åŠ è½½å®ƒã€‚</p><p><code>CMD</code>æ˜¯å°±è¿‘ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯è¯´æ¨¡å—çš„å›è°ƒå‡½æ•°æ‰§è¡Œåˆ°åŠ è½½è¯­å¥æ—¶æ‰ä¼šå»åŠ è½½ã€‚</p><p>OKğŸ‘Œï¼Œæ¥çœ‹ä¸ªæ€»ç»“ï¼š</p><p>ä¸¤è€…ä¹‹é—´ï¼Œæœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯åœ¨æ¨¡å—å®šä¹‰æ—¶å¯¹ä¾èµ–çš„å¤„ç†ä¸åŒ</p><p><strong>1ã€AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—**</strong>2ã€CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require**</p><h1 id="ES6-Modulesè§„èŒƒ"><a href="#ES6-Modulesè§„èŒƒ" class="headerlink" title="ES6 Modulesè§„èŒƒ"></a>ES6 Modulesè§„èŒƒ</h1><p><code>ES6</code>æ ‡å‡†å‡ºæ¥åï¼Œ<code>ES6 Modules</code>è§„èŒƒç®—æ˜¯æˆä¸ºäº†å‰ç«¯çš„ä¸»æµå§ï¼Œä»¥<code>import</code>å¼•å…¥æ¨¡å—ï¼Œ<code>export</code>å¯¼å‡ºæ¥å£è¢«è¶Šæ¥è¶Šå¤šçš„äººä½¿ç”¨ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä¹Ÿä¼šä»è¿™ä¹ˆå‡ ä¸ªæ–¹é¢æ¥ä»‹ç»<code>ES6 Modules</code>è§„èŒƒï¼š</p><p><code>export</code>å‘½ä»¤å’Œ<code>import</code>å‘½ä»¤å¯ä»¥å‡ºç°åœ¨æ¨¡å—çš„ä»»ä½•ä½ç½®ï¼Œåªè¦å¤„äºæ¨¡å—é¡¶å±‚å°±å¯ä»¥ã€‚å¦‚æœå¤„äºå—çº§ä½œç”¨åŸŸå†…ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºå¤„äºæ¡ä»¶ä»£ç å—ä¹‹ä¸­ï¼Œå°±æ²¡æ³•åšé™æ€ä¼˜åŒ–äº†ï¼Œè¿èƒŒäº†ES6æ¨¡å—çš„è®¾è®¡åˆè¡·ã€‚</p><h2 id="1-exportå¯¼å‡ºæ¨¡å—"><a href="#1-exportå¯¼å‡ºæ¨¡å—" class="headerlink" title="1. exportå¯¼å‡ºæ¨¡å—"></a>1. exportå¯¼å‡ºæ¨¡å—</h2><p>exportæœ‰ä¸¤ç§æ¨¡å—å¯¼å‡ºæ–¹å¼ï¼š</p><ul><li>å‘½åå¼å¯¼å‡º(åç§°å¯¼å‡º)</li><li>é»˜è®¤å¯¼å‡º(è‡ªå®šä¹‰å¯¼å‡º)</li></ul><p><strong>å‘½åå¼å¯¼å‡º</strong></p><p>æ¥çœ‹å‡ ç§æ­£ç¡®å’Œé”™è¯¯çš„å†™æ³•å§ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// ä»¥ä¸‹ä¸¤ç§ä¸ºé”™è¯¯  </span><span class="hljs-comment">// 1.  </span><span class="hljs-keyword">export</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// 2.  </span><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> a;    <span class="hljs-comment">// ä»¥ä¸‹ä¸ºæ­£ç¡®  </span><span class="hljs-comment">// 3.  </span><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> &#123; a &#125;;    <span class="hljs-comment">// 4. æ¥å£åä¸æ¨¡å—å†…éƒ¨å˜é‡ä¹‹é—´ï¼Œå»ºç«‹äº†ä¸€ä¸€å¯¹åº”çš„å…³ç³»  </span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>;    <span class="hljs-comment">// 5. æ¥å£åä¸æ¨¡å—å†…éƒ¨å˜é‡ä¹‹é—´ï¼Œå»ºç«‹äº†ä¸€ä¸€å¯¹åº”çš„å…³ç³»  </span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-number">2</span>;    <span class="hljs-comment">// æˆ–è€…ç”¨ as æ¥å‘½å  </span><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> &#123; a <span class="hljs-keyword">as</span> outA &#125;;    <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">const</span> b = <span class="hljs-number">2</span>;  <span class="hljs-keyword">export</span> &#123; a <span class="hljs-keyword">as</span> outA, b <span class="hljs-keyword">as</span> outB &#125;;</code></pre><p>å®¹æ˜“æ··æ·†çš„å¯èƒ½æ˜¯<code>2</code>å’Œ<code>4</code>ä¸¤ç§å†™æ³•äº†ï¼Œçœ‹ç€å¾ˆåƒï¼Œä½†æ˜¯<code>2</code>å´ä¸è¡Œã€‚<code>2</code>ç›´æ¥å¯¼å‡ºä¸€ä¸ªå€¼ä¸º<code>1</code>çš„å˜é‡æ˜¯å’Œæƒ…å†µä¸€ä¸€æ ·ï¼Œæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå› ä¸ºä½ åœ¨åé¢è¦ç”¨çš„æ—¶å€™å¹¶ä¸èƒ½å®Œæˆè§£æ„ã€‚</p><p>ä½†æ˜¯<code>4</code>ä¸­ï¼Œæ¥å£åä¸æ¨¡å—å†…éƒ¨å˜é‡ä¹‹é—´ï¼Œå»ºç«‹äº†ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ‰€ä»¥å¯ä»¥ã€‚</p><p><strong>é»˜è®¤å¯¼å‡º</strong></p><p>é»˜è®¤å¯¼å‡ºä¼šåœ¨<code>export</code>åé¢åŠ ä¸Šä¸€ä¸ª<code>default</code>ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// 1.  </span><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> a;    <span class="hljs-comment">// 2.  </span><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123; a &#125;;    <span class="hljs-comment">// 3.  </span><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;; <span class="hljs-comment">// å¯ä»¥å¯¼å‡ºä¸€ä¸ªå‡½æ•°  </span><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span>()</span>&#123;&#125;; <span class="hljs-comment">// ä¹Ÿå¯ä»¥å‡ºä¸€ä¸ªç±»</span></code></pre><p>å…¶å®ï¼Œé»˜è®¤å¯¼å‡ºå¯ä»¥ç†è§£ä¸ºå¦ä¸€ç§å½¢å¼ä¸Šçš„å‘½åå¯¼å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´<code>a</code>è¿™ä¸ªå±æ€§åç›¸å½“äºæ˜¯è¢«æˆ‘é‡å†™äº†æˆäº†<code>default</code>ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;  <span class="hljs-keyword">export</span> defalut a;  <span class="hljs-comment">// ç­‰ä»·äº  </span><span class="hljs-keyword">export</span> &#123; a <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span> &#125;</code></pre><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ‰å¯ä»¥ç”¨<code>const a = 1; export default a;</code>è¿™ç§æ–¹å¼å¯¼å‡ºä¸€ä¸ªå€¼ã€‚</p><h2 id="2-importå¯¼å…¥æ¨¡å—"><a href="#2-importå¯¼å…¥æ¨¡å—" class="headerlink" title="2. importå¯¼å…¥æ¨¡å—"></a>2. importå¯¼å…¥æ¨¡å—</h2><p>importæ¨¡å—å¯¼å…¥ä¸exportæ¨¡å—å¯¼å‡ºåŠŸèƒ½ç›¸å¯¹åº”ï¼Œä¹Ÿå­˜åœ¨ä¸¤ç§æ¨¡å—å¯¼å…¥æ–¹å¼ï¼šå‘½åå¼å¯¼å…¥ï¼ˆåç§°å¯¼å…¥ï¼‰å’Œé»˜è®¤å¯¼å…¥ï¼ˆå®šä¹‰å¼å¯¼å…¥ï¼‰ã€‚</p><p>æ¥çœ‹çœ‹å†™æ³•ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// æŸä¸ªæ¨¡å—çš„å¯¼å‡º moudule.js  </span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;    <span class="hljs-comment">// æ¨¡å—å¯¼å…¥  </span><span class="hljs-comment">// 1. è¿™é‡Œçš„aå¾—å’Œè¢«åŠ è½½çš„æ¨¡å—è¾“å‡ºçš„æ¥å£åå¯¹åº”  </span><span class="hljs-keyword">import</span> &#123; a &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./module'</span>    <span class="hljs-comment">// 2. ä½¿ç”¨ as æ¢å  </span><span class="hljs-keyword">import</span> &#123; a <span class="hljs-keyword">as</span> myA &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./module'</span>    <span class="hljs-comment">// 3. è‹¥æ˜¯åªæƒ³è¦è¿è¡Œè¢«åŠ è½½çš„æ¨¡å—å¯ä»¥è¿™æ ·å†™ï¼Œä½†æ˜¯å³ä½¿åŠ è½½2æ¬¡ä¹Ÿåªæ˜¯è¿è¡Œä¸€æ¬¡  </span><span class="hljs-keyword">import</span> <span class="hljs-string">'./module'</span>    <span class="hljs-comment">// 4. æ•´ä½“åŠ è½½  </span><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-built_in">module</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./module'</span>    <span class="hljs-comment">// 5. defaultæ¥å£å’Œå…·åæ¥å£  </span><span class="hljs-keyword">import</span> <span class="hljs-built_in">module</span>, &#123; a &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./module'</span></code></pre><p>ç¬¬å››ç§å†™æ³•ä¼šè·å–åˆ°<code>module</code>ä¸­æ‰€æœ‰å¯¼å‡ºçš„ä¸œè¥¿ï¼Œå¹¶ä¸”èµ‹å€¼åˆ°<code>module</code>è¿™ä¸ªå˜é‡ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨<code>module.a</code>è¿™ç§æ–¹å¼æ¥å¼•ç”¨<code>a</code>äº†ã€‚</p><h2 id="3-export-â€¦-fromâ€¦"><a href="#3-export-â€¦-fromâ€¦" class="headerlink" title="3. export â€¦ fromâ€¦"></a>3. export â€¦ fromâ€¦</h2><p>å…¶å®è¿˜æœ‰ä¸€ç§å†™æ³•ï¼Œå¯ä»¥å°†<code>export</code>å’Œ<code>from</code>ç»“åˆèµ·æ¥ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘æœ‰ä¸‰ä¸ªæ¨¡å—<code>aã€bã€c</code>ã€‚</p><p><code>c</code>æ¨¡å—ç°åœ¨æƒ³è¦å¼•å…¥<code>a</code>æ¨¡å—ï¼Œä½†æ˜¯å®ƒä¸ä¸ç›´æ¥å¼•ç”¨<code>a</code>ï¼Œè€Œæ˜¯é€šè¿‡<code>b</code>æ¨¡å—æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šæƒ³åˆ°<code>b</code>åº”è¯¥è¿™æ ·å†™ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; someVariable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./a'</span>;    <span class="hljs-keyword">export</span> &#123; someVariable &#125;;</code></pre><p>å¼•å…¥<code>someVariable</code>ç„¶åå†å¯¼å‡ºã€‚</p><p>è¿™è¿˜åªæ˜¯ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¾—å¯¼å…¥å†å¯¼å‡ºï¼Œè‹¥æ˜¯æœ‰å¾ˆå¤šä¸ªå˜é‡éœ€è¦è¿™æ ·ï¼Œé‚£æ— ç–‘ä¼šå¢åŠ å¾ˆå¤šä»£ç é‡ã€‚</p><p>æ‰€ä»¥è¿™æ—¶å€™å¯ä»¥ç”¨ä¸‹é¢è¿™ç§æ–¹å¼æ¥å®ç°ï¼š</p><pre><code class="hljs js"><span class="hljs-keyword">export</span> &#123; someVariable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./a'</span>;</code></pre><p>ä¸è¿‡è¿™ç§æ–¹å¼æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li>è¿™æ ·çš„æ–¹å¼ä¸ä¼šå°†æ•°æ®æ·»åŠ åˆ°è¯¥èšåˆæ¨¡å—çš„ä½œç”¨åŸŸ, ä¹Ÿå°±æ˜¯è¯´, ä½ æ— æ³•åœ¨è¯¥æ¨¡å—(ä¹Ÿå°±æ˜¯<code>b</code>)ä¸­ä½¿ç”¨<code>someVariable</code>ã€‚</li></ul><h2 id="4-ES6-Modulesè§„èŒƒçš„ç‰¹ç‚¹"><a href="#4-ES6-Modulesè§„èŒƒçš„ç‰¹ç‚¹" class="headerlink" title="4. ES6 Modulesè§„èŒƒçš„ç‰¹ç‚¹"></a>4. ES6 Modulesè§„èŒƒçš„ç‰¹ç‚¹</h2><p>æ€»ç»“ä¸€ä¸‹å®ƒçš„ç‰¹ç‚¹å“ˆï¼š</p><ul><li>è¾“å‡ºä½¿ç”¨<code>export</code></li><li>è¾“å…¥ä½¿ç”¨<code>import</code></li><li>å¯ä»¥ä½¿ç”¨<code>export...from...</code>è¿™ç§å†™æ³•æ¥è¾¾åˆ°ä¸€ä¸ª<code>&quot;ä¸­è½¬&quot;</code>çš„æ•ˆæœ</li><li>è¾“å…¥çš„æ¨¡å—å˜é‡æ˜¯ä¸å¯é‡æ–°èµ‹å€¼çš„ï¼Œå®ƒåªæ˜¯ä¸ªå¯è¯»å¼•ç”¨ï¼Œä¸è¿‡å´å¯ä»¥æ”¹å†™å±æ€§</li><li><code>export</code>å‘½ä»¤å’Œ<code>import</code>å‘½ä»¤å¯ä»¥å‡ºç°åœ¨æ¨¡å—çš„ä»»ä½•ä½ç½®ï¼Œåªè¦å¤„äºæ¨¡å—é¡¶å±‚å°±å¯ä»¥ã€‚å¦‚æœå¤„äºå—çº§ä½œç”¨åŸŸå†…ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºå¤„äºæ¡ä»¶ä»£ç å—ä¹‹ä¸­ï¼Œå°±æ²¡æ³•åšé™æ€ä¼˜åŒ–äº†ï¼Œè¿èƒŒäº†ES6æ¨¡å—çš„è®¾è®¡åˆè¡·ã€‚</li><li><code>import</code>å‘½ä»¤å…·æœ‰æå‡æ•ˆæœï¼Œä¼šæå‡åˆ°æ•´ä¸ªæ¨¡å—çš„å¤´éƒ¨ï¼Œé¦–å…ˆæ‰§è¡Œã€‚</li></ul><h2 id="5-Bableä¸‹çš„ES6æ¨¡å—è½¬æ¢"><a href="#5-Bableä¸‹çš„ES6æ¨¡å—è½¬æ¢" class="headerlink" title="5. Bableä¸‹çš„ES6æ¨¡å—è½¬æ¢"></a>5. Bableä¸‹çš„ES6æ¨¡å—è½¬æ¢</h2><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œå¦‚æœä½ æœ‰ä½¿ç”¨è¿‡ä¸€äº›ES6çš„Babelçš„è¯ï¼Œä½ ä¼šå‘ç°å½“ä½¿ç”¨<code>export/import</code>çš„æ—¶å€™ï¼ŒBabelä¹Ÿä¼šæŠŠå®ƒè½¬æ¢ä¸º<code>exports/require</code>çš„å½¢å¼ã€‚</p><p>ä¾‹å¦‚æˆ‘çš„è¾“å‡ºï¼š</p><p><em>m1.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> count = <span class="hljs-number">0</span>;</code></pre><p>æˆ‘çš„è¾“å…¥ï¼š</p><p><em>index.js</em>:</p><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;count&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./m1.js'</span>  <span class="hljs-built_in">console</span>.log(count)</code></pre><p>å½“ä½¿ç”¨Babelç¼–è¯‘ä¹‹åï¼Œå„è‡ªä¼šè¢«è½¬æ¢ä¸ºï¼š</p><p><em>m1.js</em>:</p><pre><code class="hljs js"><span class="hljs-meta">"use strict"</span>;    <span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, &#123;    value: <span class="hljs-literal">true</span>  &#125;);  exports.count = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;  <span class="hljs-keyword">const</span> count = <span class="hljs-number">0</span>;  exports.count = count;</code></pre><p><em>index.js</em>:</p><pre><code class="hljs js"><span class="hljs-meta">"use strict"</span>;    <span class="hljs-keyword">var</span> _m = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./m1.js"</span>);    <span class="hljs-built_in">console</span>.log(_m.count);</code></pre><p>æ­£æ˜¯å› ä¸ºè¿™ç§è½¬æ¢å…³ç³»ï¼Œæ‰èƒ½è®©æˆ‘ä»¬æŠŠ<code>exports</code>å’Œ<code>import</code>ç»“åˆèµ·æ¥ç”¨ï¼š</p><p>ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥è¿™æ ·ç”¨ï¼š</p><pre><code class="hljs js"><span class="hljs-comment">// è¾“å‡ºæ¨¡å— m1.js  </span>exports.count = <span class="hljs-number">0</span>;      <span class="hljs-comment">// index.jsä¸­å¼•å…¥  </span><span class="hljs-keyword">import</span> &#123;count&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./m1.js'</span>  <span class="hljs-built_in">console</span>.log(count)</code></pre><h2 id="CommonJSä¸ES6-Modulesè§„èŒƒçš„åŒºåˆ«"><a href="#CommonJSä¸ES6-Modulesè§„èŒƒçš„åŒºåˆ«" class="headerlink" title="CommonJSä¸ES6 Modulesè§„èŒƒçš„åŒºåˆ«"></a>CommonJSä¸ES6 Modulesè§„èŒƒçš„åŒºåˆ«</h2><p>ğŸ˜‚ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šäººå°±æ¯”è¾ƒå…³å¿ƒå®ƒä¸¤åŒºåˆ«çš„é—®é¢˜ï¼Œå› ä¸ºåŸºæœ¬ä¸Šé¢è¯•é—®çš„å°±æ˜¯è¿™ä¸ªã€‚å¥½å§ï¼Œè¿™é‡Œæ¥åšä¸€ä¸ªç®—æ˜¯æ¯”è¾ƒè¯¦ç»†çš„æ€»ç»“å§ã€‚</p><ul><li>CommonJSæ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 Modulesæ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£</li><li>CommonJSè¾“å‡ºæ˜¯å€¼çš„æµ…æ‹·è´ï¼›ES6 Modulesè¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ï¼Œè¢«è¾“å‡ºæ¨¡å—çš„å†…éƒ¨çš„æ”¹å˜ä¼šå½±å“å¼•ç”¨çš„æ”¹å˜</li><li>CommonJså¯¼å…¥çš„æ¨¡å—è·¯å¾„å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯<code>require()</code>æ–¹æ³•ï¼›è€ŒES6 Modulesåªèƒ½æ˜¯å­—ç¬¦ä¸²</li><li>CommonJS<code>this</code>æŒ‡å‘å½“å‰æ¨¡å—ï¼ŒES6 Modules<code>this</code>æŒ‡å‘<code>undefined</code></li><li>ä¸”ES6 Modulesä¸­æ²¡æœ‰è¿™äº›é¡¶å±‚å˜é‡ï¼š<code>arguments</code>ã€<code>require</code>ã€<code>module</code>ã€<code>exports</code>ã€<code>__filename</code>ã€<code>__dirname</code></li></ul><p>å…³äºç¬¬ä¸€ä¸ªå·®å¼‚ï¼Œæ˜¯å› ä¸ºCommonJS åŠ è½½çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³<code>module.exports</code>å±æ€§ï¼‰ï¼Œè¯¥å¯¹è±¡åªæœ‰åœ¨è„šæœ¬è¿è¡Œå®Œæ‰ä¼šç”Ÿæˆã€‚è€Œ ES6 æ¨¡å—ä¸æ˜¯å¯¹è±¡ï¼Œå®ƒçš„å¯¹å¤–æ¥å£åªæ˜¯ä¸€ç§é™æ€å®šä¹‰ï¼Œåœ¨ä»£ç é™æ€è§£æé˜¶æ®µå°±ä¼šç”Ÿæˆã€‚</p><p>ï¼ˆåº”è¯¥è¿˜ä¸€äº›åŒºåˆ«æˆ‘æ²¡æƒ³åˆ°çš„ï¼Œæ¬¢è¿è¡¥å……ğŸ‘ğŸ˜Šï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ¨¡å—</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
